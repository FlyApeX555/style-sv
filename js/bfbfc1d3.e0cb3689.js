function e(){"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[72656],{619958:(e,t,a)=>{function r(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.05 2.53C4.79 2.13 5.52 2 7.13 2h5.74c1.61 0 2.34.14 3.08.53.65.35 1.17.87 1.52 1.52.4.74.53 1.47.53 3.08v5.74c0 1.61-.14 2.34-.53 3.08a3.64 3.64 0 0 1-1.52 1.52c-.74.4-1.47.53-3.08.53H7.13c-1.61 0-2.34-.14-3.08-.53a3.64 3.64 0 0 1-1.52-1.52c-.4-.74-.53-1.47-.53-3.08V7.13c0-1.61.14-2.34.53-3.08.35-.65.87-1.17 1.52-1.52Zm3.08.97c-1.53 0-1.96.14-2.38.36-.38.2-.69.5-.9.9-.21.4-.35.84-.35 2.37v5.74c0 1.53.14 1.96.36 2.38.2.38.5.69.9.9.4.21.84.35 2.37.35h5.74c1.53 0 1.96-.14 2.38-.36.38-.2.69-.5.9-.9.21-.4.35-.84.35-2.37V7.13c0-1.53-.14-1.96-.36-2.38-.2-.38-.5-.69-.9-.9-.4-.21-.84-.35-2.37-.35H7.13Z" fill="currentColor"/></svg>',name:"check_box_off_20"}}a.d(t,{getIcon20CheckBoxOff:()=>r})},10946:(e,t,a)=>{function r(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.44 4.18C2 5.04 2 6.16 2 8.4v3.2c0 2.24 0 3.36.44 4.22a4 4 0 0 0 1.74 1.74c.86.44 1.98.44 4.22.44h3.2c2.24 0 3.36 0 4.22-.44a4 4 0 0 0 1.74-1.74c.44-.86.44-1.98.44-4.22V8.4c0-2.24 0-3.36-.44-4.22a4 4 0 0 0-1.74-1.74C14.96 2 13.84 2 11.6 2H8.4c-2.24 0-3.36 0-4.22.44a4 4 0 0 0-1.74 1.74Zm12.2 3.8a.9.9 0 1 0-1.28-1.27L8.7 11.38 6.64 9.33a.9.9 0 0 0-1.28 1.27l2.7 2.69a.9.9 0 0 0 1.27 0l5.3-5.3Z" fill="currentColor"/></svg>',name:"check_box_on_20"}}a.d(t,{getIcon20CheckBoxOn:()=>r})},114251:(e,t,a)=>{function r(){return{icon:'<svg width="44" height="44" viewBox="0 0 44 44" xmlns="http://www.w3.org/2000/svg"><path d="M22 44a1.5 1.5 0 0 1 0-3A19 19 0 1 0 4.1 28.4a1.5 1.5 0 1 1-2.82 1A21.96 21.96 0 0 1 0 22a22 22 0 1 1 22 22Z" fill="currentColor"/></svg>',name:"spinner_44"}}a.d(t,{getIcon44Spinner:()=>r})},637829:(e,t,a)=>{function r(){return{icon:'<svg width="56" height="56" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g id="check_circle_outline_56__Icons-56/check_circle_outline_56" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="check_circle_outline_56__check_circle_outline_56" fill-rule="nonzero"><path d="M0 0h56v56H0z"/><path d="M28 4a24 24 0 1 1 0 48 24 24 0 0 1 0-48Zm0 3a21 21 0 1 0 0 42 21 21 0 0 0 0-42Zm8.94 13.94a1.5 1.5 0 0 1 2.12 2.12l-14 14a1.5 1.5 0 0 1-2.12 0l-7-7a1.5 1.5 0 0 1 2.12-2.12L24 33.88Z" id="check_circle_outline_56__Icon-Color" fill="currentColor"/></g></g></svg>',name:"check_circle_outline_56"}}a.d(t,{getIcon56CheckCircleOutline:()=>r})},904719:(e,t,a)=>{function r(){return{icon:'<svg fill="none" height="56" viewBox="0 0 56 56" width="56" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path clip-rule="evenodd" d="M30.6 8.5 48.78 40a3 3 0 0 1-2.6 4.5H9.82a3 3 0 0 1-2.6-4.5l18.2-31.5a3 3 0 0 1 5.19 0zM22.8 7a6 6 0 0 1 10.4 0l18.18 31.5a6 6 0 0 1-5.2 9H9.82a6 6 0 0 1-5.2-9z" fill-rule="evenodd"/><path d="M30 36a2 2 0 1 0-4 0 2 2 0 0 0 4 0zm-.5-18a1.5 1.5 0 0 0-3-.14V29a1.5 1.5 0 0 0 3 .14V29z"/></g></svg>',name:"error_triangle_outline_56"}}a.d(t,{getIcon56ErrorTriangleOutline:()=>r})},291029:(e,t,a)=>{function r(){return{icon:'<svg width="56" height="56" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g id="phone_outline_56__Icons-56/phone_outline_56" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="phone_outline_56__phone_outline_56"><path d="M0 0h56v56H0z"/><path d="m33.4 35.76-1.5 1.5a2.96 2.96 0 0 1-3.12.7c-1.75-.65-3.78-2.17-6.17-4.56-2.4-2.4-3.92-4.43-4.56-6.17-.4-1.09-.13-2.3.69-3.12l1.5-1.51a5.97 5.97 0 0 0 .5-8.05l-1.77-2.1a4.24 4.24 0 0 0-6-.38 5.32 5.32 0 0 0-1.83 3.57c-.83 6.2 2.21 12.83 9.3 19.92 7.1 7.1 13.72 10.14 19.98 9.3a5.31 5.31 0 0 0 3.51-1.81 4.25 4.25 0 0 0-.36-6.02l-2.1-1.77a5.98 5.98 0 0 0-8.06.5Zm-2.11-2.12a8.97 8.97 0 0 1 12.1-.68l2.1 1.77A7.25 7.25 0 0 1 46.22 45a8.28 8.28 0 0 1-5.45 2.84c-7.26.98-14.74-2.46-22.44-10.16C10.63 30 7.2 22.5 8.16 15.31a8.19 8.19 0 0 1 2.85-5.52 7.25 7.25 0 0 1 10.26.72l1.77 2.1a8.97 8.97 0 0 1-.67 12.11l-1.5 1.5c.47 1.24 1.75 2.96 3.86 5.06 2.1 2.1 3.81 3.38 5.06 3.85l1.5-1.5Z" id="phone_outline_56__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"phone_outline_56"}}a.d(t,{getIcon56PhoneOutline:()=>r})},935509:(e,t,a)=>{function r(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" fill="currentColor" viewBox="0 0 56 56"><path fill-rule="evenodd" d="M25.05 4a6.4 6.4 0 0 0-5.76 3.62l-5.18 10.73A11.2 11.2 0 0 0 13 23.22v18.02A8.75 8.75 0 0 0 21.74 50h15.63a8.74 8.74 0 0 0 8.2-5.73l5.88-15.97a8.76 8.76 0 0 0-8.2-11.8H31.5v-6.08A6.45 6.45 0 0 0 25.05 4Zm-3.07 4.93A3.4 3.4 0 0 1 25.05 7a3.45 3.45 0 0 1 3.46 3.42v6.84c0 1.24 1 2.24 2.23 2.24h12.51c4 0 6.78 4 5.4 7.76l-5.88 15.97a5.75 5.75 0 0 1-5.4 3.77H21.74a5.76 5.76 0 0 1-5.75-5.76V23.22c0-1.23.28-2.45.82-3.56l5.17-10.73Z" clip-rule="evenodd"/><path d="M7.5 50A1.5 1.5 0 0 0 9 48.5v-25a1.5 1.5 0 0 0-3 0v25A1.5 1.5 0 0 0 7.5 50Z"/></svg>',name:"thumbs_up_outline_56"}}a.d(t,{getIcon56ThumbsUpOutline:()=>r})},137233:(e,t,a)=>{a.r(t),a.d(t,{VKWebAppActionDone:()=>$.VKWebAppActionDone,VKWebAppAddToChat:()=>ee.VKWebAppAddToChat,VKWebAppAddToCommunity:()=>i.VKWebAppAddToCommunity,VKWebAppAddToFavorites:()=>T.VKWebAppAddToFavorites,VKWebAppAddToHomeScreenInfo:()=>n.VKWebAppAddToHomeScreenInfo,VKWebAppAddToMenu:()=>x.VKWebAppAddToMenu,VKWebAppAddToProfile:()=>X.VKWebAppAddToProfile,VKWebAppCallFinished:()=>se.VKWebAppCallFinished,VKWebAppCallGetStatus:()=>ie.VKWebAppCallGetStatus,VKWebAppCallJoin:()=>ae.VKWebAppCallJoin,VKWebAppCallLeft:()=>re.VKWebAppCallLeft,VKWebAppCallStart:()=>te.VKWebAppCallStart,VKWebAppChangeFragment:()=>J.VKWebAppChangeFragment,VKWebAppClose:()=>W.VKWebAppClose,VKWebAppCustomMessage:()=>Q.VKWebAppCustomMessage,VKWebAppFlashGetInfo:()=>K.VKWebAppFlashGetInfo,VKWebAppGetAuthToken:()=>_.VKWebAppGetAuthToken,VKWebAppGetClientVersion:()=>c.VKWebAppGetClientVersion,VKWebAppGetCommunityAuthToken:()=>r.VKWebAppGetCommunityAuthToken,VKWebAppGetCommunityToken:()=>s.VKWebAppGetCommunityToken,VKWebAppGetEmail:()=>d.VKWebAppGetEmail,VKWebAppGetFriends:()=>D.VKWebAppGetFriends,VKWebAppGetPhoneNumber:()=>p.VKWebAppGetPhoneNumber,VKWebAppGetSilentToken:()=>U.VKWebAppGetSilentToken,VKWebAppLocationChanged:()=>V.VKWebAppLocationChanged,VKWebAppOpenApp:()=>u.VKWebAppOpenApp,VKWebAppOpenArticle:()=>E.VKWebAppOpenArticle,VKWebAppOpenArticleEditor:()=>I.VKWebAppOpenArticleEditor,VKWebAppOpenInNativeApp:()=>L.VKWebAppOpenInNativeApp,VKWebAppOpenPayForm:()=>h.VKWebAppOpenPayForm,VKWebAppOpenReportForm:()=>G.VKWebAppOpenReportForm,VKWebAppOpenWallPost:()=>B.VKWebAppOpenWallPost,VKWebAppRecommend:()=>z.VKWebAppRecommend,VKWebAppRemoveFromProfile:()=>Z.VKWebAppRemoveFromProfile,VKWebAppSendCustomEvent:()=>Y.VKWebAppSendCustomEvent,VKWebAppSendPayload:()=>A.VKWebAppSendPayload,VKWebAppSendToClient:()=>l.VKWebAppSendToClient,VKWebAppSetLocation:()=>o.VKWebAppSetLocation,VKWebAppShare:()=>m.VKWebAppShare,VKWebAppShowCommunityWidgetPreviewBox:()=>P.VKWebAppShowCommunityWidgetPreviewBox,VKWebAppShowGoodOrderBox:()=>b.VKWebAppShowGoodOrderBox,VKWebAppShowInviteBox:()=>O.VKWebAppShowInviteBox,VKWebAppShowLeaderBoardBox:()=>C.VKWebAppShowLeaderBoardBox,VKWebAppShowLinkCardBox:()=>k.VKWebAppShowLinkCardBox,VKWebAppShowNewPostBox:()=>g.VKWebAppShowNewPostBox,VKWebAppShowNftGoodBox:()=>w.VKWebAppShowNftGoodBox,VKWebAppShowNftOtpBox:()=>R.VKWebAppShowNftOtpBox,VKWebAppShowNftPaymentBox:()=>y.VKWebAppShowNftPaymentBox,VKWebAppShowOrderBox:()=>S.VKWebAppShowOrderBox,VKWebAppShowRequestBox:()=>N.VKWebAppShowRequestBox,VKWebAppShowStoryBox:()=>M.VKWebAppShowStoryBox,VKWebAppShowStoryBoxLoadFinish:()=>H.VKWebAppShowStoryBoxLoadFinish,VKWebAppShowSubscriptionBox:()=>F.VKWebAppShowSubscriptionBox,VKWebAppShowWallPostBox:()=>v.VKWebAppShowWallPostBox,VKWebAppTrackEvent:()=>j.VKWebAppTrackEvent,VKWebAppUpdateConfig:()=>f.VKWebAppUpdateConfig,VKWebAppValidatePhone:()=>q.VKWebAppValidatePhone});var r=a(283083),s=a(111909),i=a(276060),n=a(551074),o=a(160608),c=a(129378),p=a(285198),d=a(916775),l=a(976727),_=a(149128),h=a(491003),u=a(617540),m=a(290348),g=a(484211),v=a(695799),A=a(453015),E=a(922609),f=a(517508),S=a(694287),b=a(666554),w=a(108996),R=a(918274),C=a(265734),k=a(896566),y=a(321670),O=a(559850),I=a(684404),N=a(767708),T=a(89108),x=a(901670),D=a(760241),P=a(933023),L=a(752784),V=a(626898),W=a(769527),M=a(701890),H=a(708669),F=a(234790),K=a(839549),B=a(845005),U=a(414753),G=a(249879),j=a(588626),$=a(781617),q=a(766986),Y=a(420136),z=a(321401),Q=a(310338),J=a(579827),X=a(765620),Z=a(68554),ee=a(541570),te=a(191871),ae=a(450907),re=a(800662),se=a(712981),ie=a(209037)},781617:(e,t,a)=>{a.d(t,{VKWebAppActionDone:()=>s});var r=a(290788);class s extends r.Handler{handler(e){cur.onExternalAppDone&&cur.onExternalAppDone(e)}constructor(e){super(e),this.params.handlerName="VKWebAppActionDone"}}},541570:(e,t,a)=>{a.d(t,{VKWebAppAddToChat:()=>_});var r=a(290788),s=a(914421),i=a(105330),n=a(111757),o=a(195525),c=a(52905),p=a(898848),d=a(670053),l=a(816980);class _ extends r.Handler{getChatsList(){if(this.appToChatSender.isAttachPickerFlow())return[Number((0,d.getCurrentApp)()?.options?.peer_id||cur.peer)];if((0,l.isSpaLaunch)()){const e=(0,d.getCurrentApp)();return(0,i.isMvk)()?e.selectChats():e.funcs.selectChatsBox(e?.options?.aid,window.vk?.id).then((e=>Object.values(e))).then((e=>e.map((([e])=>e))))}return(0,i.isMvk)()?window.VKApps.selectChats():window.Apps.selectChatsBox(window.cur?.aid,window.vk?.id).then((e=>Object.values(e))).then((e=>e.map((([e])=>e))))}doneHandler({result:e,link:t}){if(this.successHandler({result:e}),this.closeModal(),this.closeApp&&this.appToChatSender.isAttachPickerFlow())return(0,i.isMvk)()&&t?window.nav.go(t):window.Apps?.closeLayer?.();this.showSuccessSnackbar(t)}async allowUIAction(){try{this.modal.lockButtons(),await this.actionHandler()}catch(e){this.closeModal(),this.showFailSnackbar(),this.errorHandler(e)}}async actionHandler(){const e=await this.getChatsList();if(!e||!e.length)return this.denyUIAction();const t=await this.appToChatSender.sendToChat({chatIds:e});this.doneHandler(t)}showSuccessSnackbar(e){const t=(0,o.getSuccessSnackbar)(e,(0,i.isMvk)());(0,i.isMvk)()?window.Snackbar.init(t):window.showDoneBox(t,{onClick:"Notifier.hideEvent(ev)"})}showFailSnackbar(){const e=(0,o.getFailSnackbar)((0,i.isMvk)());(0,i.isMvk)()?window.Snackbar.init(e):window.showDoneBox(e,{onClick:"Notifier.hideEvent(ev)"})}closeModal(e){this.modal&&(e&&e(),this.modal.destroy(),s.default.pop(this.modal))}async handler(e={},t=null,a){const r=(0,d.getCurrentApp)();return this.setData({...e,containerId:e.containerId||r.cont.id},t||r,a),this.actionTitle=(0,p.clean)(e.action_title),this.closeApp=e.close_app,this.hash=(0,p.clean)(e.hash),"boolean"!=typeof this.closeApp&&void 0!==this.closeApp?this.errorHandler({code:c.ERROR_CODES.INVALID_PARAMS,reason:'Param "close_app" must be boolean or omitted'}):this.actionTitle?(this.appToChatSender=new n.AppToChatSender({appId:(0,l.isSpaLaunch)()?r?.options?.aid:cur.aid,title:this.actionTitle,hash:this.hash,ref:String(r?.options?.ref||"")}),void this.launchUI((0,o.getModal)(this.appToChatSender.getRef(),this.actionTitle,{}))):this.errorHandler({code:c.ERROR_CODES.MISSING_PARAM,reason:'Param "action_title" is missing'})}constructor(e){super(e),this.params.handlerName="VKWebAppAddToChat",this.actionTitle="",this.closeApp=!1,this.hash="",this.callApi=!0,this.useUI=!0}}},276060:(e,t,a)=>{a.d(t,{VKWebAppAddToCommunity:()=>d});var r=a(290788),s=a(914421),i=a(105330),n=a(234430),o=a(540462),c=a(670053),p=a(524915);class d extends r.Handler{takeAction(){ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,...this.request},{onDone:e=>{this.handleResponse(e,{},this.checkAppAdd)},onFail:e=>(this.errorHandler(e),!0)})}checkAppAdd(e){parseInt(e,10)&&this.successHandler({result:!0})}loadIntroData(e){this.request={...e};const t=(0,i.isMvk)()?{act:"vkapps_add_to_community_box",hash:(0,c.getCurrentApp)().options.hash,app_id:this.app.appId,...this.request}:{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,...this.request};if((0,i.isMvk)()){const{ajax:e}=window;e.post("apps.php",t,{onDone:(e,t)=>{(0,o.partConfigEnabled)("remove_showAppsBox_from_app_instance")?(0,p.showAppsBox)(e,t):(0,c.getCurrentApp)().showAppsBox(e,t)},onFail:e=>(this.errorHandler(e),!0)})}else ajax.post("apps.php",t,{onDone:e=>{this.handleResponse(e,{},this.checkIntroData)},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e){if(e.items.length>0){const e=this.props.hide_success_modal?1:0;window.showBox("apps",{act:"add_vk_app_to_groups_box",app_id:this.app.appId,hide_success_modal:(0,o.partConfigEnabled)("vk_web_app_add_to_community_success_modal_hidden_param")?e:0},{params:{width:570,bodyStyle:"padding: 22px 0 0"},onFail:function(e){return window.showFastBox(getLang("global_error"),e),!0}})}else 0===e.items.length&&(this.errorHandler({code:1}),this.noCommunitiesBox=new window.MessageBox({title:getLang("global_error")}).content(getLang("vkapps_no_admin_communities_warning")).addButton(getLang("global_close"),(()=>{this.noCommunitiesBox.hide()})).show())}unsetCurHandlers(){cur.vkAppAddToCommunitySuccessHandler=null,cur.vkAppAddToCommunityErrorHandler=null,cur.vkAppShowModal=null,(0,i.isMvk)()&&VKApps.cancelSettings()}addToCommunitySuccessHandler(e){this.successHandler(e),this.unsetCurHandlers()}addToCommunityErrorHandler(e){this.errorHandler(e||{code:4}),this.unsetCurHandlers()}showConfirmationModal(){return this.params.modal.containerId="apps",new Promise(((e,t)=>{this.params.modal.allowAction=()=>{e(),s.default.pop(this.modal)},this.params.modal.cancelAction=()=>{t(),s.default.pop(this.modal)},this.modal=new n.UIAction(this.params.modal),s.default.push(this.modal)}))}handler(e,t,a){this.setData(e,t),this.callback=a,cur.vkAppAddToCommunitySuccessHandler=this.addToCommunitySuccessHandler,cur.vkAppAddToCommunityErrorHandler=this.addToCommunityErrorHandler,cur.vkAppShowModal=this.showConfirmationModal,this.props=e,(0,o.partConfigEnabled)("vk_web_app_add_to_community_success_modal_hidden_param")&&!this.isValidParams(e)||(!(0,o.partConfigEnabled)("mini_apps_web_add_to_community_cant_install_error")||this.app.vkApp.options.is_install_to_group_available||(0,i.isMvk)()?this.loadIntroData(e):(this.errorHandler({code:1}),this.showBridgeModal(this.app,{type:"Alert",data:{title:getLang("global_error"),message:getLang("apps_connect_add_to_community_app_cant_install"),actions:[{title:getLang("global_close"),autoClose:!0}]}})))}isValidParams(e){return this.checkParams(e,[{param:"hide_success_modal",type:"boolean"}])}constructor(e){super(e),this.params.handlerName="VKWebAppAddToCommunity",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_undo"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_community")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.addToCommunitySuccessHandler=this.addToCommunitySuccessHandler.bind(this),this.addToCommunityErrorHandler=this.addToCommunityErrorHandler.bind(this),this.unsetCurHandlers=this.unsetCurHandlers.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.checkAppAdd=this.checkAppAdd.bind(this),this.showConfirmationModal=this.showConfirmationModal.bind(this)}}},89108:(e,t,a)=>{a.d(t,{VKWebAppAddToFavorites:()=>p});var r=a(290788),s=a(52905),i=a(540462),n=a(105330),o=a(957994),c=a(670053);class p extends r.Handler{loadIntroData(e){this.request={...e},(0,i.partConfigEnabled)("add_to_menu_event_to_api")?this.callWithApi(e):this.callWithAct(e)}callWithAct(e){ajax.post("apps.php",{act:"handle_vk_connect_event",hash:(0,c.getCurrentApp)().options[`${s.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:s.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{const a=JSON.parse(t);this.checkIntroData(a,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}callWithApi(e){(0,o.api)("apps.get",{app_id:this.app.appId}).then((t=>{t.hasOwnProperty("error")?this.handleApiError(t.error):this.checkIntroData({added_to_favorites:t.items[0].is_favorite},e)}))}checkIntroData(e,t){e.added_to_favorites?this.successHandler({result:!0}):this.launchUI(t)}allowUIAction(){return(0,i.partConfigEnabled)("add_to_menu_event_to_api")?(0,o.api)("apps.addToMenu",{app_id:this.app.appId}).then((e=>{e.hasOwnProperty("error")?this.errorApiHandle(e):this.checkResponse({result:!!e})})).catch((e=>(this.errorApiHandle(e),!0))):super.allowUIAction()}checkResponse(e){(0,n.isMvk)()?this.checkResponseMvk(e):this.checkResponseWeb(e)}checkResponseMvk(e){!0===e.result&&window.cur&&window.cur.VKApp&&(window.cur.VKApp.isFavorite=!window.cur.VKApp.isFavorite,window.DirectGames&&window.DirectGames.initMenu()),super.checkResponse(e)}checkResponseWeb(e){e.result&&e.result.left_nav&&(window.Apps.updateLeftNav(e.result.left_nav),window.Apps.updateAddToMenuAction(),e={result:e.result.success}),(0,i.partConfigEnabled)("add_to_menu_event_to_api")&&e.result&&window.Apps.updateAddToMenuActionWithoutRequest(!0),super.checkResponse(e)}handler(e,t,a){((0,i.partConfigEnabled)("mini_apps_web_add_to_favorites")||(0,c.getCurrentApp)().isDirectGame)&&(this.setData(e,t),this.callback=a,this.loadIntroData(e))}constructor(e){super(e),this.params.handlerName="VKWebAppAddToFavorites",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_undo"),type:"deny"},{title:getLang("apps_connect_modal_btn_add"),type:"success"}],title:getLang("apps_connect_modal_messages_request_add_to_favorites"),text:getLang("apps_connect_modal_messages_request_add_to_favorites_text"),svgIcon:'<svg class="vk_app_modal_container__pic" width="56" height="56" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0H32V32H0z"/><path d="M15.487 22.565a.985.985 0 0 1 1.026 0l5.682 3.468c.004 0-.509-2.159-1.538-6.476a.983.983 0 0 1 .317-.975l5.056-4.328c.002-.004-2.211-.184-6.639-.54a.984.984 0 0 1-.83-.602L16.005 6.97c-.004-.003-.86 2.045-2.566 6.142a.984.984 0 0 1-.83.602l-6.637.532c-.003.002 1.681 1.448 5.054 4.336.28.24.402.616.317.975l-1.545 6.47c.001.005 1.898-1.15 5.69-3.462zm-4.656 5.146a1.974 1.974 0 0 1-2.947-2.14l1.405-5.886-4.6-3.937a1.97 1.97 0 0 1 1.126-3.462l6.038-.484 2.326-5.587a1.973 1.973 0 0 1 3.642 0l2.326 5.587 6.038.484a1.971 1.971 0 0 1 1.126 3.462l-4.6 3.937 1.405 5.886a1.97 1.97 0 0 1-2.947 2.14L16 24.556l-5.169 3.155z" fill="#528BCC" fill-rule="nonzero"/></g></svg>'},this.callApi=!0,this.useUI=!0}}},551074:(e,t,a)=>{a.d(t,{VKWebAppAddToHomeScreenInfo:()=>s});var r=a(290788);class s extends r.Handler{actionHandler(e){this.successHandler({is_feature_supported:!1,is_added_to_home_screen:!1})}constructor(e){super(e),this.params.handlerName="VKWebAppAddToHomeScreenInfo"}}},901670:(e,t,a)=>{a.d(t,{VKWebAppAddToMenu:()=>n});var r=a(290788),s=a(397088),i=a(143037);class n extends r.Handler{actionHandler(e){(0,s.chooseAction)({handler:i.CONNECT_EVENTS.ADD_TO_FAVORITES,params:{...e,originalHandlerName:i.CONNECT_EVENTS.ADD_TO_MENU}},this.app)}}},765620:(e,t,a)=>{a.d(t,{VKWebAppAddToProfile:()=>p});var r=a(290788),s=a(105330),i=a(52905),n=a(540462),o=a(576592),c=a(458817);class p extends r.Handler{isValidParams(e){return this.checkParams(e,[{param:"ttl",type:"number"}])}actionHandler(e){if(!(0,o.isProfileButtonAvailable)())return;if(!this.isValidParams(e))return;if((0,o.isProfileButtonInstalled)())return void this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"The button is already installed in the profile"});const t=e.ttl||0;if(!(0,s.isMvk)())return this.addToProfileSuccess=this.addToProfileSuccess.bind(this),this.addToProfileFailed=this.addToProfileFailed.bind(this),void window.Apps.loadAddToProfile(t).then(this.addToProfileSuccess).catch(this.addToProfileFailed);(0,c.setAddToProfileBridgeContext)(this),window.MiniAppsProfileButtons.showAddToProfile(t)}addToProfileSuccess(e){this.successHandler({privacy:e,...(0,n.partConfigEnabled)("mini_apps_profile_bridge_fix")&&{visibility:"list28"===e?"best_friends":e}})}addToProfileFailed(e){this.errorHandler({code:e})}constructor(e){super(e),this.params.handlerName="VKWebAppAddToProfile"}}},712981:(e,t,a)=>{a.d(t,{VKWebAppCallFinished:()=>i});var r=a(290788),s=a(143037);class i extends r.Handler{get successDescriptor(){return`${this.params.handlerName}`}actionHandler(e){this.successHandler({result:!0})}constructor(e){super(e),this.params.handlerName=s.CONNECT_EVENTS.CALL_FINISHED}}},209037:(e,t,a)=>{a.d(t,{VKWebAppCallGetStatus:()=>o});var r=a(290788),s=a(143037),i=a(52905),n=a(727772);class o extends r.Handler{actionHandler(e){const t=(0,n.getAppOptions)();return t&&t.aid?t.is_calls_available?void this.successHandler({result:!0,is_active:!!window.Calls?.isInActiveCall}):this.errorHandler({code:i.ERROR_CODES.ACCESS_DENIED,reason:"App calls is unavailable"}):this.errorHandler("App is not found")}constructor(e){super(e),this.params.handlerName=s.CONNECT_EVENTS.CALL_GET_STATUS,this.isWebOnly=!0}}},450907:(e,t,a)=>{a.d(t,{VKWebAppCallJoin:()=>g});var r=a(290788),s=a(143037),i=a(52905),n=a(291029),o=a(727772),c=a(234430),p=a(540462),d=a(105330),l=a(914421),_=a(397088),h=a(500240),u=a(280977),m=a(670053);class g extends r.Handler{handler(e,t,a){if(this.setData(e,t),this.callback=a,(0,d.isMvk)())return this.errorHandler({code:i.ERROR_CODES.UNSUPPORTED_PLATFORM,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.UNSUPPORTED_PLATFORM});const r=(0,o.getAppOptions)();if(!r||!r.aid)return this.errorHandler("App is not found");if(!r.is_calls_available||!window.Calls)return this.errorHandler({code:i.ERROR_CODES.ACCESS_DENIED,reason:"App calls is unavailable"});if(window.Calls.isInActiveCall)return this.errorHandler({code:i.ERROR_CODES.CUSTOM,reason:"Active call is present"});const s=(0,p.partConfigEnabled)("mini_apps_filter_method_params")?{join_link:e.join_link}:e;this.launchUI(s)}actionHandler(e){if(!this.checkParams(e,[{param:"join_link",type:"string",isRequired:!0}]))return;const t=e.join_link,a=(0,o.getAppOptions)();window.Calls.joinCallByLink({joinLink:t,isWithVideo:!1,entryPoint:"mini_app",miniAppId:a.aid}).then((()=>{window.Calls.eventBus.on(u.CallsEventType.HANGUP,(e=>{if(!e||!e?.hangupReason?.error&&!e?.hangupReason?.hangup||!(0,m.getCurrentApp)())return;const t=window.Calls.store.getState().lastCallData||{};t.isMeEndedCallForAll?this.app?.sendEventToMiniApp?this.app.sendEventToMiniApp(s.CONNECT_EVENTS.CALL_FINISHED,{callId:t.callId}):(0,_.chooseAction)({handler:s.CONNECT_EVENTS.CALL_FINISHED,params:{callId:t.callId}},this.app):"NOT_FOUND"!==e?.hangupReason?.hangup&&this.sendCallLeftEvent(t.callId)}),{once:!0}),window.Calls.isInActiveCall&&this.successHandler({result:!0})})).catch((e=>{const t={error_code:e.error_code||e.code,error_msg:e.error_msg||e.message};if(t.error_msg?.includes("NOT_FOUND"))return this.successHandler({result:!0}),void this.sendCallLeftEvent();this.errorHandler(t)}))}sendCallLeftEvent(e){this.app?.sendEventToMiniApp?this.app.sendEventToMiniApp(s.CONNECT_EVENTS.CALL_LEFT,{reason:h.CallLeftReason.GENERAL,callId:e}):(0,_.chooseAction)({handler:s.CONNECT_EVENTS.CALL_LEFT,params:{reason:h.CallLeftReason.GENERAL,callId:e}},this.app)}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new c.UIAction({...this.params.modal,...e}),l.default.push(this.modal)}getPhoneIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--phone">\n      ${(0,n.getIcon56PhoneOutline)().icon}\n    </div>\n    `}constructor(e){super(e),this.params.handlerName=s.CONNECT_EVENTS.CALL_JOIN,this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_not_now"),type:"deny",dataTestId:"apps_call_join_modal_cancel_button"},{title:getLang("apps_connect_modal_btn_login"),type:"success",dataTestId:"apps_call_join_modal_login_button"}],title:getLang("apps_connect_modal_messages_enter_call_title"),text:getLang("apps_connect_modal_messages_enter_call_description"),svgIcon:this.getPhoneIcon(),showCloseBtn:!0,containerClass:"vk_app_modal_container--call_join"},this.isWebOnly=!0,this.useUI=!0}}},800662:(e,t,a)=>{a.d(t,{VKWebAppCallLeft:()=>i});var r=a(290788),s=a(143037);class i extends r.Handler{get successDescriptor(){return`${this.params.handlerName}`}actionHandler(e){this.successHandler({reason:e.reason})}constructor(e){super(e),this.params.handlerName=s.CONNECT_EVENTS.CALL_LEFT}}},191871:(e,t,a)=>{a.d(t,{VKWebAppCallStart:()=>c});var r=a(290788),s=a(957994),i=a(727772),n=a(52905),o=a(105330);class c extends r.Handler{async getCallParams(){const e=(0,i.getAppOptions)();if(!e||!e.aid)return this.errorHandler("App is not found!");if(!e.is_calls_available)return this.errorHandler({code:n.ERROR_CODES.ACCESS_DENIED,reason:"App calls is unavailable!"});try{const t=await(0,s.api)("apps.startCall",{app_id:e.aid}),{join_link:a}=t;if(!a)throw new Error("Calls API didn't return call link");await(0,i.saveCallParams)({joinLink:a,host:!0}),this.successHandler({result:!0,join_link:a})}catch(e){return this.errorHandler(e)}}handler(e,t,a){if(this.setData(e,t),this.callback=a,(0,o.isMvk)())return this.errorHandler({code:n.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:n.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.getCallParams()}constructor(e){super(e),this.params.handlerName="VKWebAppCallStart"}}},579827:(e,t,a)=>{a.d(t,{VKWebAppChangeFragment:()=>s});var r=a(290788);class s extends r.Handler{get successDescriptor(){return this.params.handlerName}actionHandler({location:e}){this.successHandler({location:e})}constructor(e){super(e),this.params.handlerName="VKWebAppChangeFragment"}}},769527:(e,t,a)=>{a.d(t,{VKWebAppClose:()=>p});var r=a(290788),s=a(52905),i=a(105330),n=a(540462),o=a(670053),c=a(898848);class p extends r.Handler{closeMiniAppPage(e){const t=(0,o.getCurrentApp)();if(t.options.layer){const e=this.app.isVKPayApp&&cur.openerAppsQueue&&cur.openerAppsQueue.length>0;let a=!1;const r=curBox?.(),s=t?.containerId;if(r&&s){r?.bodyNode&&r.bodyNode.querySelector(`#${s}`)&&(r.hide(),wkcur.onHide&&(0,c.isFunction)(wkcur.onHide)&&wkcur.onHide(),a=!0)}if(a||WkView.hide(e,!0),!e)return}let a=-1;const r=window.history.length;let s;if(s=(this.app.isTextliveApp||this.app.isVKPayApp)&&e.back_url?e.back_url:"/services",(0,i.isMvk)()&&(0,n.partConfigEnabled)("mini_apps_action_menu_back_button_fix_mvk_app_exit")&&(0,n.partConfigEnabled)("mini_apps_close_app_mvk_history_fix"))window.Apps.onMiniAppClose(s);else{if(cur.VKApp){if(2===cur.VKApp.vkMiniAppsHistoryLength&&!document.referrer||1===cur.VKApp.vkMiniAppsHistoryLength)return void nav.go(s);cur.VKApp.vkMiniAppsHistoryLength!==r&&(a=cur.VKApp.vkMiniAppsHistoryLength-r-1)}!(a<=1)||this.app.isTextliveApp||this.app.isVKPayApp||cur.VKApp&&cur.VKApp.vkMiniAppsHistoryLength&&cur.VKApp.vkMiniAppsHistoryLength>1?window.history.go(a):nav.go(s)}}actionHandler(e){(0,i.isMvk)()?window.opener?(window.opener.postMessage({type:this.params.handlerName,name:this.successDescriptor,eventData:{status:e.status,payload:e.payload}},"*"),window.close()):this.closeMiniAppPage(e):cur.openerAppsQueue&&cur.openerAppsQueue.length>0&&Object.keys(cur.vkAppQueue).length>1?(cur.miniAppOpener&&cur.miniAppOpener.sendIframeMessage(this.successDescriptor,{status:e.status,payload:e.payload}),this.app.isVKPayApp?this.closeMiniAppPage(e):WkView.hide()):this.closeMiniAppPage(e)}handler(e,t,a){this.setData(e,t),this.callback=a;const r=[{param:"status",type:"string",extraChecks:[{check:e=>s.CLOSE_STATUS.includes(e),error:e=>`Param "${e}" should be "success" or "failed"`}]},{param:"payload",type:"object",isRequired:!1}];this.app.isTextliveApp&&r.push({param:"back_url",type:"string",isRequired:!1}),this.checkParams(e,r)&&this.actionHandler(e)}constructor(e){super(e),this.params.handlerName="VKWebAppClose"}}},839549:(e,t,a)=>{a.d(t,{VKWebAppFlashGetInfo:()=>s});var r=a(290788);class s extends r.Handler{actionHandler(e){this.successHandler({is_available:!1})}constructor(e){super(e),this.params.handlerName="VKWebAppFlashGetInfo"}}},149128:(e,t,a)=>{a.d(t,{VKWebAppGetAuthToken:()=>h});var r=a(290788),s=a(914421),i=a(234430),n=a(540462),o=a(52905),c=a(64783),p=a(351118),d=a(105330),l=a(670053),_=a(649446);class h extends r.Handler{get successDescriptor(){return"VKWebAppAccessTokenReceived"}get errorDescriptor(){return"VKWebAppAccessTokenFailed"}scopeList(e){let t=this.app.params.whitelist_scopes?e.filter((e=>~this.app.params.whitelist_scopes.indexOf(e))):e;return t=t.filter(((e,t,a)=>t===a.indexOf(e))),t}checkScopes(e){return 0===e.filter((e=>!this.app.params.whitelist_scopes.includes(e))).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new i.UIAction({...this.params.modal,...e,scopes:this.params.scope.filter(_.scopeFilter),showCloseBtn:!(0,d.isMvk)(),extraAction:this.onEditClick,withScroll:(0,n.partConfigEnabled)("mini_apps_fix_auth_token_modal_scopes_position")});const t=(0,l.getCurrentApp)().isDirectGame?getLang("vkapps_connect_modal_game_request_token_available_title"):getLang("apps_connect_modal_messages_scopes_available");this.editScopesModal=new c.default({...this.params.modal,...e,text:t,scopes:this.params.scope.filter(_.scopeFilter),showCloseBtn:!(0,d.isMvk)(),allowUIAction:this.allowUIAction}),s.default.push(this.modal)}actionHandler(e){return this.callApi?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:(0,l.getCurrentApp)().options[`${o.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:o.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId,...e},{onDone:e=>{if(e.hasOwnProperty("error"))this.errorHandler(e.error);else try{const t=JSON.parse(e);t.access_token?this.successHandler({...t}):this.errorHandler({reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)}):{}}loadIntroData(e){this.request={...e},this.app.appId===e.app_id?ajax.post("apps.php",{act:"handle_vk_connect_event",hash:(0,l.getCurrentApp)().options[`${o.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:o.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId,scope:e.scope},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{const a=JSON.parse(t);this.checkIntroData(a,e)}catch(e){console.log(e),this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)}):this.errorHandler({code:o.ERROR_CODES.INVALID_PARAMS,reason:"Wrong app id"})}checkIntroData(e,t){if(e.status){let t={};e.access_token&&(t.access_token=e.access_token),t.scope=this.params.scope.join(","),this.successHandler(t)}else this.launchUI(t)}handler(e,t,a){this.setData(e,t);const r=(0,n.partConfigEnabled)("mini_apps_filter_method_params")?{app_id:e.app_id,scope:e.scope}:e;if(r&&Array.isArray(r.scope)&&(r.scope=r.scope.join(",")),r.text&&(r.text=(0,p.encodeHTMLEntities)((0,p.escape)(r.text))),this.callback=a,!r.scope&&""!==r.scope)return void this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "scope"'},a);if("string"!=typeof r.scope)return void this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Param "scope" should be a string'},a);if(!r.app_id)return void this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "app_id"'},a);if("number"!=typeof r.app_id)return void this.errorHandler({code:o.ERROR_CODES.MISSING_PARAM,reason:'Param "app_id" should be a number'},a);let s=this.scopeStringToArray(r.scope);s&&this.checkScopes(s)?(this.params.scope=this.scopeList(s),this.loadIntroData(r)):this.errorHandler({code:o.ERROR_CODES.UNKNOWN,error_type:o.ERROR_TYPES.CLIENT,reason:o.ERROR_REASONS.UNKNOWN_ERROR},a)}constructor(e){super(e);const t=(0,l.getCurrentApp)(),a=t.isDirectGame?getLang("vkapps_connect_modal_game_request_token"):getLang("apps_connect_modal_messages_request_token_var");this.params.handlerName="VKWebAppGetAuthToken";const r={title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},s={title:getLang("apps_connect_modal_messages_scopes_edit"),type:"extra"},i={title:getLang("apps_connect_modal_btn_ok"),type:"success",hasCounter:(0,d.isMvk)()};this.params.modal={buttons:(0,d.isMvk)()?[r,s,i]:[r,i],title:a.replace("{app_name}",t.options.app_name)},this.callApi=!0,this.useUI=!0,this.onEditClick=this.onEditClick.bind(this)}}},129378:(e,t,a)=>{a.d(t,{VKWebAppGetClientVersion:()=>o});var r=a(290788),s=a(52905),i=a(105330),n=a(639904);class o extends r.Handler{actionHandler(e){let t=s.PLATFORM.WEB;(0,i.isMvk)()&&(t=s.PLATFORM.MOBILE_WEB),this.successHandler({platform:t,version:"0.0"},!(0,n.isMiniAppServiceAvailable)()&&this.callback)}constructor(e){super(e),this.params.handlerName="VKWebAppGetClientVersion"}}},283083:(e,t,a)=>{a.d(t,{VKWebAppGetCommunityAuthToken:()=>n});var r=a(397088),s=a(143037),i=a(111909);class n extends i.VKWebAppGetCommunityToken{actionHandler(e){(0,r.chooseAction)({handler:s.CONNECT_EVENTS.GET_COMMUNITY_TOKEN,params:{...e,originalHandlerName:s.CONNECT_EVENTS.GET_COMMUNITY_AUTH_TOKEN}},this.app)}constructor(e){super(e),this.params.handlerName="VKWebAppGetCommunityToken",this.params.originalHandlerName="VKWebAppGetCommunityAuthToken"}}},111909:(e,t,a)=>{a.d(t,{VKWebAppGetCommunityToken:()=>l});var r=a(290788),s=a(914421),i=a(234430),n=a(64783),o=a(540462),c=a(52905),p=a(105330),d=a(670053);class l extends r.Handler{scopeList(e){let t=(0,d.getCurrentApp)()?.params.group_whitelist_scopes?e.filter((e=>(0,d.getCurrentApp)().params.group_whitelist_scopes.includes(e))):e;return t=t.filter(((e,t,a)=>t===a.indexOf(e))),t}checkScopes(e){const t=(0,d.getCurrentApp)()?.params.group_whitelist_scopes||"";return 0===e.filter((e=>!t.includes(e))).length}onEditClick(e){this.editScopesModal.renderModal()}launchUI(e){this.createDenyUIAction(),this.createAllowUIAction(e),this.modal=new i.UIAction({...this.params.modal,...e,scopes:this.params.scope,showCloseBtn:!(0,p.isMvk)(),extraAction:this.onEditClick}),this.editScopesModal=new n.default({...this.params.modal,...e,text:getLang("apps_connect_modal_messages_scopes_available"),scopes:this.params.scope,showCloseBtn:!(0,p.isMvk)(),allowUIAction:this.allowUIAction}),s.default.push(this.modal)}takeAction(e){ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),...this.request,...e},{onDone:e=>{this.handleResponse(e,null,this.checkToken)},onFail:()=>{this.errorHandler({code:c.ERROR_CODES.UNKNOWN})}})}checkToken(e){e.access_token?this.successHandler({...e}):this.errorHandler({code:c.ERROR_CODES.INVALID_PARAMS})}loadIntroData(e){this.request={...e},ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,...this.request},{onDone:t=>{this.handleResponse(t,e,this.checkIntroData)},onFail:e=>(this.errorHandler({code:c.ERROR_CODES.ACCESS_DENIED}),!0)})}allowUIAction(e){this.takeAction(e),s.default.pop(this.modal)}checkIntroData(e,t){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("scope"))this.successHandler({access_token:e.access_token,scope:e.scope});else if(e.hasOwnProperty("status")){if(!e.hasOwnProperty("group"))return this.errorHandler({code:c.ERROR_CODES.ACCESS_DENIED,reason:c.ERROR_REASONS.USER_IS_NOT_GROUP_ADMIN});e.group.photo_100&&(t.pic=e.group.photo_100),e.group.name&&(t.title=getLang("apps_group_access_request").replace("%s",e.group.name)),this.launchUI({...t,scopes:this.scopeStringToArray(t.scope)})}}handler(e,t,a){this.setData(e,t),this.callback=a;const r=(0,o.partConfigEnabled)("mini_apps_filter_method_params")?{scope:e.scope,app_id:e.app_id,group_id:e.group_id}:e;if(!this.checkParams(r,[{param:"scope",type:"string",isRequired:!0},{param:"app_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]},{param:"group_id",type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}]))return;let s=this.scopeStringToArray(r.scope);s&&this.checkScopes(s)?(this.params.scope=this.scopeList(s),this.loadIntroData(r)):this.errorHandler({code:c.ERROR_CODES.UNKNOWN,error_type:c.ERROR_TYPES.CLIENT,reason:c.ERROR_REASONS.UNKNOWN_ERROR},a)}actionHandler(e){this.loadIntroData(e)}constructor(e){super(e),this.params.handlerName="VKWebAppGetCommunityToken";const t={title:getLang("apps_connect_modal_btn_cancel"),type:"deny",dataTestId:"apps_get_community_token_modal_cancel_button"},a={title:getLang("apps_connect_modal_messages_scopes_edit"),type:"extra",dataTestId:"apps_get_community_token_modal_edit_scopes_button"},r={title:getLang("apps_connect_modal_btn_ok"),type:"success",dataTestId:"apps_get_community_token_modal_confirm_button",hasCounter:(0,p.isMvk)()};this.params.modal={buttons:(0,p.isMvk)()?[t,a,r]:[t,r],title:getLang("apps_connect_modal_messages_community_request_token")},this.callApi=!0,this.useUI=!0,this.allowUIAction=this.allowUIAction.bind(this),this.checkToken=this.checkToken.bind(this),this.checkIntroData=this.checkIntroData.bind(this),this.onEditClick=this.onEditClick.bind(this)}}},916775:(e,t,a)=>{a.d(t,{VKWebAppGetEmail:()=>n});var r=a(290788),s=a(52905),i=a(670053);class n extends r.Handler{loadIntroData(e){this.request={...e},ajax.post("apps.php",{act:"handle_vk_connect_event",hash:(0,i.getCurrentApp)().options[`${s.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:s.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{const a=JSON.parse(t);this.checkIntroData(a,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.hasOwnProperty("email")&&e.sign?this.successHandler(e):this.launchUI(t)}handler(e,t,a){this.setData(e,t),this.callback=a,this.loadIntroData()}constructor(e){super(e),this.params.handlerName="VKWebAppGetEmail",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:getLang("apps_connect_modal_messages_request_email"),text:getLang("apps_connect_modal_messages_request_email_text")},this.callApi=!0,this.useUI=!0}}},285198:(e,t,a)=>{a.d(t,{VKWebAppGetPhoneNumber:()=>n});var r=a(290788),s=a(52905),i=a(670053);class n extends r.Handler{loadIntroData(e){this.request={...e},ajax.post("apps.php",{act:"handle_vk_connect_event",hash:(0,i.getCurrentApp)().options[`${s.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`]}_hash`],event:s.VK_CONNECT_EVENTS[`${this.params.handlerName}Preload`],app_id:this.app.appId},{onDone:t=>{if(t.hasOwnProperty("error"))this.errorHandler(t.error);else try{const a=JSON.parse(t);this.checkIntroData(a,e)}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}checkIntroData(e,t){e.hasOwnProperty("phone_number")&&e.sign?this.successHandler(e):this.launchUI(t)}handler(e,t,a){this.setData(e,t),this.callback=a,this.loadIntroData()}constructor(e){super(e),this.params.handlerName="VKWebAppGetPhoneNumber",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny",dataTestId:"confirmation_modal_action_deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success",dataTestId:"confirmation_modal_action_confirm"}],title:getLang("apps_connect_modal_messages_request_phone"),text:getLang("apps_connect_modal_messages_request_phone_text")},this.callApi=!0,this.useUI=!0}}},414753:(e,t,a)=>{a.d(t,{VKWebAppGetSilentToken:()=>p});var r=a(105330),s=a(19589),i=a(52905),n=a(494565),o=a(290788),c=a(670053);class p extends o.Handler{launchUI(e){const{params:t}=this.app;if(this.prevAppContainerHeight=(0,c.getCurrentApp)().frame.offsetHeight,void 0===t.need_policy_confirmation)return this.errorHandler(i.ERROR_REASONS.UNSUPPORTED_ACTION);t.need_policy_confirmation?this.initIframe():this.getSilentTokenForce()}initIframe(){const e=this.getIframeUrl();this.vkConnectIframe=this.createIframe(e),(0,r.isMvk)()||this.resizeHeightContainer(528);const t=this.app.vkApp.frame;this.appIframeParent=t.parentNode,this.prevAppIframeParentPosition=this.appIframeParent.style.position,this.appIframeParent.style.position="relative",this.appIframeParent.appendChild(this.vkConnectIframe),window.addEventListener("message",this.iframeHandler)}createIframe(e){const t=document.createElement("iframe");return t.src=e,t.width="100%",t.height="100%",t.frameBorder="0",t.style.cssText="\n      position: absolute;\n      left: 0;\n      top: 0;\n      background: transparent;\n      height: 100%;\n    ",t}destroyIframe(){this.vkConnectIframe.remove(),this.appIframeParent.style.position=this.prevAppIframeParentPosition,this.appIframeParent=null,this.vkConnectIframe=null,(0,r.isMvk)()||this.resizeHeightContainer(this.prevAppContainerHeight),window.removeEventListener("message",this.iframeHandler)}iframeHandler(e){const{vkApp:t}=this.app,a=t.options.vk_app_connect_host,r=(0,n.getHostName)(e.origin)===(0,n.getHostName)(`https://${a}`);e.data&&e.data.type===i.VK_CONNECT_SUPERAPPKIT_EVENT_TYPE&&r&&(e.data.params.error?this.errorHandler(i.ERROR_REASONS.UNKNOWN_ERROR):(this.app.params.need_policy_confirmation=!1,this.successHandler(e.data.params)),this.destroyIframe())}getIframeUrl(){const{vkApp:e}=this.app;return`https://${e.options.vk_app_connect_host}/mini_app_confirm_policy${(0,n.objectToQuerystring)({app_id:this.app.appId,origin:location.origin,theme:s.colorScheme.isDarkScheme()?"dark":"light"})}`}getSilentTokenForce(){return ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId},{onDone:e=>{this.handleResponse(e,{},this.checkResponse)},onFail:e=>(this.errorHandler(e),!0)})}resizeHeightContainer(e){const t=(0,c.getCurrentApp)();t.frame.style.height=`${e}px`,this.app.vkApp.options.boxed||(t.cont.style.height=`${e}px`)}constructor(e){super(e),this.params.handlerName="VKWebAppGetSilentToken",this.useUI=!0,this.vkConnectIframe=null,this.appIframeParent=null,this.prevAppContainerHeight=0,this.prevAppIframeParentPosition="",this.iframeHandler=this.iframeHandler.bind(this)}}},626898:(e,t,a)=>{a.d(t,{VKWebAppLocationChanged:()=>s});var r=a(290788);class s extends r.Handler{get successDescriptor(){return`${this.params.handlerName}`}actionHandler(e){this.successHandler({location:e.location})}constructor(e){super(e),this.params.handlerName="VKWebAppLocationChanged"}}},617540:(e,t,a)=>{a.d(t,{VKWebAppOpenApp:()=>d});var r=a(290788),s=a(52905),i=a(494565),n=a(957994),o=a(105330),c=a(540462),p=a(670053);class d extends r.Handler{actionHandler(e){if(this.isOpeningInLayerRestricted(e.app_id))return void this.errorHandler({code:s.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:s.ERROR_REASONS.UNSUPPORTED_PLATFORM});if(this.app.appId===e.app_id&&!(0,i.isVKPayApp)(parseInt(this.app.appId,10)))return void this.errorHandler({code:s.ERROR_CODES.CUSTOM,reason:"Same app id as origin"});let t={open_app_id:e.app_id};this.openAppId=e.app_id,e.location&&(t.location=e.location),this.openApp={...t},(0,c.partConfigEnabled)("open_app_bridge_event_to_api")?this.callWithApi(e):this.callWithAct(t,e)}isOpeningInLayerRestricted(e){return!(0,o.isMvk)()&&(0,c.partConfigEnabled)("third_level_domain_apps")&&(0,c.getConfigValue)("special_subdomains_groups").some((([,,t])=>t===`app${e}`))}callWithAct(e,t){ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,...e},{onDone:e=>{try{const a=JSON.parse(e);a.hasOwnProperty("original_url")?(this.successHandler({result:!0}),this.openAppInLayer(a.original_url,t.app_id)):a.hasOwnProperty("error")&&this.errorHandler({code:s.ERROR_CODES.INVALID_PARAMS,reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}callWithApi(e){(0,n.api)("apps.getEmbeddedUrl",{app_id:e.app_id}).then((t=>{if(t.hasOwnProperty("original_url")){this.successHandler({result:!0});const a=t.original_url.replace(/.+vk\..+\//,""),r=e.location?`#${e.location}`:"";this.openAppInLayer(`${a}${r}`,e.app_id)}else t.hasOwnProperty("error")&&this.handleApiError(t)})).catch((e=>{this.handleApiError(e)}))}openAppInLayer(e,t){(0,o.isMvk)()?(0,p.getCurrentApp)().openAppInLayer(e,!0):((0,p.getCurrentApp)().openAppInLayer(e,(()=>(0,i.destroyOpenedApp)(t))),cur.miniAppOpener||(cur.miniAppOpener=this.app))}handler(e,t,a){if(this.setData(e,t),this.callback=a,this.app.isMiniAppWidget)return void this.errorHandler({code:s.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenApp from widget"},a);this.checkParams(e,[{param:"app_id",type:"number",isRequired:"true"},{param:"location",type:"string"}])&&this.actionHandler(e)}createUrl(e){return`app${e.app_id}${e.hasOwnProperty("location")?`#${e.location}`:""}`}constructor(e){super(e),this.params.handlerName="VKWebAppOpenApp"}}},922609:(e,t,a)=>{a.d(t,{VKWebAppOpenArticle:()=>l});var r=a(290788),s=a(581197),i=a(105330),n=a(52905),o=a(670053),c=a(540462);const p=(0,i.getHostName)().replace(".","\\."),d=new RegExp(`^https://(?:(?:.*).)*${p}(/@[a-z0-9_-]+)$`,"im");class l extends r.Handler{launchUI(e){if((0,c.partConfigEnabled)("remove_VKWebAppOpenArticle_handler"))return void this.errorHandler({code:n.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:"This method is no longer supported"});const{url:t=""}=e,a=t.match(d);if(!a||!a[1])return void this.errorHandler({code:n.ERROR_CODES.INVALID_PARAMS,reason:`Error: incorrect url: ${t}`});const r=a[1];if((0,i.isMvk)()){const e=window.location.pathname.substr(1);window.nav.go(`${r}?from=${e}`)}else(0,s.show)(boxLoader),(0,s.show)(boxLayerWrap),window.boxRefreshCoords(boxLoader),window.articlePrepare(r,{onFailCallBack:()=>{(0,s.hide)(boxLoader),(0,s.hide)(boxLayerWrap),this.errorHandler({code:n.ERROR_CODES.UNKNOWN,error_type:n.ERROR_TYPES.CLIENT,reason:"ServerError: Can't open article."})}},(()=>{(0,s.hide)(boxLoader),(0,s.hide)(boxLayerWrap),window.nav.go(r),this.successHandler({result:!0})}))}successReadHandler(e){this.callback({type:"VKWebAppArticleClosed",data:e},this.params.handlerName),(0,i.isMvk)()&&(0,o.getCurrentApp)().frame.focus()}constructor(e){super(e),this.params.handlerName="VKWebAppOpenArticle",this.callApi=!1,this.useUI=!0}}},684404:(e,t,a)=>{a.d(t,{VKWebAppOpenArticleEditor:()=>c});var r=a(290788),s=a(52905),i=a(810068),n=a(540462),o=a(670053);class c extends r.Handler{launchUI(e){if((0,n.partConfigEnabled)("mini_apps_disable_vk_web_app_open_article_editor"))this.errorHandler({code:s.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:"This method is no longer supported"});else if((0,o.getCurrentApp)().params.open_article_edit&&!window.isMvk){const{owner_id:t,article_id:a}=e,r="number"==typeof t,o="number"==typeof a;((0,n.partConfigEnabled)("mini_apps_long_id")?i.Ranges.isOwnerId(t):Boolean(t))&&r?a&&!o?this.errorHandler({code:o?s.ERROR_CODES.MISSING_PARAM:s.ERROR_CODES.INVALID_PARAMS,reason:`Param "article_id" is wrong. Expected integer greater than 0, got type ${typeof a} with value ${a}.`}):window.openArticleEditor&&window.openArticleEditor(t,a,null,{app_id:this.app.appId,app_hash:this.getEventHash()},{from:"app",eventHandler:this.successHandler.bind(this),errorHandler:this.errorWrapper.bind(this)}):this.errorHandler({code:r?s.ERROR_CODES.MISSING_PARAM:s.ERROR_CODES.INVALID_PARAMS,reason:`Param "owner_id" is missing or wrong. Expected integer, got type ${typeof t} with value ${t}.`})}else this.errorHandler({code:s.ERROR_CODES.CUSTOM,reason:window.isMvk?"ClientError: This handler is forbidden on this platform":"ClientError: This app isn't allowed to use this handler"})}errorWrapper(e){this.errorHandler({code:s.ERROR_CODES.CUSTOM,reason:e})}constructor(e){super(e),this.params.handlerName="VKWebAppOpenArticleEditor",this.callApi=!1,this.useUI=!0,this.launchUI=this.launchUI.bind(this)}}},752784:(e,t,a)=>{a.d(t,{VKWebAppOpenInNativeApp:()=>n});var r=a(290788),s=a(52905),i=a(105330);class n extends r.Handler{actionHandler(e){const{ipad:t,iphone:a,android:r}=window.browser;if((0,i.isMvk)()&&(t||a||r)){if(!this.checkParams(e,[{param:"link",type:"string",isRequired:!0}]))return;this.openInNativeApp(e.link)}else this.errorHandler({code:s.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:s.ERROR_REASONS.UNSUPPORTED_PLATFORM})}openInNativeApp(e){if(this._openAppInProgress)return!1;const t="vk://vk.com/"+e;let a=browser.mi?1500:300;browser.safari&&(a=browser.ios>=12?2800:300);const r=Date.now(),i=setTimeout((()=>{this._openAppInProgress=!1,Date.now()-r>a+200||!document.hasFocus()?this.successHandler({result:!0}):(nav.hard_go("https://vk.cc/dl"),this.errorHandler({code:s.ERROR_CODES.CUSTOM,reason:s.ERROR_REASONS.NATIVE_APP_IS_NOT_INSTALLED}))}),a),n=()=>{clearTimeout(i),this._openAppInProgress=!1,window.removeEventListener("blur",n)};if(window.addEventListener("blur",n),browser.ios){const e=()=>{window.removeEventListener("focus",e)};window.addEventListener("focus",e)}return this._openAppInProgress=!0,nav.hard_go(t),!1}constructor(e){super(e),this.params.handlerName="VKWebAppOpenInNativeApp",this.useUI=!1,this.isMobileWebOnly=!0}}},491003:(e,t,a)=>{a.d(t,{VKWebAppOpenPayForm:()=>c});var r=a(290788),s=a(52905),i=a(105330),n=a(670053),o=a(639904);class c extends r.Handler{actionHandler(e){this.app.isMiniAppWidget?this.errorHandler({code:s.ERROR_CODES.CUSTOM,reason:"You can not call VKWebAppOpenPayForm from widget"}):e.action?"string"==typeof e.action?e.params?e.hasOwnProperty("app_id")&&"number"!=typeof e.app_id?this.errorHandler({code:s.ERROR_CODES.MISSING_PARAM,reason:'"app_id" param should be an integer number'}):(0,n.getCurrentApp)()?.isDirectGame?this.errorHandler({code:s.ERROR_CODES.CUSTOM,reason:"This event supported only for services"}):super.actionHandler(e):this.errorHandler({code:s.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "params"'}):this.errorHandler({code:s.ERROR_CODES.MISSING_PARAM,reason:'Param "action" should be a string'}):this.errorHandler({code:s.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "action"'})}openPayApp(e){let t={...e.params};t.action=e.action;(0,n.getCurrentApp)().openExternalApp("miniapps_vkpay",t,this.errorHandler)}checkTransaction(e){const t=!(0,i.isMvk)()||e.origin===location.origin;e.data&&"vk-connect"===e.data.type?e.data.handler===s.VKPAY_TRANSACTION_EVENT&&t&&(e.data.params.status?this.successHandler({...e.data.params},!(0,o.isMiniAppServiceAvailable)()&&this.callback):this.errorHandler({code:s.ERROR_CODES.USER_DENIED,reason:s.ERROR_REASONS.USER_DENIED}),(0,i.isMvk)()||this.destroyVkPayContainer()):e.data&&e.data.externalAppClosed&&this.errorHandler({code:s.ERROR_CODES.USER_DENIED,reason:s.ERROR_REASONS.USER_DENIED})}destroyVkPayContainer(){window.removeEventListener("message",this.checkTransaction)}launchVkPayContainer(e){this.openPayApp(e),window.addEventListener("message",this.checkTransaction)}checkResponse(e,t){e?this.launchVkPayContainer(t):this.errorHandler({code:s.ERROR_CODES.ACCESS_DENIED,reason:s.ERROR_REASONS.VK_PAY_DISABLED,error_type:s.ERROR_TYPES.CLIENT})}constructor(e){super(e),this.params.handlerName="VKWebAppOpenPayForm",this.checkTransaction=this.checkTransaction.bind(this),this.destroyVkPayContainer=this.destroyVkPayContainer.bind(this)}}},249879:(e,t,a)=>{a.d(t,{VKWebAppOpenReportForm:()=>d});var r=a(290788),s=a(52905),i=a(540462),n=a(105330),o=a(969686);const c=["situational_post"],p=[...c,"community","authors_marketplace_offer","nft","user","app","article","video","photo","photo_comment","video_comment","market_comment","market","wall","wall_comment","post","comment","poll","board_poll","story","narrative","textpost","textlive","ad"];class d extends r.Handler{checkFields(e){return this.checkParams(e,[{param:"type",type:"string",isRequired:!0,extraChecks:[{check:e=>p.includes(e),error:()=>s.ERROR_REASONS.UNKNOWN_ERROR}]},{param:"item_id",type:(t=(e||{}).type,"nft"===t?"string":"number")}]);var t}actionHandler(e){this.checkFields(e)&&("community"===e.type&&(e={...e,group_id:e.group_id??e.owner_id}),(0,n.isMvk)()?this.openReportsApp(e):this.openReportBox(e))}getShowReportFormParams(e){switch(e.type){case"user":return{item_id:e.item_id,owner_id:e.user_id};case"community":return{item_id:e.item_id,owner_id:e.group_id};case"app":return{item_id:e.app_id,owner_id:e.owner_id};default:return{item_id:e.item_id,owner_id:e.owner_id}}}openReportBox(e){window.stManager.add([window.jsc("web/reports.js"),"reports.css"]).then((()=>{const t=e=>{e?this.successHandler({success:!0}):this.errorHandler({reason:s.ERROR_REASONS.USER_DENIED,code:s.ERROR_CODES.USER_DENIED})};if(c.includes(e.type))return window.showReportBox(e.type,e.owner_id,e.item_id,t);if((0,i.partConfigEnabled)("vk_web_app_open_report_form")){const{item_id:t,owner_id:a}=this.getShowReportFormParams(e);return window.showReportForm(e.type,a,t,null,null,null,e.from,e.ad_data)}})).catch((()=>this.errorHandler({code:s.ERROR_CODES.UNKNOWN})))}openReportsApp(e){if(!(0,i.partConfigEnabled)("mini_apps_open_report_form_mvk"))return;const t=`/vkui/reports?${(0,o.toQueryString)({type:e.type,item_id:e.item_id,owner_id:e.owner_id,ad_data:e.ad_data,app_id:e.app_id,user_id:e.user_id,group_id:e.group_id,from:e.from,back_url:window.location.href.replace(window.location.origin,"")})}`;window.nav.go(t)}constructor(e){super(e),this.params.handlerName="VKWebAppOpenReportForm"}}},845005:(e,t,a)=>{a.d(t,{VKWebAppOpenWallPost:()=>l});var r=a(290788),s=a(52905),i=a(810068),n=a(540462),o=a(670053),c=a(816980);const p="owner_id",d="post_id";class l extends r.Handler{_validateParams(e){return this.checkParams(e,[{param:p,type:"number",isRequired:!0,extraChecks:(0,n.partConfigEnabled)("mini_apps_long_id")?[{check:e=>i.Ranges.isOwnerId(e),error:e=>`Param "${e}" should be a valid user id`}]:void 0},{param:d,type:"number",isRequired:!0,extraChecks:[{check:e=>e>0,error:e=>`Param "${e}" should be a positive number`}]}])}actionHandler(e){this._validateParams(e)&&this._openLayer(e)}_openLayer(e){const t=`wall${e[p]}_${e[d]}`,a={w:t},r=(0,o.getCurrentApp)();(0,c.isSpaLaunch)()&&r?.options?.layer?(window.open(`${window.location.origin}/${t}`,"_blank"),this.successHandler({result:!0})):window.showWiki(a,null,null,{queue:1,onLoaded:()=>{this.successHandler({result:!0})},onFail:()=>(this.errorHandler({code:s.ERROR_CODES.UNKNOWN,reason:s.ERROR_REASONS.UNKNOWN_ERROR}),!0)})}constructor(e){super(e),this.params.handlerName="VKWebAppOpenWallPost",this.isWebOnly=!0}}},321401:(e,t,a)=>{a.d(t,{VKWebAppRecommend:()=>_});var r=a(290788),s=a(957994),i=a(105330),n=a(914421),o=a(935509),c=a(56410),p=a(670053),d=a(52905),l=a(816980);class _ extends r.Handler{denyUIAction(...e){super.denyUIAction(...e),this.app.vkApp.unlockModalType(c.RECOMMENDATION_MODAL_TYPE)}allowUIAction(){(0,s.api)("apps.recommend",{app_id:cur.aid??(0,p.getCurrentApp)()?.options.aid,is_recommended:1}).then((()=>{(0,p.getCurrentApp)().options.is_recommended=!0,this.successHandler({result:!0}),(0,i.isMvk)()||(0,l.isSpaLaunch)()||window.Apps.updateRecommendAction(!0),(0,l.isSpaLaunch)()&&(0,p.getCurrentApp)()?.updateAppData?.({isRecommended:!0})})).catch((()=>{this.successHandler({result:!1})})),n.default.pop(this.modal),this.app.vkApp.unlockModalType(c.RECOMMENDATION_MODAL_TYPE)}handler(e,t,a){const r=(0,p.getCurrentApp)();this.callback=a,this.setData(e,t),r.options.is_recommended_available?this.app.vkApp.isModalTypeLocked(c.RECOMMENDATION_MODAL_TYPE)||r.options.is_recommended?this.successHandler({result:!0}):((0,i.isMvk)()&&this.params.modal.buttons.reverse(),this.app.vkApp.lockModalType(c.RECOMMENDATION_MODAL_TYPE),this.launchUI(e)):this.errorHandler({code:d.ERROR_CODES.ACCESS_DENIED,reason:d.ERROR_REASONS.UNSUPPORTED_ACTION})}constructor(e){super(e),this.params.handlerName="VKWebAppRecommend",this.useUI=!0,this.params.modal={containerClass:"MiniAppsRecommendUI",buttons:[{title:getLang("apps_connect_modal_btn_undo"),type:"deny"},{title:getLang("apps_connect_modal_btn_recommend"),type:"success"}],title:getLang("apps_connect_modal_title_recommend"),text:getLang("apps_connect_modal_description_recommend"),showCloseBtn:!(0,i.isMvk)(),isNoWrapButtons:!0,svgIcon:(0,o.getIcon56ThumbsUpOutline)().icon},this.allowUIAction=this.allowUIAction.bind(this)}}},68554:(e,t,a)=>{a.d(t,{VKWebAppRemoveFromProfile:()=>o});var r=a(290788),s=a(105330),i=a(576592),n=a(458817);class o extends r.Handler{actionHandler(e){if((0,i.isProfileButtonAvailable)())if((0,i.isProfileButtonInstalled)()){if(!(0,s.isMvk)())return this.removeFromProfileSuccess=this.removeFromProfileSuccess.bind(this),this.removeFromProfileFailed=this.removeFromProfileFailed.bind(this),void window.Apps.loadRemoveFromProfile().then(this.removeFromProfileSuccess).catch(this.removeFromProfileFailed);(0,n.setRemoveFromProfileBridgeContext)(this),window.MiniAppsProfileButtons.showRemoveFromProfile()}else this.removeFromProfileSuccess()}removeFromProfileSuccess(){this.successHandler({result:!0})}removeFromProfileFailed(e){this.errorHandler({code:e})}constructor(e){super(e),this.params.handlerName="VKWebAppRemoveFromProfile"}}},420136:(e,t,a)=>{a.d(t,{VKWebAppSendCustomEvent:()=>O});var r=a(957994),s=a(105330),i=a(290788),n=a(52905),o=a(810068),c=a(540462),p=a(670053);const d="type",l="timezone",_="event",h="json",u="screen",m="timestamp",g="vk_platform",v={TYPE_NAVGO:"type_navgo",TYPE_VIEW:"type_view",TYPE_CLICK:"type_click",TYPE_ACTION:"type_action"},A="type",E="timezone",f="event",S="json",b="screen",w="client_time",R="mini_app_id",C="url",k="vk_platform",y="user_id";class O extends i.Handler{_validateParams(e){return this.checkParams(e,[{param:d,type:"string",extraChecks:[{check:e=>Object.values(v).includes(e),error:e=>`Param "${e}" should be one of ${Object.values(v)}`}]},{param:l,type:"string"},{param:_,type:"string",isRequired:!0},{param:h,type:"string"},{param:u,type:"string"},{param:m,type:"number"},{param:y,type:"number",extraChecks:(0,c.partConfigEnabled)("mini_apps_long_id")?[{check:e=>o.Ranges.isUserId(e),error:e=>`Param "${e}" should be a valid user id`}]:void 0}])}_buildEvent(e){const t=(0,p.getCurrentApp)(),a=e[d]||v.TYPE_ACTION,r=t.params.hash?`#${t.params.hash}`:"",i=t.options.vk_app_url+r;return{[A]:a,[a]:{type:"type_mini_app_custom_event_item"},[E]:e[l]||"",[f]:e[_],[S]:e[h]||"",[b]:e[u]||"none",[w]:e[m]||Date.now(),[R]:t.options.aid,[C]:i,[k]:e[g]??((0,s.isMvk)()?"mobile_web":"desktop_web"),[y]:window.vk.id}}actionHandler(e){if(!this._validateParams(e))return;const t=this._buildEvent(e);(0,r.api)("statEvents.addMiniApps",{events:JSON.stringify([t])}).then((e=>{this.successHandler({result:!0})})).catch((e=>{this.errorHandler({code:n.ERROR_CODES.CUSTOM,reason:e?.error?.error_msg||n.ERROR_REASONS.UNKNOWN_ERROR})}))}constructor(e){super(e),this.FLOOD_RATE={eventsCount:16,timeFrame:2},this.params.handlerName="VKWebAppSendCustomEvent"}}},453015:(e,t,a)=>{a.d(t,{VKWebAppSendPayload:()=>n});var r=a(290788),s=a(52905),i=a(670053);class n extends r.Handler{handler(e,t,a){if(this.setData(e,t),this.callback=a,e.group_id)if("number"==typeof e.group_id)if(e.hasOwnProperty("payload")&&"object"!=typeof e.payload)this.errorHandler({code:s.ERROR_CODES.INVALID_PARAMS,reason:'"payload" param should be an object'},a);else{try{e.payload=JSON.stringify(e.payload)}catch(e){this.errorHandler({code:s.ERROR_CODES.INVALID_PARAMS,reason:'Param "payload" is not valid JSON object'},a)}this.actionHandler(e)}else this.errorHandler({code:s.ERROR_CODES.INVALID_PARAMS,reason:'Param "group_id" should be a number'},a);else this.errorHandler({code:s.ERROR_CODES.INVALID_PARAMS,reason:'Missing required param "group_id"'},a)}actionHandler(e){return ajax.post("apps.php",{act:"handle_vk_connect_event",hash:(0,i.getCurrentApp)().options[`${s.VK_CONNECT_EVENTS[this.params.handlerName]}_hash`],event:s.VK_CONNECT_EVENTS[this.params.handlerName],app_id:this.app.appId,...e},{onDone:t=>{try{const a=JSON.parse(t);a.hasOwnProperty("error")?this.errorHandler(a.error,this.callback,s.ERROR_TYPES.API):a.status?this.successHandler({...a,scope:e.scope}):this.errorHandler({reason:"Invalid params"})}catch(e){this.errorHandler(e)}},onFail:e=>(this.errorHandler(e),!0)})}constructor(e){super(e),this.params.handlerName="VKWebAppSendPayload",this.callApi=!0,this.useUI=!1}}},976727:(e,t,a)=>{a.d(t,{VKWebAppSendToClient:()=>i});var r=a(290788),s=a(670053);class i extends r.Handler{handler(e,t,a){this.setData(e,t),this.props=e,this.callback=a,this.loadIntroData()}loadIntroData(e){ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId},{onDone:t=>{const a=JSON.parse(t);this.checkIntroData(a,e)},onFail:()=>{this.sendNetworkError()}})}checkIntroData(e,t){e.result?this.actionHandler():this.launchUI(t)}actionHandler(){return new Promise(((e,t)=>{ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(),event:this.getEventName(),app_id:this.app.appId,group_id:this.props.group_id,fragment:this.props.fragment,al:1,cid:0,ref:0},{onDone:t=>{e(t)},onFail:e=>{t(e)}})})).then((()=>{this.successHandler({result:!0})})).catch((()=>{this.sendNetworkError()}))}constructor(e){super(e);const t=getLang("apps_connect_modal_messages_send_install_push");this.params.handlerName="VKWebAppSendToClient",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_ok"),type:"success"}],title:t.replace("{app_name}",(0,s.getCurrentApp)().options.app_name)},this.callApi=!0,this.useUI=!0}}},160608:(e,t,a)=>{a.d(t,{VKWebAppSetLocation:()=>p});var r=a(290788),s=a(52905),i=a(105330),n=a(397088),o=a(143037),c=a(670053);class p extends r.Handler{actionHandler(e){e.hasOwnProperty("location")?"string"==typeof e.location?((0,i.isMvk)()?nav.set({replace:!0,nav:{push:location.pathname+location.search+"#"+e.location,path:location.pathname,hash:"#"+e.location}}):e.replace_state?history.replaceState(null,null,`#${e.location}`):(0,c.getCurrentApp)().setLocation(e.location),this.app?.sendEventToMiniApp?this.app.sendEventToMiniApp(o.CONNECT_EVENTS.LOCATION_CHANGED,{location:e.location}):(0,n.chooseAction)({handler:o.CONNECT_EVENTS.LOCATION_CHANGED,params:{location:e.location}},this.app),this.successHandler({result:!0})):this.errorHandler({code:s.ERROR_CODES.INVALID_PARAMS,reason:'Param "location" should be a string'}):this.errorHandler({code:s.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "location"'})}constructor(e){super(e),this.params.handlerName="VKWebAppSetLocation"}}},290348:(e,t,a)=>{a.d(t,{VKWebAppShare:()=>d});var r=a(957994),s=a(290788),i=a(52905),n=a(105330),o=a(540462),c=a(670053),p=a(506856);class d extends s.Handler{successHandler(e){super.successHandler([e])}actionHandler(e){this.checkParams(e,[{param:"link",type:"string"},{param:"user_id",type:"number"},{param:"text",type:"string"}])&&(e.link=e.link||this.getAppUrlWithHash(),!(0,o.partConfigEnabled)("app_share_bridge_event_to_api")||(0,n.isMvk)()?(0,n.isMvk)()?this.handleMvk(e):this.handleWeb(e):this.shareWithApi(e))}async handleWeb({link:e,user_id:t,text:a}){const r=String(e),s=r?.startsWith(`https://${(0,n.getHostName)()}/textlive`);if(s)return void this.shareTextlive(r);this.shareEmitters();const c=/app([0-9]+_-?[0-9]+)/.exec(r),[d,l]=(0,o.partConfigEnabled)("mini_apps_add_context_check_in_share_bridge_method_web")&&c?c[1].split("_"):[this.appId,this.userId];if((0,o.partConfigEnabled)("mini_apps_share_to_user"))try{const[e]=await Promise.all([t?this.getUserInfo(t):null,this.showWebShareBoxAsync({appId:d,ownerId:l,link:r})]);e&&(window.ShareBox.appendUserToSelected(e),a&&window.ShareBox.addSharedText(a))}catch(e){this.errorHandler({code:i.ERROR_CODES.UNKNOWN}),(0,p.error)(e)}else this.share(d,l,r)}async handleMvk({link:e,user_id:t,text:a}){this.shareEmitters();const r=e?[e,"","",""]:[this.getAppUrlWithHash(),cur.appShareParams.sharePhoto,cur.appShareParams.shareTitle,cur.appShareParams.shareDesc];if((0,o.partConfigEnabled)("mini_apps_share_to_user"))try{const[e]=await Promise.all([t?this.getUserInfo(t):null,this.showMvkShareBoxAsync(...r)]);e&&(window.cur.share.appendUserToSelected(e),a&&window.cur.share.addSharedText(a))}catch(e){this.errorHandler({code:i.ERROR_CODES.UNKNOWN}),(0,p.error)(e)}else(0,c.getCurrentApp)().shareBox(...r)}shareWithApi(e){const t={link:e.link};this.app.vkApp.options.is_internal_app&&(t.targetUserId=e.user_id,t.text=e.text),this.showBridgeModal(this.app,{type:"AppShareModal",data:t,actions:{onClose:()=>{this.errorHandler({code:i.ERROR_CODES.USER_DENIED,error_type:i.ERROR_TYPES.CLIENT,reason:i.ERROR_REASONS.USER_DENIED})},onDone:e=>{this.successHandler(e)},onError:e=>{this.handleApiError(e)}}})}showWebShareBoxAsync({appId:e,ownerId:t,link:a}){return new Promise(((r,s)=>{this.share(e,t,a,r,s)}))}showMvkShareBoxAsync(e,t,a,r){return new Promise((s=>{(0,c.getCurrentApp)().shareBox(e,t,a,r,s)}))}share(e,t,a,r,s){const n=new URL(a).hash;window.showBox("like.php",{act:"publish_box",object:"app"+e+"_"+t,url_hash:n},{onDone:r,onFail:s??(()=>{this.errorHandler({code:i.ERROR_CODES.UNKNOWN},this.callback)}),params:{onHide:()=>{setTimeout((()=>{(0,c.getCurrentApp)().vkMiniAppShareSuccess&&this.errorHandler({code:i.ERROR_CODES.USER_DENIED},this.callback)}),1e3)}}})}async getUserInfo(e){const{items:t}=await(0,r.api)("users.search",{q:`id${e}`,from_list:"friends",fields:"photo_200"}),[a=null]=t;return a}shareTextlive(e){let t="";t=e.includes("post_id")?e.replace(/(.*)textlive(\d+)(.*)=(\d+)/i,"textpost$2_$4"):e.replace(/(.*)textlive(\d+)(.*)/i,"textlive$2_0"),window.showBox("like.php",{act:"publish_box",object:t},{onFail:()=>{this.errorHandler({code:i.ERROR_CODES.UNKNOWN},this.callback)},params:{onHide:()=>{setTimeout((()=>{(0,c.getCurrentApp)().vkMiniAppShareSuccess&&this.errorHandler({code:i.ERROR_CODES.USER_DENIED},this.callback)}),1e3)}}})}cleanEmitters(){const e=(0,c.getCurrentApp)();e.vkMiniAppShareSuccess=null,e.vkMiniAppShareFail=null}shareEmitters(){const e=(0,c.getCurrentApp)();e.vkMiniAppShareSuccess=(e,t)=>{e.post_id?this.successHandler({type:"post",post_id:`${e.owner_id}_${e.post_id}`}):"number"==typeof e&&(Array.isArray(t)?this.successHandler({type:"message",users:t}):this.successHandler({type:"message"})),this.cleanEmitters()},e.vkMiniAppShareFail=e=>{e?this.errorHandler(e):this.errorHandler({code:i.ERROR_CODES.USER_DENIED}),this.cleanEmitters()}}getAppUrlWithHash(){const e=new URL(window.document.location.href).hash;return`https://${(0,n.getHostName)()}/app${this.appId}${e}`}constructor(e){super(e);const t=(0,c.getCurrentApp)();this.params.handlerName="VKWebAppShare",this.appId=t.params.api_id,this.userId=t.params.viewer_id}}},666554:(e,t,a)=>{a.d(t,{VKWebAppShowGoodOrderBox:()=>v});var r=a(290788),s=a(234430),i=a(914421),n=a(52905),o=a(105330),c=a(957994),p=a(927097),d=a(904719),l=a(114251),_=a(637829);const h=-1,u=1,m=1,g=2;class v extends r.Handler{setData(e,t){super.setData(e,t),this.itemId=this.itemId?this.itemId:e.external_item_id,this.rawData=e}showLoader(e=!1){const t=e?this.abortLoading.bind(this):this.denyUIAction.bind(this);let a=[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:t}];e||a.push({title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.denyUIAction,disabled:!0});const r={buttons:a,title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_buy_waiting_item_desc"),cancelAction:t,containerId:this.params.modal.containerId,onlyButtonHide:!0,svgIcon:this.getLoaderIcon()};this.loader=new s.UIAction(r),i.default.push(this.loader)}hideLoader(){this.loader&&(i.default.pop(this.loader),this.loader.destroy()),this.loader=null}abortLoading(){this.isAborted=!0,this.denyUIAction()}handler(e,t,a){if(this.setData(e,t),this.callback=a,this.rawData.type&&this.rawData.external_item_id)return(0,o.isMvk)()?(this.showLoader(),void this.makeOrder()):void this.handleWeb();this.errorHandler({code:n.ERROR_CODES.INVALID_PARAMS})}handleWeb(){(0,p.showGoodsOrderBox)(this.rawData,(e=>{this.orderId=e,this.initCheckOrder()}),(()=>{this.errorHandler({reason:"Order error",code:n.ERROR_CODES.CUSTOM})}),(()=>{this.errorHandler({code:n.ERROR_CODES.USER_DENIED})}))}makeOrder(){this.loadItemData().then((e=>{this.showConfirm(e)})).catch(this.onError.bind(this)).finally(this.hideLoader.bind(this))}showConfirm(e){this.params.modal.pic=e.image_url,this.params.modal.title=e.title,this.params.modal.text=e.description,e.trial_description&&(this.params.modal.subheading=e.trial_description,this.params.modal.isTextSeparated=!0),this.modal=new s.UIAction({...this.params.modal}),i.default.push(this.modal);const t=document.querySelector(".vk_app_modal_container__pic");t&&(t.onload=()=>{t.classList.add("vk_app_modal_container__pic--loaded")})}loadItemData(){return(0,c.api)("goodsOrders.getItemData",{item_id:this.itemId,app_id:this.app.appId})}requestCreateOrder(){return(0,c.api)("goodsOrders.createOrder",{item_id:this.itemId,app_id:this.app.appId})}cancel(){this.denyUIAction(),this.hideLoader()}onError(){this.sendNetworkError(),i.default.pop(this.modal),this.showOrderErrorModal()}createOrder(){this.showLoader(),this.requestCreateOrder().then((e=>{window.nav.go(e.payment_url)})).catch(this.onError.bind(this)).finally(this.hideLoader.bind(this))}showOrderErrorModal(){this.showResultModal(getLang("vkapps_connect_auto_buy_error_title"),getLang("vkapps_connect_auto_buy_error_desc"),this.getWarningIcon())}showResultModal(e,t,a){const r=new s.UIAction({title:e,text:t,buttons:[{title:getLang("payments_miniapps_order_modal_continue"),type:"success"}],withoutAnimation:!0,containerId:this.params.modal.containerId,containerClass:"vk_app_modal_container--order",svgIcon:a,cancelAction:()=>{i.default.pop(r)},allowAction:()=>{if(i.default.pop(r),(0,o.isMvk)()){const e=new URL(window.location),t=e.origin+e.pathname+e.hash;window.nav.set({nav:Object.assign({},window.nav,{cur:t,path:t,push:t}),replace:!0})}}});i.default.push(r)}getWarningIcon(){const e=document.createElement("div");return e.className="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--warning",e.innerHTML=(0,d.getIcon56ErrorTriangleOutline)().icon,e.outerHTML}initCheckOrder(){this.showLoader(!0),this.checkOrder()}checkOrder(){this.requestCheckOrder().then((e=>e.payment_status===u&&e.order_status===m?(this.hideLoader(),this.showOrderSuccessModal(),!1):e.payment_status!==h&&e.order_status!==g||(this.hideLoader(),i.default.pop(this.modal),this.errorHandler(e.error),this.showOrderErrorModal(),!1))).catch((e=>(console.error(e),!0))).then((e=>{e&&!this.isAborted&&(this.interval=setTimeout((()=>{this.checkOrder()}),1e3))}))}showOrderSuccessModal(){this.successHandler({success:!0,order_id:this.orderId}),this.showResultModal(getLang("payments_miniapps_order_success_title"),getLang("payments_miniapps_order_success_desc"),this.getSuccessIcon())}getLoaderIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--loader">\n      ${(0,l.getIcon44Spinner)().icon}\n    </div>\n    `}getSuccessIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--success">\n      ${(0,_.getIcon56CheckCircleOutline)().icon}\n    </div>\n    `}requestCheckOrder(){return(0,c.api)("goodsOrders.getOrder",{order_id:this.orderId})}constructor(e){super(e),this.params.handlerName="VKWebAppShowGoodOrderBox",this.useUI=!1,this.callApi=!1,this.isAborted=!1,this.controller="/apps",this.itemId="",this.payment_url="",this.params.modal={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.denyUIAction.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.createOrder.bind(this)}],containerClass:"vk_app_modal_container--order",allowAction:this.createOrder.bind(this),cancelAction:this.denyUIAction.bind(this),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0},this.rawData=null}}},559850:(e,t,a)=>{a.d(t,{VKWebAppShowInviteBox:()=>l});var r=a(290788),s=a(105330),i=a(957994),n=a(914421),o=a(52905),c=a(810068),p=a(540462),d=a(670053);class l extends r.Handler{handler(e,t,a){if(this.inProgress)return this.sendCustomError(o.ERROR_REASONS.ALREADY_IN_PROGRESS);this.inProgress=!0,this.setData(e,t),this.callback=a,this.callApi=!0;((0,p.partConfigEnabled)("mini_apps_long_id")?c.Ranges.isUserId(e.friend_id):Boolean(e.friend_id))?this.processSingleInvite(e):this.processMultiInvite(e)}processSingleInvite(e){this.useUI=!0,this.pic="",this.params.modal={buttons:[{title:getLang("apps_connect_modal_btn_invite_cancel"),type:"deny"},{title:getLang("apps_connect_modal_btn_invite_ok"),type:"success"}],showCloseBtn:!(0,s.isMvk)(),title:""},this.loadSingleInviteIntroData(e)}processMultiInvite(e){this.useUI=!1,this.params.modal=null,this.multiInviteHandler(e)}multiInviteHandler(e){(0,s.isMvk)()?window.DirectGames.showInviteBox({onSuccess:t=>{this.isLoading=!1;const a={...t};e.requestKey&&(a.request_key=e.requestKey),super.actionHandler(a)},onFail:e=>{this.isLoading=!1,this.errorHandler(e)},requestKey:e.requestKey}):(0,d.getCurrentApp)().showInviteBox((e=>{this.isLoading=!1,this.successHandler(e)}),(e=>{this.isLoading=!1,this.errorHandler(e)}),e.requestKey)}loadSingleInviteIntroData(e){if(!this.checkParams(e,[{param:"friend_id",type:"number",isRequired:!0,extraChecks:(0,p.partConfigEnabled)("mini_apps_long_id")?[{check:e=>c.Ranges.isUserId(e),error:e=>`Param "${e}" should be a valid user id`}]:void 0}]))return;this.request={...e};const{friend_id:t}=e,a={app_id:this.app.appId,user_id:t};(0,i.api)("apps.checkInviteFriend",a).then((({text:t,photo:a,request_id:r})=>{const s={text:t,photo:a};r&&(s.payload=r),this.checkSingleInviteIntroData(s,e)})).catch((e=>{this.handleApiError(e)}))}checkSingleInviteIntroData(e,t){t.text=e.text,t.pic=e.photo.url,this.launchUI(t)}allowUIAction(e){this.trySendSingleInvite(this.request.friend_id,this.request.requestKey),n.default.pop(this.modal)}trySendSingleInvite(e,t){const a={app_id:this.app.appId,user_id:e};t&&(a.request_key=t),(0,i.api)("apps.inviteFriend",a).then((()=>{this.isLoading=!1,this.successHandler({result:!0})})).catch((e=>{this.isLoading=!1,this.handleApiError(e)}))}constructor(e){super(e),this.params.handlerName="VKWebAppShowInviteBox"}}},265734:(e,t,a)=>{a.d(t,{VKWebAppShowLeaderBoardBox:()=>c});var r=a(290788),s=a(52905),i=a(105330),n=a(816980),o=a(670053);class c extends r.Handler{actionHandler(e){super.actionHandler(e)}handleResponse(e,t){if((e=JSON.parse(e)).hasOwnProperty("error"))return void this.errorHandler({reason:s.ERROR_REASONS.UNKNOWN_ERROR,description:e.error});const a={...t,...e};(0,i.isMvk)()?window.DirectGames.showLeaderBoard({onClose:()=>{this.successHandler({result:!0})},board:a}):(0,n.isSpaLaunch)()?(0,o.getCurrentApp)().funcs.showLeaderBoard(a,(()=>{this.successHandler({result:!0})}),this.errorHandler):window.Apps?.showLeaderBoard?.(a,(()=>{this.successHandler({result:!0})}),this.errorHandler)}constructor(e){super(e),this.params.handlerName="VKWebAppShowLeaderBoardBox",this.callApi=!0,this.useUI=!1}}},484211:(e,t,a)=>{a.d(t,{VKWebAppShowNewPostBox:()=>c});var r=a(290788),s=a(52905),i=a(810068),n=a(540462),o=a(670053);class c extends r.Handler{checkFields(e){return this.checkParams(e,[{param:"owner_id",type:"number",extraChecks:(0,n.partConfigEnabled)("mini_apps_long_id")?[{check:e=>i.Ranges.isOwnerId(e),error:e=>`Param "${e}" should be a valid user id`}]:void 0},{param:"author_id",type:"number",extraChecks:(0,n.partConfigEnabled)("mini_apps_long_id")?[{check:e=>i.Ranges.isUserId(e),error:e=>`Param "${e}" should be a valid user id`}]:void 0},{param:"textlive_id",type:"number",isRequired:!1,extraChecks:[{check:()=>s.TEXTLIVE_APPS.includes((0,o.getCurrentApp)().params.api_id),error:()=>s.ERROR_REASONS.UNKNOWN_ERROR}]},{params:"situational_suggest_id",type:"number"},{params:"post",type:"object"}])}actionHandler(e){this.checkFields(e)&&this.open(e)}open(e){this.initEmitters(),cur.getWkviewOpts=()=>({textlive_id:e.textlive_id,author_id:e.author_id,owner_id:e.owner_id,textpost_id:e.post?e.post.id:0,situational_suggest_id:e.situational_suggest_id,post:JSON.stringify(e.post)}),e.post&&(0,n.partConfigEnabled)("posting_web_react_form")?this.showBridgeModal(this.app,{type:"ShowPostingForm",data:{ownerId:e.post.owner_id,initData:e.post},actions:{onDone:e=>{this.successHandler({type:"post",post_id:`${e.ownerId}_${e.postId}`}),this.cleanEmitters()},onClose:()=>{this.errorHandler({error_type:"client_error",code:s.ERROR_CODES.USER_DENIED}),this.cleanEmitters()}}}):window.showWiki({w:"postbox"},null,null,{queue:1})}cleanEmitters(){const e=(0,o.getCurrentApp)();e.vkMiniAppNewPostSuccess=null,e.vkMiniAppNewPostFail=null}initEmitters(){const e=(0,o.getCurrentApp)();e.vkMiniAppNewPostSuccess=e=>{e.post_id?this.successHandler({type:"post",post_id:`${e.owner_id}_${e.post_id}`}):"number"==typeof e&&this.successHandler({type:"message"}),this.cleanEmitters()},e.vkMiniAppNewPostFail=e=>{e?this.errorHandler(e):this.errorHandler({error_type:"client_error",code:s.ERROR_CODES.USER_DENIED}),this.cleanEmitters()}}constructor(e){super(e);const t=(0,o.getCurrentApp)();this.params.handlerName="VKWebAppShowNewPostBox",this.appId=t.params.api_id,this.userId=t.params.viewer_id,this.isWebOnly=!0}}},108996:(e,t,a)=>{a.d(t,{VKWebAppShowNftGoodBox:()=>_});var r=a(290788),s=a(234430),i=a(914421),n=a(52905),o=a(105330),c=a(957994),p=a(927097),d=a(904719),l=a(114251);class _ extends r.Handler{setData(e,t){super.setData(e,t),this.requestId=e.request_id,this.rawData=e}showLoader(){const e={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.denyUIAction.bind(this)}],title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_buy_waiting_item_desc"),cancelAction:this.denyUIAction.bind(this),containerId:this.params.modal.containerId,onlyButtonHide:!0,svgIcon:this.getLoaderIcon()};this.loader=new s.UIAction(e),i.default.push(this.loader)}hideLoader(){this.loader&&(i.default.pop(this.loader),this.loader.destroy()),this.loader=null}handler(e,t,a){if(this.setData({...e,type:"nft_create_request"},t),this.callback=a,null!==this.requestId)return(0,o.isMvk)()?(this.showLoader(),void this.makeOrder()):void this.handleWeb();this.errorHandler({code:n.ERROR_CODES.INVALID_PARAMS,reason:n.ERROR_REASONS.INVALID_PARAMS})}handleWeb(){(0,p.showGoodsOrderBox)(this.rawData,(()=>{this.successHandler({success:!0,request_id:this.requestId})}),(()=>{this.errorHandler({reason:"Order error",code:n.ERROR_CODES.CUSTOM})}),(()=>{this.errorHandler({code:n.ERROR_CODES.USER_DENIED})}))}makeOrder(){this.getPaymentLink().then((e=>{window.nav.go(e.payment_link)})).catch(this.onError.bind(this)).finally(this.hideLoader.bind(this))}getPaymentLink(){return(0,c.api)("money.getNftRequestOrderPaymentLink",{request_id:this.requestId})}cancel(){this.denyUIAction(),this.hideLoader()}onError(){this.sendNetworkError(),i.default.pop(this.modal),this.showOrderErrorModal()}showOrderErrorModal(){this.showResultModal(getLang("vkapps_connect_auto_buy_error_title"),getLang("vkapps_connect_auto_buy_error_desc"),this.getWarningIcon())}showResultModal(e,t,a){const r=new s.UIAction({title:e,text:t,buttons:[{title:getLang("payments_miniapps_order_modal_continue"),type:"success"}],withoutAnimation:!0,containerId:this.params.modal.containerId,containerClass:"vk_app_modal_container--order",svgIcon:a,cancelAction:()=>{i.default.pop(r)},allowAction:()=>{if(i.default.pop(r),(0,o.isMvk)()){const e=new URL(window.location),t=e.origin+e.pathname+e.hash;window.nav.set({nav:Object.assign({},window.nav,{cur:t,path:t,push:t}),replace:!0})}}});i.default.push(r)}getWarningIcon(){const e=document.createElement("div");return e.className="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--warning",e.innerHTML=(0,d.getIcon56ErrorTriangleOutline)().icon,e.outerHTML}getLoaderIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--loader">\n      ${(0,l.getIcon44Spinner)().icon}\n    </div>\n    `}constructor(e){super(e),this.params.handlerName="VKWebAppShowNftGoodBox",this.useUI=!1,this.callApi=!1,this.isAborted=!1,this.controller="/apps",this.requestId=null,this.payment_url="",this.params.modal={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.denyUIAction.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.makeOrder.bind(this)}],containerClass:"vk_app_modal_container--order",allowAction:this.makeOrder.bind(this),cancelAction:this.denyUIAction.bind(this),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0},this.rawData=null}}},694287:(e,t,a)=>{a.d(t,{VKWebAppShowOrderBox:()=>g});var r=a(290788),s=a(234430),i=a(914421),n=a(52905),o=a(105330),c=a(904719),p=a(637829),d=a(670053),l=a(957994),_=a(540462),h=a(816980);const u={error_type:"client_error",code:n.ERROR_CODES.CONNECTION_LOST},m="disabled";class g extends r.Handler{setData(e,t){super.setData(e,t),this.itemId=this.itemId?this.itemId:e.item,this.rawData=e}showLoader(){const e={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.cancel.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.cancel.bind(this),disabled:!0}],title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_buy_waiting_item_desc"),cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--loader",pic:"/images/svg_icons/vk_apps/vk_app_spinner_100.svg",containerId:this.params.modal.containerId,onlyButtonHide:!0};this.loader=new s.UIAction({...e}),i.default.push(this.loader)}hideLoader(){this.loader&&(i.default.pop(this.loader),this.loader.destroy()),this.loader=null}handler(e,t,a){if(this.setData(e,t),this.callback=a,this.rawData.type&&this.rawData.item)if((0,o.isMvk)())this.showLoader(),this.makeOrder();else{const e=(0,d.getCurrentApp)();e?.registerVkBridgeCallback("onOrderCancel",(()=>{this.errorHandler({code:n.ERROR_CODES.USER_DENIED})})),e?.registerVkBridgeCallback("onOrderSuccess",(e=>{this.successHandler({success:!0,order_id:e}),this.checkCashback()})),e?.registerVkBridgeCallback("onOrderFail",(()=>{this.errorHandler({reason:"Order error",code:n.ERROR_CODES.CUSTOM})})),e?.showOrderBox(this.rawData)}else this.errorHandler({code:n.ERROR_CODES.INVALID_PARAMS})}makeOrder(){this.loadItemData().then((e=>{clearInterval(this.interval),this.hideLoader(),this.isAutoBuyEnabled?this.confirmOrder():this.showConfirm(e)})).catch((e=>{this.onError(e)}))}cancel(){clearInterval(this.interval),this.denyUIAction(),this.hideLoader()}onError(e){clearInterval(this.interval),this.errorHandler(e),i.default.pop(this.modal),this.hideLoader(),this.showOrderErrorModal(e)}getWarningIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--warning">\n      ${(0,c.getIcon56ErrorTriangleOutline)().icon}\n    </div>\n    `}getSuccessIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--success">\n      ${(0,p.getIcon56CheckCircleOutline)().icon}\n    </div>\n    `}checkOrderStatus(e){this.paymentsCheckOrderCount++,(0,l.api)("orders.getById",{order_id:e,app_id:this.app.appId}).then((t=>{if(!t.length)return this.errorHandler(t.error),void this.showOrderErrorModal();"chargeable"===t[0].status?this.paymentsCheckOrderCount>3?(this.errorHandler(t.error),this.showPaymentPendingWithRefundModal()):setTimeout((()=>this.checkOrderStatus(e)),2e3):"charged"===t[0].status?(this.successHandler({success:!0,order_id:t.order_id}),this.showOrderSuccessModal()):this.onError(t.error)})).catch((e=>this.onError(e)))}showPaymentPendingWithRefundModal(){this.showResultModal(getLang("payments_waiting_app_order_complete"),getLang("payments_app_add_votes_delay"),this.getWarningIcon())}async checkCashback(){if(!(0,_.partConfigEnabled)("order_box_check_cashback"))return;const e={app_id:this.app.appId,place_id:"order"};if("personal_discount_cashback"===(await(0,l.api)("apps.needToShowAction",e)).type){const e={type:"PersonalDiscountCashbackModal",data:{info:await(0,l.api)("apps.getPersonalDiscountCashback",{})}};this.showBridgeModal(this.app,e)}}constructor(e){super(e),this.getAutoBuyCheckboxState=()=>this.isAutoByVisible&&this.params.modal.checkbox?this.params.modal.checkbox[0]?.checked?"checked":"unchecked":m,this.appendAutoByCheckBox=()=>{this.isAutoByVisible&&(this.params.modal.checkbox=this.params.modal.checkbox||[],this.params.modal.checkbox[0]={title:getLang("vkapps_connect_auto_buy_title"),description:getLang("vkapps_connect_auto_buy_desc"),checked:this.isAutoBuyChecked},this.params.modal.containerClass="vk_app_modal_container--order vk_app_modal_container--orderAutoBuy")},this.showConfirm=e=>{this.params.modal.pic=e.photo_url,this.params.modal.title=e.title,this.params.modal.text=e.message,this.appendAutoByCheckBox(),this.modal=new s.UIAction({...this.params.modal}),i.default.push(this.modal);const t=document.querySelector(".vk_app_modal_container__pic");t&&(t.onload=()=>{t.classList.add("vk_app_modal_container__pic--loaded")})},this.showPendingPaymentModal=()=>{this.hideLoader(),i.default.pop(this.modal),this.pendingPaymentModal=new s.UIAction({...this.params.modal,title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("payments_waiting_app_order_complete"),buttons:[],picClass:"vk_app_modal_container__pic--loader",pic:"/images/svg_icons/vk_apps/vk_app_spinner_100.svg"}),i.default.push(this.pendingPaymentModal)},this.hidePendingPaymentModal=()=>{this.pendingPaymentModal&&(i.default.pop(this.pendingPaymentModal),this.pendingPaymentModal.destroy()),this.pendingPaymentModal=null},this.loadItemData=()=>new Promise(((e,t)=>{let a=0;this.interval=setInterval((()=>{ajax.post(this.controller,{act:"handle_vk_connect_event",event:this.getEventName(),hash:this.getEventHash(),item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId,_ajax:1},{onDone:r=>{switch((r=JSON.parse(r)).hasOwnProperty("error")&&t(r.error),r.status){case"waiting":this.orderId=(0,h.isSpaLaunch)()&&this.orderId||r.order_id,a++>=30&&t({code:n.ERROR_CODES.CUSTOM,reason:"Can't load product"});break;case"loaded":this.orderId=r.order_id,this.confirmHash=r.confirm_hash,this.orderHash=r.order_hash,this.isAutoBuyChecked=r.is_auto_buy_checked,this.isAutoBuyEnabled=r.is_auto_buy_enabled,this.isAutoByVisible=r.is_auto_buy_checkbox_visible,e(r.item_data)}},onFail:()=>{t(u)}})}),1e3)})),this.confirmOrder=()=>{(0,_.partConfigEnabled)("mini_apps_vote_payments_check")?this.showPendingPaymentModal():this.hideLoader(),ajax.post(this.controller,{act:"handle_vk_connect_event",event:"confirm_order",item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId,hash:this.confirmHash,order_hash:this.orderHash,auto_buy_checked:this.getAutoBuyCheckboxState()},{onDone:e=>{if(e=JSON.parse(e),(0,_.partConfigEnabled)("mini_apps_vote_payments_check")?this.checkOrderStatus(Number(e.order_id)):(i.default.pop(this.modal),"charged"===e.status?(this.successHandler({success:!0,order_id:e.order_id}),this.showOrderSuccessModal()):(this.errorHandler(e.error),this.showOrderErrorModal())),(0,o.isMvk)()){const e=new URL(location.href);["confirm_order","order_id"].forEach((t=>e.searchParams.delete(t))),nav.set({replace:!0,nav:{...nav,cur:nav.path,push:e.pathname+e.search+e.hash}})}},onFail:()=>{this.onError(u)}})},this.showOrderSuccessModal=()=>{this.showResultModal(getLang("vkapps_connect_auto_buy_success_title"),getLang("vkapps_connect_auto_buy_success_desc"),this.getSuccessIcon())},this.showOrderErrorModal=e=>{const t=1===e.code,a=t?getLang("vkapps_connect_modal_order_not_allowed_error_title"):getLang("vkapps_connect_auto_buy_error_title"),r=t?getLang("vkapps_connect_modal_order_not_allowed_error_desc"):getLang("vkapps_connect_auto_buy_error_desc");this.showResultModal(a,r,this.getWarningIcon())},this.showResultModal=(e,t,a)=>{(0,_.partConfigEnabled)("mini_apps_vote_payments_check")&&this.hidePendingPaymentModal();const r=new s.UIAction({title:e,text:t,buttons:[{title:(0,d.getCurrentApp)()?.options.vkApp?getLang("vkapps_connect_modal_back_to_service"):getLang("vkapps_connect_modal_continue_play"),type:"success"}],withoutAnimation:!0,containerId:this.params.modal.containerId,containerClass:"vk_app_modal_container--order",svgIcon:a,cancelAction:()=>{i.default.pop(r),this.checkCashback()},allowAction:()=>{i.default.pop(r),this.checkCashback()}});i.default.push(r)},this.params.handlerName="VKWebAppShowOrderBox",this.useUI=!1,this.callApi=!1,this.controller="/apps",this.itemId="",this.orderId=0,this.isAutoBuyEnabled=!1,this.isAutoBuyChecked=!1,this.isAutoByVisible=!1,this.paymentsCheckOrderCount=0,this.params.modal={buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny",action:this.cancel.bind(this)},{title:getLang("vkapps_connect_modal_buy"),type:"success",action:this.confirmOrder}],containerClass:"vk_app_modal_container--order",allowAction:this.confirmOrder,cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0},this.rawData=null}}},767708:(e,t,a)=>{a.d(t,{VKWebAppShowRequestBox:()=>d});var r=a(290788),s=a(105330),i=a(52905),n=a(898848),o=a(810068),c=a(540462),p=a(670053);class d extends r.Handler{actionHandler(e){if(e.message&&e.message.trim()&&o.Ranges.isUserId(e.uid))if(e.message.length>1e3)this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:"The message parameter is longer than the specified length (1000 characters)"});else if((0,s.isMvk)())ajax.post("apps.php",{act:"handle_vk_connect_event",hash:this.getEventHash(!0),event:this.getEventName(!0),app_id:this.app.appId,friend_id:e.uid},{onDone:t=>{try{(t=JSON.parse(t)).hasOwnProperty("error")?this.errorHandler({code:t.error.code,reason:t.error.reason},null,i.ERROR_TYPES.API):(Object.assign(e,t),window.DirectGames.showRequestBox({...e,onSuccess:super.actionHandler.bind(this),onFail:this.errorHandler}))}catch(e){this.errorHandler(e)}},onFail:()=>{this.errorHandler({code:i.ERROR_CODES.CONNECTION_LOST,reason:i.ERROR_REASONS.NETWORK_ERROR})}});else if((0,c.partConfigEnabled)("apps_bridge_show_request_box_to_api"))this.showBridgeModal(this.app,{type:"ShowRequestBox",data:{senderId:window.vk.id,targetId:Number(e.uid),appId:this.app.appId,appName:this.app.vkApp.options.app_name,message:e.message,requestKey:e.requestKey},actions:{onDone:()=>{this.successHandler({request_key:e.requestKey,success:!0})},onClose:()=>{this.errorHandler({code:i.ERROR_CODES.USER_DENIED,reason:i.ERROR_REASONS.USER_DENIED})},onError:()=>{this.errorHandler({code:i.ERROR_CODES.UNKNOWN,reason:i.ERROR_REASONS.UNKNOWN_ERROR})}}});else{const t=(0,p.getCurrentApp)();t.registerVkBridgeCallback("onRequestFail",(e=>{(0,n.isObject)(e)?this.errorHandler({code:i.ERROR_CODES.CONNECTION_LOST,reason:i.ERROR_REASONS.NETWORK_ERROR}):this.errorHandler({code:i.ERROR_CODES.UNKNOWN,reason:e},null,i.ERROR_TYPES.API)})),t.registerVkBridgeCallback("onRequestCancel",(()=>{this.errorHandler({reason:i.ERROR_REASONS.USER_DENIED,code:i.ERROR_CODES.USER_DENIED})})),t.registerVkBridgeCallback("onRequestSuccess",(()=>{this.successHandler({request_key:e.requestKey,success:!0})})),t.showRequestBox(e.uid,e.message,e.requestKey)}else this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:i.ERROR_REASONS.INVALID_PARAMS})}constructor(e){super(e),this.params.handlerName="VKWebAppShowRequestBox",this.callApi=!0}}},701890:(e,t,a)=>{a.d(t,{VKWebAppShowStoryBox:()=>o});var r=a(105330),s=a(334274),i=a(270224),n=a(290788);class o extends n.Handler{constructor(...e){return(0,r.isMvk)()?new s.VKWebAppShowStoryBoxMvkHandler(...e):new i.VKWebAppShowStoryBoxWebHandler(...e)}}},95652:(e,t,a)=>{a.d(t,{VKWebAppShowStoryBoxHandler:()=>p});var r=a(290788),s=a(52905),i=a(105330),n=a(810068),o=a(540462),c=a(397088);class p extends r.Handler{get loadFinishDescriptor(){return`${this.params.handlerName}LoadFinish`}loadFinishHandler(e){this.app?.sendEventToMiniApp?this.app.sendEventToMiniApp(this.loadFinishDescriptor,e):(0,c.chooseAction)({handler:this.loadFinishDescriptor,params:e},this.app)}static isValidUrl(e){try{return!!new URL(e)}catch{return!1}}initStoryPublisher(e){window.StoryPublisher&&window.StoryPublisher.init(e,(()=>this.successHandler({result:!0})),((e,t)=>{if(!e){const e={code:s.ERROR_CODES.USER_DENIED};return t&&t.error&&t.error.message&&(e.reason=t.error.message),this.errorHandler(e)}if(t&&t.story){const{owner_id:e,id:a}=t.story;return this.loadFinishHandler({story_owner_id:e,story_id:a})}}))}validateParams(e){return!!this.checkFields(e)&&(!(e.attachment&&!this.checkAttachment(e.attachment))&&(!(e.stickers&&!this.checkStickers(e.stickers))&&!(e.service_info&&!this.checkServiceInfo(e.service_info))))}checkFields(e){const t={check:e=>p.isValidUrl(e),error:e=>`Param "${e}" incorrect`};return this.checkParams(e,[{param:"background_type",type:"string",isRequired:!0,extraChecks:[{check:e=>(0,i.isMvk)()?"image"===e||"video"===e:"image"===e,error:e=>(0,i.isMvk)()?`Param "${e}" should be a image or video`:`Param "${e}" should be a image`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[t]},{param:"blob",type:"string",isRequired:!e.url,extraChecks:[{check:()=>"image"===e.background_type,error:e=>`Param "${e}" available only for image background_type`},t]},{param:"attachment",type:"object"},{param:"stickers",type:"object",extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]},{param:"service_info",type:"object"}])}checkAttachment(e){const t=["url","photo","video","audio"],a=["to_store","vote","more","book","order","enroll","fill","signup","buy","ticket","game","write","open","learn_more","view","go_to","contact","watch","play","install","read","to_memories_app","nft_avatar","attach_narrative"];return!!this.checkParams(e,[{param:"text",type:"string",isRequired:!0,extraChecks:[{check:e=>a.includes(e),error:e=>`Param "${e}" should be a ${a.join(", ")}`}]},{param:"type",type:"string",isRequired:!0,extraChecks:[{check:e=>t.includes(e),error:e=>`Param "${e}" should be a ${t.join(", ")}`}]}])&&("url"===e.type?this.checkParams(e,[{param:"url",type:"string",isRequired:!0,extraChecks:[{check:e=>p.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]}]):this.checkParams(e,[{param:"owner_id",type:"number",isRequired:!0,extraChecks:(0,o.partConfigEnabled)("mini_apps_long_id")?[{check:e=>n.Ranges.isOwnerId(e),error:e=>`Param "${e}" should be a valid user id`}]:void 0},{param:"id",type:"number",isRequired:!0},{param:"access_key",type:"string"}]))}checkStickers(e){return!e.length||e.every((e=>!!this.checkStickerContainer(e)&&!!this.checkSticker(e.sticker_type,e.sticker)))}checkServiceInfo(e){return this.checkParams(e,[{param:"open_text_editor",type:"boolean"}])}checkStickerContainer(e){return this.checkParams(e,[{param:"sticker_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["native","renderable"].includes(e),error:e=>`Param "${e}" should be a native or renderable`}]},{param:"sticker",type:"object",isRequired:!0}])}checkSticker(e,t){return"renderable"===e?this.checkRenderableSticker(t):"native"===e?this.checkNativeSticker(t):(this.errorHandler({code:s.ERROR_CODES.INVALID_PARAMS,reason:'Param "sticker_type" should be a native or renderable'}),!1)}checkNativeSticker(e){return!!this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["text","sticker","situational_template"].includes(e),error:e=>`Param "${e}" should be a text or sticker`}]},{param:"action",type:"object",isRequired:!1},{param:"transform",type:"object",isRequired:!1}])&&(!!this.checkAction(e.action_type,e.action)&&!(e.transform&&!this.checkTransform(e.transform)))}checkAction(e,t){return"text"===e?this.checkParams(t,[{param:"text",type:"string",isRequired:!0},{param:"style",type:"string"},{param:"background_style",type:"string"},{param:"alignment",type:"string"},{param:"selection_color",type:"string"}]):"sticker"===e?this.checkParams(t,[{param:"sticker_id",type:"number",isRequired:!0},{param:"pack_id",type:"number"}]):"link"===e?this.checkParams(t,[{param:"link",type:"string",isRequired:!0},{param:"tooltip_text_key",type:"string"}]):"situational_theme"===e?!t||0===Object.keys(t).length||(this.errorHandler({code:s.ERROR_CODES.INVALID_PARAMS,reason:'Param situational_theme "action" should be empty'}),!1):"situational_template"===e||("mention"===e?this.checkParams(t,[{param:"mention",type:"string",isRequired:!0}]):(this.errorHandler({code:s.ERROR_CODES.INVALID_PARAMS,reason:'Param "action_type" should be a sticker or text'}),!1))}checkTransform(e){const t=["left_top","left_center","left_bottom","center_top","center","center_bottom","right_top","right_center","right_bottom"];return this.checkParams(e,[{param:"rotation",type:"number",isRequired:!1},{param:"relation_width",type:"number",isRequired:!1},{param:"translation_x",type:"number",isRequired:!1},{param:"translation_y",type:"number",isRequired:!1},{param:"gravity",type:"string",isRequired:!1,extraChecks:[{check:e=>t.includes(e),error:e=>`Param "${e}" should be ${t.join(", ")}`}]}])}checkRenderableSticker(e){return!!this.checkParams(e,[{param:"content_type",type:"string",isRequired:!0,extraChecks:[{check:e=>"image"===e,error:e=>`Param "${e}" should be a image`}]},{param:"url",type:"string",isRequired:!e.blob,extraChecks:[{check:e=>p.isValidUrl(e),error:e=>`Param "${e}" incorrect`}]},{param:"blob",type:"string",isRequired:!e.url},{param:"transform",type:"object",isRequired:!1},{param:"clickable_zones",type:"object",isRequired:!1,extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])&&(!(e.transform&&!this.checkTransform(e.transform))&&!(e.clickable_zones&&!this.checkClickableZones(e.clickable_zones)))}checkClickableZones(e){return e.every((t=>!!this.checkClickableZone(t)&&(!!this.checkAction(t.action_type,t.action)&&(!e.clickable_area||(4!==e.clickable_area.length?(this.errorHandler({code:s.ERROR_CODES.INVALID_PARAMS,reason:'Sticker "clickable_area" should include 4 points'}),!1):e.clickable_area.every((e=>this.checkParams(e,[{param:"x",type:"number",isRequired:!0},{param:"y",type:"number",isRequired:!0}]))))))))}checkClickableZone(e){return this.checkParams(e,[{param:"action_type",type:"string",isRequired:!0,extraChecks:[{check:e=>["link","situational_theme","mention"].includes(e),error:e=>`Param "${e}" should be a link, situational_theme or mention`}]},{param:"action",type:"object",isRequired:!0},{param:"clickable_area",type:"object",extraChecks:[{check:e=>Array.isArray(e),error:e=>`Param "${e}" should be array`}]}])}constructor(...e){super(...e),this.params.handlerName="VKWebAppShowStoryBox",this.callApi=!1,this.useUI=!1}}},708669:(e,t,a)=>{a.d(t,{VKWebAppShowStoryBoxLoadFinish:()=>i});var r=a(290788),s=a(143037);class i extends r.Handler{get successDescriptor(){return`${this.params.handlerName}`}actionHandler(e){this.successHandler({story_owner_id:e.story_owner_id,story_id:e.story_id})}constructor(e){super(e),this.params.handlerName=s.CONNECT_EVENTS.SHOW_STORY_BOX_LOAD_FINISH}}},334274:(e,t,a)=>{a.d(t,{VKWebAppShowStoryBoxMvkHandler:()=>n});var r=a(189878),s=a(646938),i=a(95652);class n extends i.VKWebAppShowStoryBoxHandler{actionHandler(e){this.validateParams(e)&&this.initStoryPublisher({entrypoint:s.StoryEntryPoint.MINI_APP,miniAppId:Number(this.app.appId),miniAppName:this.app.vkApp.options.app_name,maxVideoDuration:r.MAX_STORY_VIDEO_DURATION,closeAfterError:!0,layerZIndex:800,...e})}}},270224:(e,t,a)=>{a.d(t,{VKWebAppShowStoryBoxWebHandler:()=>o});var r=a(540462),s=a(52905),i=a(646938),n=a(95652);class o extends n.VKWebAppShowStoryBoxHandler{actionHandler(e){if(!(0,r.partConfigEnabled)("web2_story_box_enabled"))return this.errorHandler({code:s.ERROR_CODES.UNSUPPORTED_PLATFORM,reason:s.ERROR_REASONS.UNSUPPORTED_PLATFORM});this.validateParams(e)&&window.stManager.add([window.jsc("web/story_publisher.js")]).then((()=>{this.initStoryPublisher({entrypoint:i.StoryEntryPoint.MINI_APP,miniAppId:Number(this.app.appId),photoUrl:e.url?e.url:e.blob,stickers:e.stickers,attachment:e.attachment,serviceInfo:e.service_info,layerZIndex:800,...e})})).catch((()=>{this.errorHandler({code:s.ERROR_CODES.UNKNOWN})}))}}},234790:(e,t,a)=>{a.d(t,{VKWebAppShowSubscriptionBox:()=>k});var r=a(290788),s=a(105330),i=a(957994),n=a(52905),o=a(234430),c=a(914421),p=a(114251),d=a(904719),l=a(866467),_=a(670053);const h={CREATE:"create",RESUME:"resume",CANCEL:"cancel"},u="waiting",m="loaded",g="active",v="cancelled",A="charged",E=1,f={NOT_ALLOWED:1,CANNOT_BE_RESUMED:7,NOT_ENOUGH_VOTES:8,ALREADY_EXISTS:9,NOT_FOUND:10},S=1,b=0,w=1,R={error_type:n.ERROR_TYPES.CLIENT,code:n.ERROR_CODES.CONNECTION_LOST},C={DATE:"{date}",LINK_OPEN_TAG:"{link}",LINK_CLOSE_TAG:"{/link}"};class k extends r.Handler{actionHandler(e){e.hasOwnProperty("action")?~Object.values(h).indexOf(e.action)?e.action!==h.CREATE||e.hasOwnProperty("item")?e.action!==h.RESUME&&e.action!==h.CANCEL||e.hasOwnProperty("subscription_id")?this.handleSubscriptionFlow(e):this.errorHandler({code:n.ERROR_CODES.MISSING_PARAM,reason:n.ERROR_REASONS.INVALID_PARAMS,description:'Missing required param "subscription_id"'}):this.errorHandler({code:n.ERROR_CODES.MISSING_PARAM,reason:n.ERROR_REASONS.INVALID_PARAMS,description:'Missing required param "item"'}):this.errorHandler({code:n.ERROR_CODES.INVALID_PARAMS,reason:n.ERROR_REASONS.INVALID_PARAMS,description:'Param "action" must be one of: create, resume or cancel'}):this.errorHandler({code:n.ERROR_CODES.MISSING_PARAM,reason:n.ERROR_REASONS.INVALID_PARAMS,description:'Missing required param "action"'})}handleSubscriptionFlow(e){e.action===h.CANCEL?this.initiateSubscriptionCancel(e.subscription_id):(this.isResume=e.action===h.RESUME,this.itemId=this.isResume?e.subscription_id:e.item,this.initiateSubscription())}initiateSubscriptionCancel(e){this.showSubscriptionCancelLoader(),(0,i.api)("orders.getUserSubscription",{app_id:this.app.appId,subscription_id:e}).then((e=>{if(!this.loader)return;this.hideLoader();const t=e.status===v,a=e.status===g&&e.pending_cancel;t||a?this.showErrorModal(getLang("vkapps_connect_modal_subscription_already_cancelled"),void 0,(()=>{this.errorHandler({code:n.ERROR_CODES.CUSTOM,error_msg:n.ERROR_REASONS.SUBSCRIPTION_IS_ALREADY_CANCELLED},void 0,n.ERROR_TYPES.API)})):this.showSubscriptionCancelModal(e)})).catch((e=>{if(!this.loader)return;this.hideLoader();const{error:t,type:a}=e;this.showErrorModal(getLang("vkapps_connect_modal_subscription_unknown_error_title"),getLang("vkapps_connect_modal_subscription_unknown_error_desc"),(()=>{this.errorHandler({code:t.error_code,error_msg:t.error_msg},void 0,a)}))}))}showSubscriptionCancelModal(e){let t=(0,_.getCurrentApp)().options.vkApp?getLang("vkapps_connect_modal_cancel_subscription_in_service"):getLang("vkapps_connect_modal_cancel_subscription_in_game");t=t.replace("{subscription_name}",e.title).replace("{app_name}",e.application_name);const a=(0,l.langNumeric)(e.price,getLang("apps_connect_n_votes","raw")).replace("{count}",e.price),r=(0,l.langNumeric)(e.period,getLang("apps_connect_days","raw")).replace("{count}",e.period),i=getLang("vkapps_connect_modal_subscription_charges_info").replace("{votes}",a).replace("{period}",r),n=this.getNextBillTimeText(e.expire_time),p=getLang("vkapps_connect_subscription_next_bill_time").replace("{date}",n),[d,h]=this.getCancelSubscriptionModalButtons();this.modal=new o.UIAction({pic:e.photo_url,title:t,text:[`<span class="vk_app_modal_container__accent_text_row">${i}</span>`,p],isTextSeparated:!0,buttons:d,buttonsClass:"MiniAppsNoWrapButtons",containerClass:"vk_app_modal_container--subscription",showCloseBtn:!(0,s.isMvk)(),closeButtonMode:o.CLOSE_BUTTON_MODES.OUTER,allowAction:this.cancel.bind(this),cancelAction:()=>this.cancelSubscription(e.id,h),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0,containerId:this.params.modal.containerId}),c.default.push(this.modal),this.markItemPictureAsLoaded()}showErrorModal(e,t,a){const r=new o.UIAction({title:e,text:t,buttons:[{title:(0,_.getCurrentApp)().options.vkApp?getLang("vkapps_connect_modal_back_to_service"):getLang("vkapps_connect_modal_back_to_game"),type:"deny"}],buttonsClass:"MiniAppsNoWrapButtons",showCloseBtn:!(0,s.isMvk)(),closeButtonMode:o.CLOSE_BUTTON_MODES.OUTER,withoutAnimation:!0,containerId:this.params.modal.containerId,svgIcon:this.getWarningIcon(),cancelAction:()=>{a(),c.default.pop(r)}});c.default.push(r)}cancelSubscription(e,t){this.setModalInProgress(t),(0,i.api)("orders.cancelUserSubscription",{app_id:this.app.appId,subscription_id:e}).then((()=>{this.hideModal(),this.successHandler({success:!0,subscriptionId:e})})).catch((e=>{const{error:t,type:a}=e;this.hideModal(),this.showErrorModal(getLang("vkapps_connect_modal_subscription_cancel_error_title"),getLang("vkapps_connect_modal_subscription_unknown_error_desc"),(()=>{this.errorHandler({code:t.error_code,error_msg:t.error_msg},void 0,a)}))}))}initiateSubscription(){this.showSubscriptionRetrievalLoader(),this.loadSubscriptionData().then((e=>{this.hideLoader(),this.showSubscriptionConfirm(e)})).catch((e=>{this.hideLoader(),this.handleSubscriptionInitiationError(e)}))}handleSubscriptionInitiationError(e){let t,a;switch(e.code){case f.CANNOT_BE_RESUMED:t=getLang("global_error_occured"),a=getLang("vkapps_connect_modal_subscription_cannot_be_resumed_error");break;case f.NOT_FOUND:t=getLang("vkapps_connect_modal_subscription_not_found_error");break;case f.ALREADY_EXISTS:t=getLang("vkapps_connect_modal_subscription_already_exists_error");break;case f.NOT_ALLOWED:t=getLang("vkapps_connect_modal_subscription_not_allowed_error_title"),a=getLang("vkapps_connect_modal_subscription_not_allowed_error_desc");break;default:t=getLang("vkapps_connect_modal_subscription_unknown_error_title"),a=getLang("vkapps_connect_modal_subscription_unknown_error_desc")}let r={code:n.ERROR_CODES.UNKNOWN};Object.values(f).includes(e.code)&&(r={code:n.ERROR_CODES.CUSTOM,error_msg:e.reason}),this.showErrorModal(t||void 0,a||void 0,(()=>{this.errorHandler(r)}))}loadSubscriptionData(){return new Promise(((e,t)=>{let a=0;this.interval=setInterval((()=>{ajax.post(this.controller,{act:"handle_vk_connect_event",event:this.getEventName(),hash:this.getEventHash(),item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId,resume:Number(this.isResume)},{onDone:r=>{if((r=JSON.parse(r)).hasOwnProperty("error"))t(r.error);else switch(r.status){case u:this.orderId=r.order_id,a+=1,a>=30&&t({code:n.ERROR_CODES.CUSTOM,reason:"Can't load subscription"});break;case m:this.orderId=r.order_id,this.confirmHash=r.confirm_hash,this.orderHash=r.order_hash,r.votes_refill_options&&(this.votesRefillOptions=r.votes_refill_options),e(r.item_data)}},onFail:()=>{t(R)}})}),3e3)})).finally((()=>{clearInterval(this.interval)}))}showSubscriptionConfirm(e){const t=this.isResume?getLang("vkapps_connect_modal_subscription_resume_title").replace("{subscription_name}",e.title):e.title,a=this.getSubscriptionDurationInfo(e),r=this.getSubscriptionNextBillTimeInfo(e),[i,n]=this.getSubscriptionModalButtons(e),p=Boolean(e.trial_duration);let d=()=>this.confirmSubscription(n);(0,s.isMvk)()||null===this.votesRefillOptions||(d=()=>this.refillVotesBalance(n)),this.modal=new o.UIAction({pic:e.photo_url,title:t,subheading:e.description,isTextSeparated:!0,text:[a,r],buttons:i,buttonsClass:p?"MiniAppsNoWrapButtons":void 0,containerClass:"vk_app_modal_container--subscription",showCloseBtn:!(0,s.isMvk)(),closeButtonMode:o.CLOSE_BUTTON_MODES.OUTER,allowAction:d,cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--buy",withoutAnimation:!0,onlyButtonHide:!0,containerId:this.params.modal.containerId}),c.default.push(this.modal),this.markItemPictureAsLoaded()}confirmSubscription(e){this.setModalInProgress(e),ajax.post(this.controller,{act:"handle_vk_connect_event",event:"confirm_subscription",item_id:this.itemId,order_id:this.orderId,app_id:this.app.appId,hash:this.confirmHash,order_hash:this.orderHash},{onDone:e=>{if(this.hideModal(),(e=JSON.parse(e)).status===A)return void this.successHandler({success:!0,subscriptionId:e.subscription_id});if(e.hasOwnProperty("error")&&e.error.code===f.NOT_ENOUGH_VOTES)return void this.showErrorModal(getLang("vkapps_connect_modal_subscription_error_title_not_enough_votes"),getLang("vkapps_connect_modal_subscription_error_desc_not_enough_votes"),(()=>{this.errorHandler({code:n.ERROR_CODES.CUSTOM,error_msg:e.error.reason})}));const t=this.isResume?getLang("vkapps_connect_modal_subscription_resuming_error_title"):getLang("vkapps_connect_modal_subscription_payment_error_title");this.showErrorModal(t,getLang("vkapps_connect_modal_subscription_unknown_error_desc"),(()=>{this.errorHandler(e.error)}))},onFail:()=>{this.hideModal();const e=this.isResume?getLang("vkapps_connect_modal_subscription_resuming_error_title"):getLang("vkapps_connect_modal_subscription_payment_error_title");this.showErrorModal(e,getLang("vkapps_connect_modal_subscription_unknown_error_desc"),(()=>{this.errorHandler(R)}))}})}cancel(){clearInterval(this.interval),this.denyUIAction(),this.hideLoader()}refillVotesBalance(e){this.setModalInProgress(e),cur.onSubscriptionCancel=()=>{this.hideModal(),this.errorHandler({reason:n.ERROR_REASONS.USER_DENIED,code:n.ERROR_CODES.USER_DENIED})};const t={act:"a_order",aid:this.app.appId,order_id:this.orderId,votes:0,test_mode:this.votesRefillOptions.test_mode,hash:this.votesRefillOptions.hash,from:nav.objLoc[0],_votes_ok:0};ajax.post("al_apps.php",t,{forceDone:0,onDone:(e,t,a)=>{if(0===a||a>0)return this.hideModal(),void this.showErrorModal(getLang("global_error_occured"),void 0,(()=>{this.errorHandler({reason:n.ERROR_REASONS.UNKNOWN_ERROR,code:n.ERROR_CODES.UNKNOWN})}));this.checkOrderStatus(e)},onFail:e=>!e||(this.hideModal(),this.showErrorModal(getLang("global_error_occured"),e,(()=>{this.errorHandler({reason:n.ERROR_REASONS.UNKNOWN_ERROR,code:n.ERROR_CODES.UNKNOWN})})),!0)})}checkOrderStatus(e,t=0){if(t>=10)return this.hideModal(),void this.showErrorModal(getLang("global_error_occured"),getLang("vkapps_connect_modal_subscription_purchase_error_title"),(()=>{this.errorHandler({reason:"Cannot perform subscription",code:n.ERROR_CODES.UNKNOWN},null,n.ERROR_TYPES.API)}));const{orderId:a,checkHash:r,subscriptionId:s}=e;ajax.post("al_apps.php",{act:"a_check_order",aid:this.app.appId,order_id:a,test_mode:this.votesRefillOptions.test_mode,from:nav.objLoc[0],hash:r},{onDone:a=>{a?(this.hideModal(),a===E?this.successHandler({success:!0,subscriptionId:s}):this.showErrorModal(getLang("global_error_occured"),void 0,(()=>{this.errorHandler({reason:n.ERROR_REASONS.UNKNOWN_ERROR,code:n.ERROR_CODES.UNKNOWN})}))):setTimeout((()=>this.checkOrderStatus(e,t+1)),2e3)},onFail:e=>(this.hideModal(),this.showErrorModal(getLang("global_error_occured"),e,(()=>{this.errorHandler({reason:n.ERROR_REASONS.UNKNOWN_ERROR,code:n.ERROR_CODES.UNKNOWN})})),!0)})}hideModal(){this.modal&&(c.default.pop(this.modal),this.modal.destroy()),this.modal=null}showSubscriptionCancelLoader(){this.showLoader({buttons:[{title:getLang("vkapps_connect_modal_keep_subscription"),type:"success"},{title:getLang("vkapps_connect_modal_cancel_subscription"),type:"deny",disabled:!0}],buttonsClass:"MiniAppsNoWrapButtons",title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_subscription_waiting_item_desc"),allowAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--loader",svgIcon:this.getLoaderIcon(),containerId:this.params.modal.containerId,onlyButtonHide:!0})}showSubscriptionRetrievalLoader(){this.showLoader({buttons:[{title:getLang("vkapps_connect_modal_cancel"),type:"deny"},{title:getLang("vkapps_connect_modal_confirm"),type:"success",disabled:!0}],title:getLang("vkapps_connect_buy_waiting_item_title"),text:getLang("vkapps_connect_subscription_waiting_item_desc"),cancelAction:this.cancel.bind(this),picClass:"vk_app_modal_container__pic--loader",svgIcon:this.getLoaderIcon(),containerId:this.params.modal.containerId,onlyButtonHide:!0})}showLoader(e){this.loader=new o.UIAction({...e}),c.default.push(this.loader)}hideLoader(){this.loader&&(c.default.pop(this.loader),this.loader.destroy()),this.loader=null}setModalInProgress(e){const t=this.modal.props;this.hideModal(),t.buttons.forEach(((t,a)=>{a===e?t.loading=!0:t.disabled=!0})),t.showCloseBtn=!1,this.modal=new o.UIAction(t),c.default.push(this.modal)}markItemPictureAsLoaded(){const e=document.querySelector(".vk_app_modal_container__pic");e&&(this.modal.props.picClass+=" vk_app_modal_container__pic--loaded",e.onload=()=>{e.classList.add("vk_app_modal_container__pic--loaded")})}getSubscriptionDurationInfo(e){const t=Boolean(e.trial_duration),a=t?getLang("vkapps_connect_modal_subscription_charges_info_after_trial"):getLang("vkapps_connect_modal_subscription_charges_info"),r=(0,l.langNumeric)(e.price,getLang("apps_connect_n_votes","raw")).replace("{count}",e.price),s=(0,l.langNumeric)(e.period,getLang("apps_connect_days","raw")).replace("{count}",e.period),i=a.replace("{votes}",r).replace("{period}",s);if(t){const t=(0,l.langNumeric)(e.trial_duration,getLang("apps_connect_days","raw")).replace("{count}",e.trial_duration);return`\n        <span class="vk_app_modal_container__accent_text_row">${getLang("vkapps_connect_modal_subscription_trial_duration").replace("{days_count}",t)}</span>\n        <br>\n        <span class="vk_app_modal_container__secondary_text_row">${i}</span>\n      `}const n=(0,l.langNumeric)(Number(e.balance),getLang("apps_connect_n_votes","raw")).replace("{count}",e.balance);return`\n      <span class="vk_app_modal_container__accent_text_row">${i}</span>\n      <br>\n      <span class="vk_app_modal_container__secondary_text_row">${getLang("vkapps_connect_modal_subscription_votes_balance").replace("{votes}",n)}</span>\n    `}getSubscriptionNextBillTimeInfo(e){const t=this.getNextBillTimeText(e.expire_time),a=new RegExp(`(${Object.values(C).join("|")})`,"g");return getLang("vkapps_connect_subscription_duration_info").replace(a,(e=>{switch(e){case C.DATE:return t;case C.LINK_OPEN_TAG:return`<a href="${(0,s.isMvk)()?"/settings?act=subscriptions":"/settings?act=payments&section=subscriptions"}" target="_blank">`;case C.LINK_CLOSE_TAG:return"</a>"}}))}getNextBillTimeText(e){const t=1e3*e,a=getLang("months_of","raw");return langDate(t,"{day} {month} {year}",0,a)}getSubscriptionModalButtons(e){if(!this.isResume&&e.trial_duration){return[[{title:getLang("vkapps_connect_modal_try_for_free"),type:"success"},{title:getLang("vkapps_connect_modal_cancel"),type:"deny"}],b]}const t=this.isResume?getLang("vkapps_connect_modal_resume"):getLang("vkapps_connect_modal_confirm");return[[{title:getLang("vkapps_connect_modal_cancel"),type:"deny"},{title:t,type:"success"}],w]}getCancelSubscriptionModalButtons(){return[[{title:getLang("vkapps_connect_modal_keep_subscription"),type:"success"},{title:getLang("vkapps_connect_modal_cancel_subscription"),type:"deny"}],S]}getLoaderIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--loader">\n      ${(0,p.getIcon44Spinner)().icon}\n    </div>\n    `}getWarningIcon(){return`\n    <div class="vk_app_modal_svg_icon_container vk_app_modal_svg_icon_container--warning">\n      ${(0,d.getIcon56ErrorTriangleOutline)().icon}\n    </div>\n    `}constructor(e){super(e),this.params.handlerName="VKWebAppShowSubscriptionBox",this.useUI=!1,this.callApi=!1,this.controller="/apps",this.itemId="",this.orderId=0,this.isResume=!1,this.votesRefillOptions=null}}},695799:(e,t,a)=>{a.d(t,{VKWebAppShowWallPostBox:()=>d});var r=a(290788),s=a(52905),i=a(105330),n=a(596377),o=a(957994),c=a(866467),p=a(670053);class d extends r.Handler{setExternalHandlers(){cur.VKWebAppShowWallPostBoxErrorHandler=this.externalErrorHandler,cur.VKWebAppShowWallPostBoxSuccessHandler=this.externalSuccessHandler}unsetCurHandlers(){cur.VKWebAppShowWallPostBoxErrorHandler=null,cur.VKWebAppShowWallPostBoxSuccessHandler=null,(0,i.isMvk)()&&VKApps.cancelSettings()}externalSuccessHandler(e){e&&e[1]?this.successHandler({post_id:e[1]}):this.errorHandler(),this.unsetCurHandlers()}checkUrlString(e){try{return!!new URL(e)}catch{return!1}}externalErrorHandler(){this.errorHandler({code:s.ERROR_CODES.USER_DENIED,reason:"User denied"}),this.unsetCurHandlers()}uploadAttachments(e,t){return new Promise((a=>{const r=[],s=new n.QueueNotifier({queueName:"wallpost",errorCallback:()=>{r.length!==e.length&&a(!1)},stopOnEmptyEvents:!1,processEvent:t=>{const{data:i}=t;if("success"===i.status){const{payload:t,media:n}=i,{type:o,order:c}=t,{id:p,owner_id:d}=n,l=`${o}${d}_${p}`;r[c-1]=l,r.length===e.length&&r.every((e=>!!e))&&(s.stop(),a(r))}else s.stop(),a(!1)}});s.start();const i={app_id:t,attachments:JSON.stringify(e.map((e=>({type:e.type,url:e.link}))))};(0,o.api)("apps.uploadAttachedLinkWallPost",i).catch((()=>{s.stop(),a(!1)}))}))}async actionHandler(e){if(this.data=e,!e.hasOwnProperty("message"))return void this.errorHandler({code:s.ERROR_CODES.MISSING_PARAM,reason:'Missing required param "message"'});if(e.message&&"string"!=typeof e.message)return void this.errorHandler({code:s.ERROR_CODES.INVALID_PARAMS,reason:'Param "message" should be a string'},this.callback);const t=e.upload_attachments;this.data.message=e.message.replace(/(\r)/g,"");const a=this.checkParams(e,[{param:"upload_attachments",type:"object",extraChecks:[{check:e=>e.every((e=>{if("photo"!==e.type)return!0;const{link:t}=e;return t&&this.checkUrlString(t)&&(t.startsWith("https://")||t.startsWith("http://"))})),error:e=>`Param "${e}" should be a valid not empty links`}]}]);let r=t?.filter((({type:e})=>"photo"===e));if(r&&r.length&&a){const t=e.attachments?.split(",")||[];if(t.length+(r?.length||0)>10){const e=10-Math.min(t.length,10);r=r.slice(0,e)}if(r.length){const e=this.showBridgeModal(this.app,{type:"LoaderModal",data:{title:(0,c.getLang)("apps_wall_post_box_title"),loading:!0,error:!1,reload:()=>{this.prepareAttaches(r,this.app.appId,e)}},actions:{onClose:()=>{this.errorHandler({code:s.ERROR_CODES.USER_DENIED,reason:"User denied"})},onDone:()=>{this.clearUploadAttachments(),(0,p.getCurrentApp)().showWallPostBox(this.data,this.successHandler.bind(this),this.errorHandler.bind(this))}}});this.prepareAttaches(r,this.app.appId,e)}else this.clearUploadAttachments(),(0,p.getCurrentApp)().showWallPostBox(this.data,this.successHandler.bind(this),this.errorHandler.bind(this))}r||(0,p.getCurrentApp)().showWallPostBox(this.data,this.successHandler.bind(this),this.errorHandler.bind(this))}async prepareAttaches(e,t,a){const r=this.data.attachments?.split(",")||[];a({data:{loading:!0,errors:!1}});const s=await this.uploadAttachments(e,t);s?(r.push(...s),this.data.attachments=r.join(",")):a({data:{errors:!0}}),a({data:{loading:!1}})}clearUploadAttachments(){delete this.data.upload_attachments}constructor(e){super(e),this.params.handlerName="VKWebAppShowWallPostBox",this.externalSuccessHandler=this.externalSuccessHandler.bind(this),this.externalErrorHandler=this.externalErrorHandler.bind(this),this.setExternalHandlers(),this.data={}}}},588626:(e,t,a)=>{a.d(t,{VKWebAppTrackEvent:()=>o});var r=a(290788),s=a(251703),i=a(52905),n=a(540462);class o extends r.Handler{get successDescriptor(){return"VKWebAppTrackEventResult"}get errorDescriptor(){return"VKWebAppTrackEventFailed"}actionHandler(e){const{appId:t}=this.app,{event_name:a,custom_user_id:r,event_params:o}=e;if(!a)return void this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:"Missing param `event_name`"});const c={eventName:a};if(r&&(c.customUserId=r),o){if("object"!=typeof o)return void this.errorHandler({code:i.ERROR_CODES.INVALID_PARAMS,reason:"Expected `event_params` field to be an object"});c.eventParams=o}(0,s.tmrTrackMiniAppCustom)(t,c),this.successHandler(!0),(0,n.partConfigEnabled)("mini_apps_track_event_extra_call")||super.actionHandler(e)}constructor(e){super(e),this.params.handlerName="VKWebAppTrackEvent",this.callApi=!0}}},517508:(e,t,a)=>{a.d(t,{VKWebAppUpdateConfig:()=>n});var r=a(290788),s=a(877405),i=a(143037);class n extends r.Handler{get successDescriptor(){return this.params.handlerName}actionHandler(){this.successHandler((0,s.getSchemeConfig)())}constructor(e){super(e),this.params.handlerName=i.CONNECT_EVENTS.UPDATE_CONFIG}}},64783:(e,t,a)=>{a.d(t,{default:()=>o});var r=a(10946),s=a(619958),i=a(105330),n=a(234430);const o=class{show(){setTimeout((()=>this.modal.classList.add("show")),300)}destroy(){this.modal.parentNode.removeChild(this.modal),this.callback&&this.callback()}onAction(e){this.props.allowUIAction({scope:e,app_id:this.props.app_id}),this.destroy()}onCancelAction(e){e&&e(),this.destroy()}onAllow(){let e=[];Array.from(this.modal.querySelectorAll(".blind_label:checked")).map((t=>{const a=parseInt(t.id.replace("scope_",""),10);if(!this.props.scopes[a])throw new Error("There is no such scope");e.push(this.props.scopes[a])})),this.onAction(e.join(","))}_renderBtn(e){const t=document.createElement("button");if(t.setAttribute("type","button"),t.classList.add("vk_app_modal_btn"),t.classList.add(`vk_app_modal_btn--${e.type}`),t.innerText=e.title,"success"===e.type?t.addEventListener("click",(()=>this.onAllow())):t.addEventListener("click",(()=>this.onCancelAction(e.action))),e.hasCounter){const a=(0,n.renderCounter)(0);t.appendChild(a),e.counterElement=a}return e.dataTestId&&t.setAttribute("data-testid",e.dataTestId),t}_renderBtns(e){this.props.buttons.map((t=>{e.getElementsByClassName("vk_app_modal_btns")[0].appendChild(this._renderBtn(t))}))}_renderCloseBtn(e){const t=document.createElement("div");t.setAttribute("aria-label","Close"),t.setAttribute("tabindex","0"),t.setAttribute("role","button"),t.classList.add("box_x_button"),t.addEventListener("click",(()=>this.onCancelAction(this.props.cancelAction))),e.querySelector(".box_title_wrap").appendChild(t)}_renderOuter(){return document.querySelector(".vk_app_modal_outer")}_setCounter(e){(0,n.setCounter)(this.props.buttons,e)}_enhanceBtnsWithActions(){this.props.buttons&&this.props.buttons.forEach(((e,t)=>{"deny"===e.type?this.props.buttons[t].action=this.props.cancelAction:this.props.buttons[t].action=this.props.allowAction}))}_renderScopes(e){const t=(0,r.getIcon20CheckBoxOn)().icon,a=(0,s.getIcon20CheckBoxOff)().icon;return e.map(((e,r)=>{const s=getLang(`vkapps_scope_${e}`);return`\n          <div class="scope_row MiniAppModalScope" data-testid="apps_scope_${e}">\n            <label for="scope_${r}" class="MiniAppModalScope">\n              <input class="blind_label MiniAppModalScope__input" type="checkbox" id="scope_${r}" checked="">\n              <span class="MiniAppModalScope__checkIcon MiniAppModalScope__checkIcon--on">${t}</span>\n              <span class="MiniAppModalScope__checkIcon MiniAppModalScope__checkIcon--off">${a}</span>\n              <span class="MiniAppModalScope__text">${s}</span>\n            </label>\n          </div>\n        `})).join("\n")}renderModal(){this._enhanceBtnsWithActions(),this.modal=this._renderOuter();const e=this.modal.children[0],t="none"===getComputedStyle(e).transform||(0,i.isMvk)()?"":`transform: ${e.style.transform}`;this.modal.innerHTML=`\n  <div class="box_layout vk_app_modal_container vk_app_modal_container--scopes-edit" style="${t}">\n    <div class="box_title_wrap">\n       <div class="box_title">${this.props.title}</div>\n    </div>\n    <div class="box_body" style="display: block;">\n      ${this.props.text?`<p>${this.props.text}</p>`:""}\n      ${this.props.scopes&&`<div class="vk_app_modal_scopes">${this._renderScopes(this.props.scopes)}</div>`}\n    </div>\n    <div class="box_controls_wrap" style="display: block;">\n      <div class="box_controls vk_app_modal_btns"></div>\n    </div>\n  </div>\n`;const a=this.modal.querySelectorAll('input[type="checkbox"]');a.forEach((e=>{e.addEventListener("change",(()=>{let e=0;a.forEach((t=>{e+=t.checked?1:0})),this._setCounter(e)}))})),this.props.showCloseBtn&&this._renderCloseBtn(this.modal),this._renderBtns(this.modal),this._setCounter(this.props.scopes.length)}constructor(e,t){this.props={...e},t&&(this.callback=t),this.appNode=document.getElementById(this.props.containerId),this.modal=null,this.onAction=this.onAction.bind(this),this.onCancelAction=this.onCancelAction.bind(this),this.onAllow=this.onAllow.bind(this)}}},397088:(e,t,a)=>{a.d(t,{chooseAction:()=>o,sendMessage:()=>n});var r=a(137233),s=a(52905),i=a(639904);const n=(e,t)=>{let a;if(e.frameId){const t=document.getElementById(e.frameId);t&&(a=t.querySelector("iframe"))}else t&&(a=t.querySelector("iframe"));a&&a.contentWindow.postMessage({...e},"*")},o=(e,t,a)=>{if(r[e.handler]){let o=new r[e.handler]({request_id:e.params.request_id});const c=e?.params?.originalHandlerName;c&&(o.params.originalHandlerName=c);const p={...e.params,containerId:t.containerId,pic:e.pic},d=a||(e=>{const a=document.getElementById(t.containerId);e&&a&&n(e,a)});if(o.FLOOD_RATE){const{eventsCount:a,timeFrame:r}=o.FLOOD_RATE;if(!t.checkBridgeFlood(e.handler,a,r))return o.setData(p,t),o.callback=d,void o.errorHandler({code:s.ERROR_CODES.REQUESTS_LIMIT_REACHED})}!(0,i.isMiniAppServiceAvailable)()&&t.context?.logHandlerCall(e.handler),o.handler(p,t,d)}}},21830:(e,t,a)=>{a.d(t,{random:()=>i});var r=a(898848);const s=2147483647;function i(){try{if(window.crypto){let e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(((e,t)=>e+t)))}}catch(e){}return(0,r.intval)((0,r.rand)(0,s).toFixed(0))}},927097:(e,t,a)=>{a.d(t,{showGoodsOrderBox:()=>i});var r=a(52905),s=a(670053);const i=function(e,t,a,i){const n={},o=(0,s.getCurrentApp)();for(let t in e)["type","external_item_id","request_id"].includes(t)&&(n[t]=e[t].toString());n.act="card_payment_box",n.app_id=o.options.aid,n.hash=o.options.hash;let c=!1;cur.isPaymentsAppOrder=!0,window.showBox("al_payments.php",n,{params:{onHide(){c||i()}},onDone(e,t){c=!0},onFail:e=>(c=!0,void 0===e&&o.options.embed||(window.showFastBox({title:getLang("global_error")},e),a(r.ERROR_CODES.INVALID_PARAMS)),!0)}),cur.onAppOrderCancel=()=>{i()},cur.onAppOrderSuccess=e=>{t(e)},cur.onAppOrderFail=e=>{a(e)}}},541756:(e,t,a)=>{a.d(t,{saveNavigationStatEvent:()=>o,saveViewerStartTime:()=>p});a(351118);var r=a(809152),s=a(601686);function i(){const{connection:e}=navigator;if(!e)return"";const{effectiveType:t,downlink:a}=e;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return a>8?"wi-fi":"LTE"}return""}let n=[];function o({storyRawId:e,source:t,action:a}){let i=0,o=0;e&&([i,o]=(0,s.splitStoryRawId)(e)),"reply"===t&&(t="replies_list");const c={e:r.STATS_EVENT_TYPE_STORIES_VIEWER_NAVIGATION,owner_id:i,story_id:o,source:t,action:a};n.push(c)}let c=[];function p({storyRawId:e,source:t,time:a}){const[n,o]=(0,s.splitStoryRawId)(e),p={e:r.STATS_EVENT_TYPE_STORIES_VIEWING_START_TIME,owner_id:n,story_id:o,source:t,time:a,internet_type:i()};c.push(p)}},45413:(e,t,a)=>{a.d(t,{iDBKVSet:()=>d});var r=a(105330);const s="sw_keyval_db",i="keyval";function n(){if(!function(){const e=(0,r.getGlobalObject)();return!!(e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB)}())throw new Error("IndexedDB is unavailable");return indexedDB}function o(e,t){return new Promise(((a,r)=>{const s=n();let i;try{i=s.open(e)}catch{r(new Error("IndexedDB open failed"))}i.onerror=e=>r(e.target.errorCode?new Error(e.target.errorCode):e.target.error),i.onsuccess=e=>a(e.target.result),i.onupgradeneeded=e=>{let s=e.target.result;return t(s).then((e=>a(e)),(()=>r(new Error("IndexedDB upgrade failed"))))}}))}function c(e,t){return e.transaction([t],"readwrite").objectStore(t)}function p(){return o(s,(e=>new Promise(((t,a)=>{let r=e.createObjectStore(i,{keyPath:"key"});r.onerror=e=>a(e.target.errorCode?new Error(e.target.errorCode):e.target.error),r.oncomplete=()=>t(e)}))))}function d(e,t){return p().then((a=>new Promise(((r,s)=>{let n=c(a,i).put({key:e,val:t});n.onerror=e=>s(e.target.errorCode?new Error(e.target.errorCode):e.target.error),n.onsuccess=()=>r()}))))}},521494:(e,t,a)=>{a.d(t,{AppMobileControlsType:()=>c,Domains:()=>r,Handlers:()=>d,IFRAME_APP_TYPE:()=>s,IFRAME_LOADING_TIMEOUT:()=>_,IgnoredHandlers:()=>p,MVK_DEV_TEST_HOST_MARK:()=>o,PROD_HOSTS:()=>i,SDKProvidedHandlers:()=>l,WEB_DEV_TEST_HOST_MARK:()=>n});const r={VKID:"id",API:"api"},s=1,i=["vk.com","vk.ru","web.vk.me","m.vk.ru","m.vk.com"],n="cs7777",o="m.cs7777",c={DirectGame:0,VkApp:1},p={VKWebAppGetStepsPermissions:"VKWebAppGetStepsPermissions",VKWebAppEnableSwipeBack:"VKWebAppEnableSwipeBack",VKWebAppDisableSwipeBack:"VKWebAppDisableSwipeBack"},d={VKWebAppInit:"VKWebAppInit",VKWebAppValidatePhone:"VKWebAppValidatePhone",VKWebAppGetCommunityAuthToken:"VKWebAppGetCommunityAuthToken",VKWebAppGetCommunityToken:"VKWebAppGetCommunityToken",VKWebAppGetFriends:"VKWebAppGetFriends",VKWebAppAddToCommunity:"VKWebAppAddToCommunity",VKWebAppAddToHomeScreenInfo:"VKWebAppAddToHomeScreenInfo",VKWebAppAddToFavorites:"VKWebAppAddToFavorites",VKWebAppAddToMenu:"VKWebAppAddToMenu",VKWebAppAddToProfile:"VKWebAppAddToProfile",VKWebAppSetLocation:"VKWebAppSetLocation",VKWebAppGetClientVersion:"VKWebAppGetClientVersion",VKWebAppGetPhoneNumber:"VKWebAppGetPhoneNumber",VKWebAppGetEmail:"VKWebAppGetEmail",VKWebAppOpenArticle:"VKWebAppOpenArticle",VKWebAppGetAuthToken:"VKWebAppGetAuthToken",VKWebAppOpenPayForm:"VKWebAppOpenPayForm",VKWebAppOpenApp:"VKWebAppOpenApp",VKWebAppShare:"VKWebAppShare",VKWebAppShowNewPostBox:"VKWebAppShowNewPostBox",VKWebAppShowWallPostBox:"VKWebAppShowWallPostBox",VKWebAppSendToClient:"VKWebAppSendToClient",VKWebAppOpenArticleEditor:"VKWebAppOpenArticleEditor",VKWebAppSendPayload:"VKWebAppSendPayload",VKWebAppUpdateConfig:"VKWebAppUpdateConfig",VKWebAppShowOrderBox:"VKWebAppShowOrderBox",VKWebAppShowGoodOrderBox:"VKWebAppShowGoodOrderBox",VKWebAppShowNftGoodBox:"VKWebAppShowNftGoodBox",VKWebAppShowNftOtpBox:"VKWebAppShowNftOtpBox",VKWebAppShowLeaderBoardBox:"VKWebAppShowLeaderBoardBox",VKWebAppShowLinkCardBox:"VKWebAppShowLinkCardBox",VKWebAppShowNftPaymentBox:"VKWebAppShowNftPaymentBox",VKWebAppShowInviteBox:"VKWebAppShowInviteBox",VKWebAppShowRequestBox:"VKWebAppShowRequestBox",VKWebAppShowCommunityWidgetPreviewBox:"VKWebAppShowCommunityWidgetPreviewBox",VKWebAppOpenInNativeApp:"VKWebAppOpenInNativeApp",VKWebAppLocationChanged:"VKWebAppLocationChanged",VKWebAppClose:"VKWebAppClose",VKWebAppShowStoryBox:"VKWebAppShowStoryBox",VKWebAppShowSubscriptionBox:"VKWebAppShowSubscriptionBox",VKWebAppFlashGetInfo:"VKWebAppFlashGetInfo",VKWebAppOpenWallPost:"VKWebAppOpenWallPost",VKWebAppGetSilentToken:"VKWebAppGetSilentToken",VKWebAppOpenReportForm:"VKWebAppOpenReportForm",VKWebAppTrackEvent:"VKWebAppTrackEvent",VKWebAppActionDone:"VKWebAppActionDone",VKWebAppSendCustomEvent:"VKWebAppSendCustomEvent",VKWebAppCustomMessage:"VKWebAppCustomMessage",VKWebAppRecommend:"VKWebAppRecommend",VKWebAppRemoveFromProfile:"VKWebAppRemoveFromProfile",VKWebAppChangeFragment:"VKWebAppChangeFragment",VKWebAppAddToChat:"VKWebAppAddToChat",VKWebAppCallStart:"VKWebAppCallStart",VKWebAppCallJoin:"VKWebAppCallJoin",VKWebAppCallLeft:"VKWebAppCallLeft",VKWebAppCallFinished:"VKWebAppCallFinished",VKWebAppCallGetStatus:"VKWebAppCallGetStatus",...p},l={VKWebAppAddToFavorites:"VKWebAppAddToFavorites",VKWebAppUpdateConfig:"VKWebAppUpdateConfig",VKWebAppTrackEvent:"VKWebAppTrackEvent",VKWebAppChangeFragment:"VKWebAppChangeFragment"},_=3e4},639904:(e,t,a)=>{a.d(t,{isAdsPlatformConfigFormationAvailable:()=>_,isAnonymousLaunchAvailable:()=>g,isCollectMyTrackerActivity:()=>n,isCollectNewPerformanceMetric:()=>d,isCollectPerformanceForGames:()=>m,isCollectPerformanceFromSDK:()=>c,isCollectSessionsFromMiniAppsSDK:()=>i,isMiniAppServiceAvailable:()=>s,isNewWebviewUrlForLaunch:()=>u,isOpenAppBackNavigationFix:()=>p,isPreventDoubleMountEvent:()=>o,isUpdateWebTokenOnWallPostAvailable:()=>h,isWindowApiConfigDomainsAllow:()=>l});var r=a(540462);function s(){return(0,r.partConfigEnabled)("mini_apps_sdk_launch")}function i(){return(0,r.partConfigEnabled)("mini_apps_collect_sessions_from_sdk")}function n(){return(0,r.partConfigEnabled)("mini_apps_send_my_tracker_activity")}function o(){return(0,r.partConfigEnabled)("mini_apps_prevent_double_mount_event")}function c(){return(0,r.partConfigEnabled)("mini_apps_collect_performance_from_sdk")}function p(){return(0,r.partConfigEnabled)("open_app_back_navigation_fix")}function d(){return(0,r.partConfigEnabled)("mini_apps_performance_v2")}function l(){return(0,r.partConfigEnabled)("allowWindowApiConfigDomains")}function _(){return(0,r.partConfigEnabled)("sdk_ads_new_config_formation")}function h(){return(0,r.partConfigEnabled)("update_web_token_on_vk_web_app_show_wall_post_box")}function u(){return(0,r.partConfigEnabled)("mini_apps_new_webview_url_for_launch")}function m(){return(0,r.partConfigEnabled)("perfomance_stats_in_games")}function g(){return(0,r.partConfigEnabled)("mini_apps_anonymous_launch")}},289274:(e,t,a)=>{a.d(t,{getAnonymAuthUrl:()=>i});var r=a(550325),s=a(521494);function i(){return`https://${(0,r.getDomain)(s.Domains.VKID)}/mini_app_anonym_token`}},194608:(e,t,a)=>{a.d(t,{getAnonymToken:()=>i});var r=a(957994),s=a(352319);function i(){return(0,r.login)("get_anonym_token",{client_secret:s.clientSecret,client_id:s.clientId},{}).then((e=>e.access_token)).catch((()=>{throw new Error("MiniAppsSDK: failed to load anonym auth token")}))}},138688:(e,t,a)=>{a.d(t,{getApiUrl:()=>i});var r=a(550325),s=a(521494);function i(){return`https://${(0,r.getDomain)(s.Domains.API)}/method`}},938530:(e,t,a)=>{function r(e){const t=e.apps.get(e.currentAppId);if(!t)throw new Error("MiniAppsSDK: there is no app data stored yet");return t}a.d(t,{getAppData:()=>r})},34565:(e,t,a)=>{a.d(t,{getAppShortUrl:()=>s});var r=a(550325);function s(e){return`https://${(0,r.getDomain)()}/app${e}`}},311342:(e,t,a)=>{a.d(t,{getAuthUrl:()=>i});var r=a(550325),s=a(521494);function i(){return`https://${(0,r.getDomain)(s.Domains.VKID)}/mini_app_token`}},846692:(e,t,a)=>{function r(e){const t=e.bridges.get(e.currentAppId);if(!t)throw new Error("MiniAppsSDK: there is no bridge connect stored yet");return t}a.d(t,{getBridge:()=>r})},322686:(e,t,a)=>{a.d(t,{getBridgeEventLogger:()=>n});var r=a(540462),s=a(314309),i=a(52905);function n(e,t){return({webviewUrl:a,miniAppId:i,event:n,error:c,bridgeLog:p,callArguments:d})=>{if((0,r.partConfigEnabled)("mini_apps_send_stat_arguments_bridge_events_sdk")&&d&&Array.isArray(t)&&t.includes(n.event_type)){const t={...n,call_arguments:o(d)};return s.bridgeEventItemStat.logEvent(a,i,t,c,e,p)}return s.bridgeEventItemStat.logEvent(a,i,n,c,e,p)}}function o(e){const t=["request_id"],a={...e};for(const e of t)delete a[e];const r=JSON.stringify(a);if(!(r.length>i.BRIDGE_STAT_CALL_ARGUMENTS_MAX_LENGTH))return r}},177606:(e,t,a)=>{a.d(t,{getContainer:()=>s});var r=a(18299);function s(e){const t=document.getElementById((0,r.getContainerId)(e));if(!t)throw new Error("MiniAppsSDK: there is no mini-app container was found");return t}},18299:(e,t,a)=>{function r({aid:e,layer:t}){const a=`app_${e}_container_layer`;return t&&document.getElementById(a)?a:`app_${e}_container`}a.d(t,{getContainerId:()=>r})},550325:(e,t,a)=>{a.d(t,{getDomain:()=>n});var r=a(521494),s=a(105330),i=a(639904);function n(e=""){if(window.vk?.apiConfigDomains&&(0,i.isWindowApiConfigDomainsAllow)()){const t={[r.Domains.API]:window.vk.apiConfigDomains.apiDomain,[r.Domains.VKID]:window.vk.apiConfigDomains.connectDomain};return e?t[e]:window.vk.apiConfigDomains.domain}const t=r.PROD_HOSTS.includes(location.host),a=(0,s.getHostName)(),n=location.host.includes(r.MVK_DEV_TEST_HOST_MARK)?r.MVK_DEV_TEST_HOST_MARK:r.WEB_DEV_TEST_HOST_MARK,o=r.WEB_DEV_TEST_HOST_MARK;return e?t?`${e}.${a}`:location.host.replace(n,`${e}.${o}`):t?a:location.host}},349399:(e,t,a)=>{a.d(t,{getIframeProps:()=>s});var r=a(105330);function s(e,t){const{vkApp:a,widget:s,is_only_dg_runnable_on_web:i,height:n,width:o,iframe_background_color:c,is_clipboard_write_available:p}=t,d={id:e.RPC.frameId,name:e.RPC.frameName,width:"100%",allowFullScreen:!0,style:{border:0,overflow:"hidden",backgroundColor:c,display:"block",colorScheme:"auto"}};a||(0,r.isMvk)()||(d.scrolling="no"),s||(d.height=n),i&&(d.width=o);const l=["geolocation","microphone","camera","autoplay"];return p&&l.push("clipboard-write"),d.allow=l.join("; "),d}},230208:(e,t,a)=>{a.d(t,{getIframeUrl:()=>s});var r=a(521494);function s(e,t){const{hash_as_param:a,type:s,vk_app_url:i,vkApp:n,src:o,is_mini_app_flow:c}=e,{hash:p,...d}=t;if(s!==r.IFRAME_APP_TYPE)return"";const l=!n&&!c,_=new URL(l?o:i),h=p||location.hash.substring(1),u=[];return(l||a)&&u.push(["hash",encodeURIComponent(h)]),l&&u.push(...Object.entries(d)),u.forEach((([e,t])=>_.searchParams.append(e,t))),l||a||(_.hash=h),window.decodeURIComponent(_.href)}},103898:(e,t,a)=>{a.d(t,{getLoginParams:()=>n});var r=a(105330),s=a(856289),i=a(586138);function n(){const e=["web_token"],t=(0,s.isVideoStandalone)(),a=(0,r.isMvkVKVideo)();return t?t&&!a?[...e,{},{appId:i.VK_WEB_VKVIDEO_APP_ID,domain:window.location.hostname,path:"al_video.php"}]:[...e,{},{appId:i.VK_MVK_VKVIDEO_APP_ID,domain:window.location.hostname,path:"video"},!1,{headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"}}]:e}},424010:(e,t,a)=>{a.d(t,{getMiniAppBaseProps:()=>C});var r=a(866467),s=a(365006),i=a(586138),n=a(877405),o=a(101272),c=a(639904),p=a(230208),d=a(349399),l=a(105330),_=a(658961),h=a(540462),u=a(921239),m=a(322686),g=a(311735),v=a(138688),A=a(769828),E=a(194608),f=a(311342),S=a(289274),b=a(534100),w=a(379026),R=a(521494);function C(e,t){if(!e?.app)return null;const{params:a,options:R}=e,{aid:C,app_name:N,ads_options:T,performance_stats_enabled:x}=R,{api_id:D,whitelist_scopes:P}=a,L=(0,p.getIframeUrl)(R,a),V=(0,d.getIframeProps)(e.app,R),W=P?.split(",").filter((e=>e)),{is_layer:M}=(0,n.getSchemeConfig)(),H=(0,c.isAdsPlatformConfigFormationAvailable)()?function(e,t){return{rewarded:{callbacks:{onRewardAdsShown:()=>{t.hideVkAppHeader?.()},onRewardAdsFinished:()=>{t.showVkAppHeader?.()}}},interstitial:{callbacks:{onInterstitialAdsShown:()=>{t.hideVkAppHeader?.()},onInterstitialAdsHidden:()=>{t.showVkAppHeader?.()}},leadAdsModal:!0},banner:{bannerAvailability:{isAvailable:y(e),animated:!(0,l.isMvk)(),position:{top:k(e)},heightType:{compact:(0,l.isMvk)()},orientation:{vertical:O()},verticalOverlay:!(0,l.isMvk)(),verticalRight:I(e)}}}}(R,e.app):void 0,F=T&&!(0,c.isAdsPlatformConfigFormationAvailable)()?function(e,t,a){const{ads_options:r}=t;if(!r)return;return{site_id:r.site_id,sign:r.sign,sign_timestamp:r.sign_timestamp,rewarded:{slot_ids:r.rewarded_slots,timeout_ms:r.rewarded_timeout,limit_ms:r.rewarded_limit_ms,callbacks:{onRewardAdsShown:()=>{a.hideVkAppHeader?.()},onRewardAdsFinished:()=>{a.showVkAppHeader?.()}}},interstitial:{slot_ids:r.interstitial_slots,timeout_ms:r.interstitial_timeout,limit_ms:r.interstitial_limit_ms,callbacks:{onInterstitialAdsShown:()=>{a.hideVkAppHeader?.()},onInterstitialAdsHidden:()=>{a.showVkAppHeader?.()}},leadAdsModal:!0},banner:{autoupdate_ms:r.banner_autoupdate_ms,limit_ms:r.banner_limit_ms,slot_ids:r.banner_slots,bannerAvailability:{isAvailable:y(t),animated:!(0,l.isMvk)(),position:{top:k(t)},heightType:{compact:(0,l.isMvk)()},orientation:{vertical:O()},verticalOverlay:!(0,l.isMvk)(),verticalRight:I(t)}},banner_portlet:{slot_ids:r.banner_portlet_slots,limit_ms:r.banner_portlet_limit_ms,autoupdate_ms:r.banner_portlet_autoupdate_ms},user_id:e,lang:window.langConfig.locale.toLowerCase()}}(a.viewer_id,R,e.app):void 0,K=(0,c.isAnonymousLaunchAvailable)()&&!a.viewer_id;return{apiVersion:s.API_VERSION,userId:a.viewer_id,app:{id:C||D,title:N,url:L,hash:"",query:{},internal:R.is_internal_app},host:{id:(0,l.isMvk)()?i.VK_MVK_APP_ID:i.VK_WEB_APP_ID,title:window.location.host},config:{isLayer:M,scrollTarget:(0,u.getMiniAppScrollTarget)(e.app)||void 0,performance:(0,c.isCollectNewPerformanceMetric)()&&(0,c.isCollectPerformanceFromSDK)()?(0,w.getStartPerformanceMetric)():t},apiUrl:(0,v.getApiUrl)(),authUrl:(0,f.getAuthUrl)(),anonymAuthUrl:(0,S.getAnonymAuthUrl)(),onGetHostToken:K?E.getAnonymToken:A.getToken,getLang:r.getLang,onModalRequest:b.showBridgeModalBox,requestApiMethod:g.requestApiMethod,iframeProps:V,adsConfig:F,adsPlatformConfig:H,featureEnabled:h.partConfigEnabled,featureToggles:{disableAuthByExchangeToken:!0,disableGetAdsConfigFromApi:!T,enableSessionManager:(0,c.isCollectSessionsFromMiniAppsSDK)(),enableCollectPerformance:(0,c.isCollectPerformanceFromSDK)()&&x,motionAdsExperimentGroupA:(0,h.isBelongsToTestGroup)((0,h.getTestGroup)("mini_apps_ads_motion_ads"),h.GROUP_A,1),motionAdsExperimentGroupB:(0,h.isBelongsToTestGroup)((0,h.getTestGroup)("mini_apps_ads_motion_ads"),h.GROUP_B,1)},logBridgeEvent:(0,m.getBridgeEventLogger)(e.app.sessionUuid,R.bridge_methods_to_be_logged),whiteListScopes:W,bridgeMethodsToLogCallArguments:R.bridge_methods_to_be_logged,sendStatEvent:o.writeAndSendWebStats,forceSendStatEvent:e=>{const{id:t,statsMeta:a,wsTransport:r}=window.vk,{st:s,platform:i,time:n,hash:o}=a??{},c=new URLSearchParams,p=(0,_.getBrowserFingerprint)();p&&c.set("device_id",p);const d=c.toString(),l=`${r}/web-stats/p${d&&`?${d}`}`;try{const a=JSON.stringify({id:t,st:s,platform:i,signTime:n,sign:o,attempt:1,...e});"sendBeacon"in navigator&&navigator.sendBeacon(l,a)}catch{throw new Error("MiniAppsSDK: failed send stat event")}},sessionUuid:e.app.sessionUuid,onExternalSessionStart:e.app.onExternalSessionStart?.bind(e.app),onExternalInit:e.app.onExternalInit?.bind(e.app)}}function k(e){return!(0,l.isMvk)()||e.mobile_controls_type===R.AppMobileControlsType.DirectGame}function y(e){return(0,l.isMvk)()||!e.is_internal_app}function O(){return!!(0,h.partConfigEnabled)("mini_apps_ads_banner_redesign_v3")||!(0,l.isMvk)()}function I(e){return!((0,l.isMvk)()&&(e.mobile_controls_type===R.AppMobileControlsType.VkApp||void 0===e.mobile_controls_type))}},354232:(e,t,a)=>{function r(){return Promise.all([a.e(91498),a.e(89631),a.e(94007),a.e(91303),a.e(43451),a.e("langs/web/MiniAppService_MiniApp")]).then(a.bind(a,419485)).then((({MiniApp:e})=>e))}a.d(t,{getMiniAppComponent:()=>r})},157648:(e,t,a)=>{a.d(t,{getMiniAppKey:()=>s});var r=a(540462);function s(e){return(0,r.partConfigEnabled)("mini_apps_sdk_fix_pay_form")?e.layer?`${e.aid}_layer`:`${e.aid}`:e.aid}},921239:(e,t,a)=>{function r(e){if(~e.containerId.indexOf("layer"))return document.querySelector("#wk_layer_wrap")}a.d(t,{getMiniAppScrollTarget:()=>r})},769828:(e,t,a)=>{a.d(t,{getToken:()=>i});var r=a(957994),s=a(103898);const i=()=>(0,r.login)(...(0,s.getLoginParams)()).then((({access_token:e})=>e)).catch((()=>{throw new Error("MiniAppsSDK: failed to load auth token")}))},187561:(e,t,a)=>{a.d(t,{getApiUrl:()=>s.getApiUrl,getAppData:()=>i.getAppData,getAppShortUrl:()=>n.getAppShortUrl,getAuthUrl:()=>o.getAuthUrl,getBridge:()=>c.getBridge,getContainer:()=>p.getContainer,getContainerId:()=>d.getContainerId,getDomain:()=>l.getDomain,getMiniAppBaseProps:()=>_.getMiniAppBaseProps,getMiniAppComponent:()=>h.getMiniAppComponent,getMiniAppKey:()=>u.getMiniAppKey,getToken:()=>m.getToken,requestApiMethod:()=>g.requestApiMethod});var r=a(670053),s=a(138688),i=a(938530),n=a(34565),o=a(311342),c=a(846692),p=(a(322686),a(177606)),d=a(18299),l=a(550325),_=(a(349399),a(230208),a(424010)),h=a(354232),u=a(157648),m=a(769828),g=(a(947017),a(311735));r.getCurrentApp},947017:(e,t,a)=>{a.d(t,{isAPIResponseWithErrors:()=>s});var r=a(898848);function s(e){return(0,r.isObject)(e)&&"execute_errors"in e}},311735:(e,t,a)=>{a.d(t,{requestApiMethod:()=>o});var r=a(957994),s=a(997859),i=a(430039),n=a(947017);function o(e,t,a){const o={...a,grouping:!1};return(0,i.transformAPIParams)(t).then((t=>(0,r.api)(e,t,o).then((e=>{const{response:t,error:a=null,execute_errors:r=null}=(0,n.isAPIResponseWithErrors)(e)?e:{response:e};if((0,s.default)(t)){if(a||r)throw a||r;throw new Error("MiniAppsService: empty api response")}return{response:t}}))))}},524915:(e,t,a)=>{a.d(t,{showAppsBox:()=>s});var r=a(298077);function s(e,t){const a=document.getElementById("apps_box");if(!a)return null;if(a.innerHTML=e,window.show(a),t)try{window.eval(t)}catch(e){(0,r.logEvalError)(e,t)}return a}},430039:(e,t,a)=>{a.d(t,{transformAPIParams:()=>s});var r=a(365815);function s(e){return new Promise(((t,a)=>{t(Object.entries(e).reduce(((e,[t,s])=>{try{return{...e,[t]:"object"==typeof s?JSON.stringify(s):s}}catch{a({error_code:r.ERROR_CODES.INVALID_PARAMS,error_reason:`Param "params[${t}]" should be a valid json`})}}),{}))}))}},379026:(e,t,a)=>{a.d(t,{getStartPerformanceMetric:()=>c});var r=a(694742),s=a(302589);const i=(...e)=>{try{return window.performance.measure(...e)}catch{}};const n=(e,t,a)=>{const r=Math.max(e.startTime,t?.startTime??0),s=performance.timeOrigin+r,i=a?performance.timeOrigin:s;return Math.round(i)},o=e=>{const t=performance.getEntriesByType("navigation")[0],a=e?performance.timeOrigin+t.responseEnd:Date.now();return Math.round(a)},c=()=>{const e=function(e){const t=i(e="__navcustom_"+e,s.ModuleNavigationStatMarks.PERF_MARK_PAGE_START);if(t)return{type:r.CUSTOM_MEASURE_TYPE.SOFT,startTime:t?.startTime??0,duration:t?.duration??0};{const t=i(e);return{type:r.CUSTOM_MEASURE_TYPE.HARD,startTime:t?.startTime??0,duration:t?.duration??0}}}("miniapps_navigation"),t=i("miniapps_navigation",r.PERFORMANCE_MARK_SHOW_WIKI),a=!t&&e.type===r.CUSTOM_MEASURE_TYPE.HARD;return{isDirectLink:a,actResultTime:o(a),startTime:n(e,t,a)}}},56410:(e,t,a)=>{a.d(t,{ADD_TO_COMMUNITY_MODAL_ID:()=>s,ADD_TO_COMMUNITY_MODAL_TYPE:()=>n,RECOMMENDATION_MODAL_TYPE:()=>i,RECOMMENDATION_PROPOSAL_MODAL_ID:()=>r});const r="recommendation-proposal-modal",s="add-to-community-modal",i="recommendation",n="add_to_community"},649446:(e,t,a)=>{a.d(t,{getTranslations:()=>i,scopeFilter:()=>n,transformToArrayScopes:()=>c,transformToStringScopes:()=>p,transformToStringTranslatedScopes:()=>o});var r=a(866467),s=a(540462);function i(){return{friends:(0,r.getLang)("vkapps_scope_friends"),photos:(0,r.getLang)("vkapps_scope_photos"),video:(0,r.getLang)("vkapps_scope_video"),stories:(0,r.getLang)("vkapps_scope_stories"),pages:(0,r.getLang)("vkapps_scope_pages"),status:(0,r.getLang)("vkapps_scope_status"),notes:(0,r.getLang)("vkapps_scope_notes"),wall:(0,r.getLang)("vkapps_scope_wall"),docs:(0,r.getLang)("vkapps_scope_docs"),groups:(0,r.getLang)("vkapps_scope_groups"),stats:(0,r.getLang)("vkapps_scope_stats"),market:(0,r.getLang)("vkapps_scope_market"),notify:(0,r.getLang)("vkapps_scope_notify"),audio:(0,r.getLang)("vkapps_scope_audio"),menu:(0,r.getLang)("vkapps_scope_menu"),wallmenu:(0,r.getLang)("vkapps_scope_wallmenu"),messages:(0,r.getLang)("vkapps_scope_messages"),ads:(0,r.getLang)("vkapps_scope_ads"),offline:(0,r.getLang)("vkapps_scope_offline"),notifications:(0,r.getLang)("vkapps_scope_notifications"),email:(0,r.getLang)("vkapps_scope_email"),adsweb:(0,r.getLang)("vkapps_scope_adsweb"),group_messages:(0,r.getLang)("vkapps_scope_group_messages"),phone:(0,r.getLang)("vkapps_scope_phone"),app_widget:(0,r.getLang)("vkapps_scope_app_widget"),manage:(0,r.getLang)("vkapps_scope_manage")}}const n=e=>!(0,s.partConfigEnabled)("mini_apps_auth_token_reject_empty_scopes")||""!==e;function o(e){const t=i();return e.split(",").map((e=>e.trim())).filter(n).map(((e,a)=>{const r=t[e];return 0===a?r:r.toLowerCase()})).join(", ")}const c=e=>e.split(",").map((e=>e.trim())).filter(n).map((e=>({label:e,checked:!0}))),p=e=>e.filter((e=>e.checked)).map((e=>e.label)).join(",")},596377:(e,t,a)=>{a.d(t,{QueueNotifier:()=>i});var r=a(957994),s=a(342018);class i{subscribe(){this._subscribe().then((e=>{if(this.statusActive&&e?.ts){if(this.statusActive&&!e?.events?.length&&this.stopOnEmptyEvents)return this.errorCallback?.(),void this.stop();this.ts=e.ts,this.subscribe(),this.processEvents(e.events)}}))}processEvents(e){this.statusActive&&e&&e.forEach((e=>{this.processEvent(e)}))}_subscribe(){const e=this.getUrl("a_check");return this.unsubscribe=()=>{this._unsubscribe(),this.unsubscribe=()=>{}},fetch(e).then((e=>e.json())).catch((()=>{this.statusActive=!1,this.errorCallback?.()}))}_unsubscribe(){const e=this.getUrl("a_release");fetch(e)}start(){this.statusActive||((0,r.api)("queue.subscribe",{queue_ids:this.queueName}).then((({base_url:e,queues:t})=>{const a=t[0];if(!a)throw new Error("No queue to subscribe");this.base=e,this.key=a.key,this.ts=a.timestamp,this.subscribe()})).catch((()=>{this.statusActive=!1,this.errorCallback?.()})),this.statusActive=!0)}stop(){this.destroy()}destroy(){this.statusActive=!1,this.unsubscribe()}constructor({queueName:e,processEvent:t,errorCallback:a,stopOnEmptyEvents:r=!0}){this.userId=window.vk.id,this.WAIT_TIMEOUT=30,this.unsubscribe=()=>{},this.getUrl=e=>`${this.base}?act=${e}&key=${this.key}&id=${this.userId}&ts=${this.ts}&wait=${this.WAIT_TIMEOUT}`,this.processEvent=t,this.errorCallback=a,this.queueName=`${e}_${this.userId}`,this.stopOnEmptyEvents=!!r;const i=()=>{window.removeEventListener("beforeunload",i),this.destroy()};window.addEventListener("beforeunload",i),(0,s.pushNavDestroy)((()=>{window.removeEventListener("beforeunload",i),i()}))}}},143037:(e,t,a)=>{a.d(t,{CONNECT_EVENTS:()=>s,EVENT_STATES:()=>r});var r=function(e){return e.FIRE="",e.FAILURE="Failed",e.SUCCESS="Result",e}({}),s=function(e){return e.ADD_TO_COMMUNITY="VKWebAppAddToCommunity",e.ADD_TO_COMMUNITY_PRELOAD="VKWebAppAddToCommunityPreload",e.ADD_TO_FAVORITES="VKWebAppAddToFavorites",e.ADD_TO_MENU="VKWebAppAddToMenu",e.ADD_TO_HOME_SCREEN_INFO="VKWebAppAddToHomeScreenInfo",e.ALLOW_NOTIFICATIONS="VKWebAppAllowNotifications",e.CHANGE_FRAGMENT="VKWebAppChangeFragment",e.CLOSE="VKWebAppClose",e.DENY_NOTIFICATIONS="VKWebAppDenyNotifications",e.FLASH_GET_INFO="VKWebAppFlashGetInfo",e.FLASH_SET_LEVEL="VKWebAppFlashSetLevel",e.GET_AUTH_TOKEN="VKWebAppGetAuthToken",e.GET_AUTH_TOKEN_PRELOAD="VKWebAppGetAuthTokenPreload",e.GET_CLIENT_VERSION="VKWebAppGetClientVersion",e.GET_COMMUNITY_AUTH_TOKEN="VKWebAppGetCommunityAuthToken",e.GET_COMMUNITY_TOKEN="VKWebAppGetCommunityToken",e.GET_EMAIL_PRELOAD="VKWebAppGetEmailPreload",e.GET_EMAIL="VKWebAppGetEmail",e.GET_FRIENDS="VKWebAppGetFriends",e.GET_FLASH_INFO="VKWebAppGetFlashInfo",e.GET_GEODATA="VKWebAppGetGeodata",e.GET_PHONE_NUMBER_PRELOAD="VKWebAppGetPhoneNumberPreload",e.GET_PHONE_NUMBER="VKWebAppGetPhoneNumber",e.INIT="VKWebAppInit",e.LOCATION_CHANGED="VKWebAppLocationChanged",e.OPEN_APP="VKWebAppOpenApp",e.OPEN_IN_NATIVE_APP="VKWebAppOpenInNativeApp",e.OPEN_PAY_FORM="VKWebAppOpenPayForm",e.REDIRECT="VKWebAppRedirect",e.SEND_PAYLOAD="VKWebAppSendPayload",e.SEND_TO_CLIENT="VKWebAppSendToClient",e.SEND_TO_CLIENT_PRELOAD="VKWebAppSendToClientPreload",e.SETTINGS="VKWebAppSettings",e.SET_LOCATION="VKWebAppSetLocation",e.SHARE="VKWebAppShare",e.SHOW_NEW_POST_BOX="VKWebAppShowNewPostBox",e.SHOW_INVITE_BOX="VKWebAppShowInviteBox",e.SHOW_STORY_BOX="VKWebAppShowStoryBox",e.SHOW_STORY_BOX_LOAD_FINISH="VKWebAppShowStoryBoxLoadFinish",e.SHOW_LEADER_BOARD_BOX="VKWebAppShowLeaderBoardBox",e.SHOW_LINK_CARD_BOX="VKWebAppShowLinkCardBox",e.SHOW_NFT_PAY_BOX="VKWebAppShowNftPaymentBox",e.SHOW_ORDER_BOX="VKWebAppShowOrderBox",e.SHOW_REQUEST_BOX="VKWebAppShowRequestBox",e.SHOW_WALL_POST_BOX="VKWebAppShowWallPostBox",e.UPDATE_CONFIG="VKWebAppUpdateConfig",e.VIEW_UPDATE_NAVIGATION_STATE="VKWebAppViewUpdateNavigationState",e.OPEN_ARTICLE_EDIT="VKWebAppOpenArticleEditor",e.OPEN_ARTICLE="VKWebAppOpenArticle",e.ADD_TO_CHAT="VKWebAppAddToChat",e.CALL_START="VKWebAppCallStart",e.CALL_JOIN="VKWebAppCallJoin",e.CALL_LEFT="VKWebAppCallLeft",e.CALL_FINISHED="VKWebAppCallFinished",e.CALL_GET_STATUS="VKWebAppCallGetStatus",e}({})},195525:(e,t,a)=>{a.d(t,{getFailSnackbar:()=>c,getModal:()=>p,getSuccessSnackbar:()=>o});var r=a(866467),s=a(111757),i=a(64801),n=a(913741);const o=(e="",t)=>{const a="game"===window.cur.module?(0,r.getLang)("me_snackbar_success_add_game_attach"):(0,r.getLang)("me_snackbar_success_add_miniapp_attach");if(t){const t={type:i.SnackbarTypes.SNACKBAR_TYPE_SUCCESS,vertical:!1,text:a};return e&&(t.action={text:(0,r.getLang)("me_snackbar_open_chat"),url:e,target:"_self"}),t}const s=`Notifier.hideAllEvents(); window.Apps.closeLayer({ withConfirm: window.wkcur && window.wkcur.shown, redirect: '${e}' })`;return`\n    <div>\n      <p class="${n.default.snackbarTitle}">${a}</p>\n      ${e&&`<a onclick="${s}">${(0,r.getLang)("me_snackbar_open_chat")}</a>`}\n    </div>\n  `},c=e=>{if(e){return{type:i.SnackbarTypes.SNACKBAR_TYPE_ERROR,vertical:!1,text:{inner:[{inner:(0,r.getLang)("me_snackbar_fail_title")},{inner:(0,r.getLang)("me_snackbar_fail_subtitle")}]}}}return`\n      <div>\n        <p class="${n.default.snackbarTitle}">${(0,r.getLang)("me_snackbar_fail_title")}</p>\n        <p class="${n.default.snackbarTitle}">${(0,r.getLang)("me_snackbar_fail_subtitle")}</p>\n      </div>\n    `},p=(e,t,a)=>{const n=[];n[0]={title:(0,r.getLang)("mobile_attachments_add_app_to_chat_confirm_modal_cancel"),type:i.ModalButtonType.DENY},n[1]={title:e===s.Refs.REF_ATTACH_PICKER?(0,r.getLang)("mobile_attachments_add_app_to_chat_confirm_modal_add"):(0,r.getLang)("me_app_action_attach_choose_chat"),type:i.ModalButtonType.SUCCESS};const o={...a,picClass:"vk_app_modal_container__pic--rounded",title:(0,r.langReplace)(e===s.Refs.REF_ATTACH_PICKER?(0,r.getLang)("mobile_attachments_add_app_to_chat_confirm_modal"):(0,r.getLang)("me_add_app_action_attach_to_chats_title"),{action_title:t}),showCloseBtn:!1,buttonsClass:e===s.Refs.REF_ATTACH_PICKER?"vk_app_modal_btns--withoutText":"vk_app_modal_btns--withText",buttons:n};return e!==s.Refs.REF_ATTACH_PICKER&&(o.text=(0,r.getLang)("me_add_app_action_attach_to_chats_subtitle")),o}},64801:(e,t,a)=>{a.d(t,{ModalButtonType:()=>r,SnackbarTypes:()=>s});var r=function(e){return e.DENY="deny",e.SUCCESS="success",e}({}),s=function(e){return e[e.SNACKBAR_TYPE_SUCCESS=1]="SNACKBAR_TYPE_SUCCESS",e[e.SNACKBAR_TYPE_ERROR=2]="SNACKBAR_TYPE_ERROR",e}({})},537833:(e,t,a)=>{a.d(t,{IDB_APP_CALLS_KEY:()=>r});const r="app_calls"},500240:(e,t,a)=>{a.d(t,{CallLeftReason:()=>r});var r=function(e){return e.GENERAL="general",e}({})},727772:(e,t,a)=>{a.d(t,{getAppOptions:()=>n,saveCallParams:()=>o});var r=a(537833),s=a(45413),i=a(670053);const n=()=>{const e=(0,i.getCurrentApp)();return e?e.options:null},o=async e=>{const{callId:t,joinLink:a,host:i=!1}=e;try{await(0,s.iDBKVSet)(r.IDB_APP_CALLS_KEY,{[t]:{joinLink:a,host:i}})}catch(e){throw new Error("Can't save call params to iDB")}}},759561:(e,t,a)=>{a.d(t,{fetchFriends:()=>s});var r=a(957994);const s=(e,t,a)=>(0,r.api)("friends.get",{fields:"photo_200_orig, sex, screen_name,",count:t,offset:e},void 0,{signal:a.signal})},432399:(e,t,a)=>{a.d(t,{fetchFriendsByName:()=>s});var r=a(957994);const s=(e,t,a,s)=>(0,r.api)("friends.search",{fields:"photo_200_orig, sex, screen_name,",count:a,q:e,offset:t},void 0,{signal:s.signal})},689491:(e,t,a)=>{a.d(t,{FriendAvatar:()=>p});var r=a(474848),s=a(612196),i=a(296540),n=a(437569),o=a(82987),c=a(293721);const p=(0,i.memo)((({id:e,photo:t})=>{const a=(0,c.useEvent)(o.unselectFriendEvent);return(0,r.jsx)(s.Avatar,{onClick:()=>a(e),src:t,size:45,children:(0,r.jsx)(s.Avatar.Overlay,{visibility:"on-hover",theme:"dark",children:(0,r.jsx)(n.Icon28Cancel,{})})})}))},681937:(e,t,a)=>{a.d(t,{FriendCell:()=>g});var r=a(474848),s=a(296540),i=a(704178),n=a(16496),o=a(723723),c=a(260546),p=a(612196),d=a(82987),l=a(293721),_=a(351118),h=a(810923);const u=(0,r.jsx)(i.Icon24CheckCircleOff,{height:20,width:20,className:(0,_.classNames)(h.default.checkIconCircle,(0,o.getColorClass)("color_icon_secondary"))}),m=(0,r.jsx)(n.Icon24CheckCircleOn,{height:20,width:20,className:(0,_.classNames)(h.default.checkIconCircle,(0,o.getColorClass)("color_icon_accent"))}),g=(0,s.memo)((({multi:e,isSelected:t,friend:a})=>{const s=(0,l.useEvent)(d.selectFriendEvent),i=(0,l.useEvent)(d.unselectFriendEvent);return(0,r.jsx)(c.SimpleCell,{after:e&&(t?m:u),onClick:()=>((e,t,a,r,s)=>{s&&t?r(e.id):a(e)})(a,t,s,i,e),children:(0,r.jsxs)("div",{className:h.default.friendCellUser,children:[(0,r.jsx)(p.Avatar,{src:a.photo_200_orig,size:40}),`${a.first_name} ${a.last_name}`]})})}))},472163:(e,t,a)=>{a.d(t,{FriendListContainer:()=>A});var r=a(474848),s=a(296540),i=a(264458),n=a(285056),o=a(220208),c=a(582192),p=a(720836),d=a(700272),l=a(293721),_=a(395218),h=a(866467),u=a(82987),m=a(570089),g=a(750976),v=a(661113);const A=(0,s.memo)((({multi:e,isSelectedFriends:t})=>{const[a,A]=(0,s.useState)(""),E=(0,l.useStore)(u.$countFriendsByName),f=(0,l.useStore)(u.$displaySelected),S=(0,l.useStore)(u.$friendsData),b=(0,l.useStore)(u.$idsToShow),w=(0,l.useEvent)(u.changeMode),R=(0,s.useRef)(null),C=(0,v.useDebounce)(a,200);(0,s.useEffect)((()=>{R.current&&(R.current.scrollTop=0,(0,u.getFriendsFromCacheOnInputChange)(C))}),[C]);const k=()=>w(!f);(0,s.useEffect)((()=>{R.current&&(R.current.scrollTop=0,A(""),(0,u.getFriendsFromCacheOnInputChange)(""))}),[f]);const[y,O]=(0,s.useMemo)((()=>{let e=!1;const t=f&&S?b.filter((e=>!!S.get(e)?.is_selected)):b;return f&&(0,u.updateCountFriendsByNameFromCache)(t),[t,{count:t.length,overscan:15,estimateSize:()=>60,getScrollElement:()=>R.current,onChange:f||b.length>=E?void 0:t=>{t.range&&t.range.endIndex>b.length-15&&!e&&((0,u.loadFriendsOnScroll)(),e=!0)}}]}),[b,f,E]);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:m.default.searchControl,children:[(0,r.jsx)(i.Search,{value:a,onChange:e=>{e.target.value.trim().length||(e.target.value=""),A(e.target.value)}}),t&&e&&(0,r.jsxs)("div",{className:m.default.searchControlSwitch,children:[(0,r.jsx)(n.Text,{weight:"1",onClick:k,children:(0,h.getLang)("friends_list_show_selected")}),(0,r.jsx)(o.Switch,{onChange:k,checked:f})]})]}),(0,r.jsx)(c.Separator,{wide:!0}),(0,r.jsx)("div",{className:m.default.scrollContainerWrapper,children:(0,r.jsxs)("div",{className:m.default.scrollContainer,ref:R,children:[S&&(0,r.jsx)(_.VirtualizedFriendList,{multi:e,options:O,friendsData:S,filtredFriends:y}),!E&&!y.length&&(0,r.jsx)(p.Placeholder,{children:(0,h.getLang)("apps_no_friends_for_query")}),(E===g.UNKNOWN_FRIENDS_COUNT||E>y.length)&&(0,r.jsx)(p.Placeholder,{children:(0,r.jsx)(d.Spinner,{size:"large"})})]})})]})}))},38511:(e,t,a)=>{a.d(t,{GetFriendsModal:()=>S});var r=a(474848),s=a(296540),i=a(694244),n=a(782174),o=a(194528),c=a(303800),p=a(354592),d=a(213338),l=a(612196),_=a(908242),h=a(454154),u=a(866467),m=a(293721),g=a(82987),v=a(689491),A=a(472163),E=a(351118),f=(a(250053),a(977629));const S=({multi:e,onDone:t,onClose:a,updateCoordinates:S})=>{const b=(0,m.useStore)(g.$selectedFriends),w=(0,m.useStore)(g.$displaySelected),R=0===b.length,C=(0,m.useEvent)(g.changeMode),k=(0,s.useCallback)((()=>{t(b)}),[b,t]);return(0,s.useEffect)((()=>{R?(0,g.changeMode)(!1):e||t(b)}),[R]),(0,s.useEffect)((()=>{S&&S()}),[]),(0,r.jsxs)(i.ModalBox,{"data-testid":"apps_get_friends_modal",children:[(0,r.jsx)(n.ModalHeader,{closeAriaLabel:"Закрыть",onClose:a,children:(0,u.getLang)("apps_get_friends_box_titles")}),(0,r.jsx)(o.Spacing,{size:10}),(R||!e)&&(0,r.jsxs)(c.Div,{className:f.default.title,children:[(0,r.jsx)(o.Spacing,{size:19}),(0,u.getLang)("friends_flist_can_select_new"),(0,r.jsx)(o.Spacing,{size:19})]}),(0,r.jsx)(p.HorizontalScroll,{children:!R&&(0,r.jsxs)("div",{className:f.default.avatarScroll,children:[b.slice(0,7).map((e=>(0,r.jsx)(d.HorizontalCell,{disabled:!0,header:e.first_name,children:(0,r.jsx)(v.FriendAvatar,{id:e.id,photo:e.photo_200??""})},e.id.toString()))),b.length>7&&(0,r.jsx)(d.HorizontalCell,{disabled:!0,children:(0,r.jsxs)(l.Avatar,{onClick:()=>C(!w),className:(0,E.classNames)(f.default.showAll,{[f.default.showAllActive]:w}),children:["+",b.length-7]})})]})}),(0,r.jsx)(A.FriendListContainer,{multi:e,isSelectedFriends:!R}),(0,r.jsx)(_.ModalFooter,{actions:[(0,r.jsx)(h.Button,{onClick:a,mode:"tertiary",size:"m",children:(0,u.getLang)("global_cancel")},"cancel"),(0,r.jsx)(h.Button,{onClick:k,size:"m",children:(0,u.getLang)("apps_done")},"ok")]})]})}},395218:(e,t,a)=>{a.d(t,{VirtualizedFriendList:()=>o});var r=a(474848),s=a(651220),i=a(681937),n=a(858861);const o=({options:e,friendsData:t,filtredFriends:a,multi:o})=>{const c=(0,s.useVirtualizer)(e);return(0,r.jsx)("div",{className:n.default.friendScrollBox,style:{height:`${c.getTotalSize()}px`},children:c.getVirtualItems().map((e=>{const s=a[e.index],c=t.get(s);return c&&(0,r.jsx)("div",{className:n.default.friendItem,style:{transform:`translateY(${e.start}px)`},"data-testid":"apps_get_friends_friend_cell",children:(0,r.jsx)(i.FriendCell,{multi:o,friend:c,isSelected:c.is_selected})},s.toString())}))})}},750976:(e,t,a)=>{a.d(t,{ACT_FRIEND_FIRST_NAME_INDEX:()=>c,ACT_FRIEND_ID_INDEX:()=>i,ACT_FRIEND_LAST_NAME_INDEX:()=>o,ACT_FRIEND_PHOTO_INDEX:()=>p,ACT_FRIEND_SEX_INDEX:()=>n,MAX_FRIENDS_PER_REQUEST:()=>r,UNKNOWN_FRIENDS_COUNT:()=>s});const r=40,s=-1,i=0,n=5,o=1,c=0,p=2},760241:(e,t,a)=>{a.d(t,{VKWebAppGetFriends:()=>_});var r=a(290788),s=a(534100),i=a(38511),n=a(52905),o=a(540462),c=a(105330),p=a(82987),d=a(750976),l=a(670053);class _ extends r.Handler{loadIntroData(e){(0,o.partConfigEnabled)("mini_apps.web_app_get_friends_with_api")?this.getFriendsWithApi(e):this.getFriendsWithAct(e)}handler(e,t,a){this.setData(e,t),this.callback=a;const r={...e};this.checkParams(e,[{param:"multi",type:"boolean"},{param:"lists",type:"boolean"}])&&((0,p.resetStore)(),r.multi||delete r.multi,this.actionHandler(r))}actionHandler(e){return this.loadIntroData(e),{}}async getFriendsWithApi(e){if((0,o.partConfigEnabled)("mini_apps_get_friends_mvk"))this.showBridgeModal(this.app,{type:"GetFriendsModal",data:e,actions:{onDone:e=>{this.successHandler({users:e}),(0,p.resetStore)()},onClose:()=>{this.errorHandler({code:n.ERROR_CODES.USER_DENIED,reason:n.ERROR_REASONS.USER_DENIED}),(0,p.resetStore)()}}});else if((0,c.isMvk)())this.errorHandler({code:n.ERROR_CODES.UNSUPPORTED_PLATFORM,error_type:n.ERROR_TYPES.CLIENT,reason:n.ERROR_REASONS.UNSUPPORTED_PLATFORM});else{const t=await(0,s.showModalBox)(i.GetFriendsModal,{...e},{width:"560px",fixed:!0});t?this.successHandler({users:t}):this.errorHandler({code:n.ERROR_CODES.USER_DENIED,reason:n.ERROR_REASONS.USER_DENIED}),(0,p.resetStore)()}}getFriendsWithAct(e){this.request={...e},window.cur.onFlistSave=(...e)=>this.onFlistSave(...e),window.cur.onFlistHide=this.onFlistHide,window.showTabbedBox("apps.php",{act:"handle_vk_connect_event",hash:(0,l.getCurrentApp)()?.options[`${n.VK_CONNECT_EVENTS[`${this.params.handlerName}`]}_hash`],event:n.VK_CONNECT_EVENTS[`${this.params.handlerName}`],app_id:this.app.appId,...this.request},{stat:["ui_controls.js","ui_controls.css"]})}onFlistSave(e,t){this.hasSuccess=!0;const a={users:[],lists:[]};a.users=t.friends.map((e=>{const t=e[1].split(" ");return{id:e[d.ACT_FRIEND_ID_INDEX],sex:e[d.ACT_FRIEND_SEX_INDEX],last_name:t[d.ACT_FRIEND_LAST_NAME_INDEX]??"",first_name:t[d.ACT_FRIEND_FIRST_NAME_INDEX],photo_200:e[d.ACT_FRIEND_PHOTO_INDEX]}})),this.request.lists&&(a.lists=t.lists.map((([e])=>e)).sort(((e,t)=>e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0))),this.successHandler(a)}constructor(e){super(e),this.onFlistHide=()=>{this.hasSuccess||this.errorHandler({code:n.ERROR_CODES.USER_DENIED})},this.params.handlerName="VKWebAppGetFriends",this.callApi=!0}}},82987:(e,t,a)=>{a.d(t,{$countFriendsByName:()=>r.$countFriendsByName,$displaySelected:()=>s.$displaySelected,$fetchConfig:()=>r.$fetchConfig,$friendsData:()=>r.$friendsData,$friendsDataSize:()=>r.$friendsDataSize,$idsToShow:()=>r.$idsToShow,$indexer:()=>r.$indexer,$queryData:()=>r.$queryData,$selectedFriends:()=>s.$selectedFriends,changeMode:()=>s.changeMode,fetchFriendsFx:()=>r.fetchFriendsFx,getFriendsFromCacheOnInputChange:()=>r.getFriendsFromCacheOnInputChange,loadFriendsOnInputChange:()=>r.loadFriendsOnInputChange,loadFriendsOnScroll:()=>r.loadFriendsOnScroll,parseFetchedData:()=>r.parseFetchedData,resetStore:()=>r.resetStore,selectFriendEvent:()=>s.selectFriendEvent,unselectFriendEvent:()=>s.unselectFriendEvent,updateCountFriendsByNameFromCache:()=>r.updateCountFriendsByNameFromCache,updateIdsToShowFromCache:()=>r.updateIdsToShowFromCache});var r=a(550848),s=a(635020)},250053:(e,t,a)=>{a(333141),a(876147)},550848:(e,t,a)=>{a.d(t,{$countFriendsByName:()=>E,$fetchConfig:()=>R,$friendsData:()=>S,$friendsDataSize:()=>b,$idsToShow:()=>A,$indexer:()=>w,$queryData:()=>f,domain:()=>p,fetchFriendsFx:()=>v,getFriendsFromCacheOnInputChange:()=>h,loadFriendsOnInputChange:()=>d,loadFriendsOnScroll:()=>l,parseFetchedData:()=>_,resetStore:()=>g,updateCountFriendsByNameFromCache:()=>u,updateIdsToShowFromCache:()=>m});var r=a(32489),s=a(432399),i=a(759561),n=a(230359),o=a(423676),c=a(750976);const p=(0,r.createDomain)("getFriends"),d=p.createEvent("loadFriendsOnInputChange"),l=p.createEvent("loadFriendsOnScroll"),_=p.createEvent("resetStore"),h=p.createEvent("getFriendsFromCacheOnInputChange"),u=p.createEvent("updateCountFriendsByNameFromCache"),m=p.createEvent("updateIdsToShowFromCache"),g=p.createEvent("resetStore"),v=p.createEffect((async({count:e=c.MAX_FRIENDS_PER_REQUEST,offset:t,inputValue:a,abortController:r})=>{const o=(0,n.transliterate)(a),p=a?(0,s.fetchFriendsByName)(a,t,e,r):(0,i.fetchFriends)(t,e,r),d=o?(0,s.fetchFriendsByName)(o,t,e,r):{items:[],count:0},l=await Promise.all([p,d]),_=l[0].count+l[1].count;return{query:a,friends:l[0].items.concat(l[1].items),count:_,offset:t+e}})),A=p.createStore([]),E=p.createStore(c.UNKNOWN_FRIENDS_COUNT),f=p.createStore(null),S=p.createStore(null),b=S.map((e=>e?e.size:0)),w=p.createStore(new o.VkIndexer([],(e=>e.full_name))),R=p.createStore({inputValue:"",abortController:new AbortController,offset:0})},635020:(e,t,a)=>{a.d(t,{$displaySelected:()=>o,$selectedFriends:()=>c,changeMode:()=>n,selectFriendEvent:()=>i,unselectFriendEvent:()=>s});var r=a(550848);const s=r.domain.createEvent("remove/friend"),i=r.domain.createEvent("add/friend"),n=r.domain.createEvent("select"),o=r.domain.createStore(!1),c=r.domain.createStore([])},333141:(e,t,a)=>{var r=a(32489),s=a(82987),i=a(230359),n=a(423676),o=a(750976);(0,r.sample)({clock:s.fetchFriendsFx,fn:()=>o.UNKNOWN_FRIENDS_COUNT,target:s.$countFriendsByName}),(0,r.sample)({clock:s.fetchFriendsFx.doneData,source:s.$queryData,fn:(e,t)=>(e||(e=new Map),t.count>0&&e.set(t.query,{count:t.count,offset:t.offset}),e),target:s.$queryData}),(0,r.sample)({clock:s.fetchFriendsFx.doneData,source:s.$friendsData,fn:(e,t)=>{e||(e=new Map);const a=t.friends.map((t=>(e&&!e.has(t.id)&&e.set(t.id,{id:t.id,is_selected:!1,sex:t.sex,last_name:t.last_name,first_name:t.first_name,screen_name:t.screen_name,photo_200_orig:t.photo_200_orig}),t.id)));return{friendsData:e,idsToShow:a,count:t.count}},target:s.parseFetchedData}),(0,r.sample)({clock:s.parseFetchedData,fn:e=>new Map(e.friendsData.entries()),target:s.$friendsData}),(0,r.sample)({clock:s.parseFetchedData,source:s.$idsToShow,fn:(e,t)=>[...new Set(e.concat(t.idsToShow))],target:s.$idsToShow}),(0,r.sample)({clock:s.parseFetchedData,fn:e=>e.count,target:s.$countFriendsByName}),(0,r.sample)({clock:s.$friendsDataSize,source:s.$friendsData,fn:e=>{e||(e=new Map);const t=Array.from(e.values());return new n.VkIndexer(t.map(i.indexerFriendPrepare),(e=>e.full_name))},target:s.$indexer}),(0,r.sample)({clock:s.loadFriendsOnScroll,source:{fetchConfig:s.$fetchConfig,queryData:s.$queryData},fn:({fetchConfig:e,queryData:t})=>{const a=t&&t.get(e.inputValue)?.offset;return{inputValue:e.inputValue,offset:a??e.offset+o.MAX_FRIENDS_PER_REQUEST,abortController:new AbortController}},target:[s.fetchFriendsFx,s.$fetchConfig]}),(0,r.sample)({clock:s.getFriendsFromCacheOnInputChange,source:{fetchConfig:s.$fetchConfig,queryData:s.$queryData,friendsData:s.$friendsData,indexer:s.$indexer,displaySelected:s.$displaySelected},fn:({indexer:e,friendsData:t},a)=>{t||(t=new Map);return{cachedFriends:a?e.search(a).map((e=>e.id)):Array.from(t.keys()),query:a}},target:[s.loadFriendsOnInputChange,s.updateIdsToShowFromCache]}),(0,r.sample)({clock:s.updateIdsToShowFromCache,fn:({cachedFriends:e})=>e,target:[s.$idsToShow,s.updateCountFriendsByNameFromCache]}),(0,r.sample)({clock:s.updateCountFriendsByNameFromCache,fn:e=>e.length,target:s.$countFriendsByName}),(0,r.sample)({clock:s.loadFriendsOnInputChange,source:{fetchConfig:s.$fetchConfig,queryData:s.$queryData,friendsDataSize:s.$friendsDataSize,displaySelected:s.$displaySelected},filter:({displaySelected:e,queryData:t,friendsDataSize:a},{query:r})=>{if(!t)return!0;const s=t.get(r),i=s&&s.count<=s.offset,n=a===t.get("")?.count;return!e&&!i&&!n},fn:({fetchConfig:e,queryData:t},{query:a,cachedFriends:r})=>{const s=t&&t.get(a)?.offset;return e.abortController.abort(),{count:r.length-(s??0)+o.MAX_FRIENDS_PER_REQUEST,offset:s??0,inputValue:a,abortController:new AbortController}},target:[s.fetchFriendsFx,s.$fetchConfig]}),s.$countFriendsByName.reset(s.resetStore),s.$displaySelected.reset(s.resetStore),s.$friendsData.reset(s.resetStore),s.$idsToShow.reset(s.resetStore),s.$queryData.reset(s.resetStore),s.$indexer.reset(s.resetStore)},876147:(e,t,a)=>{var r=a(32489),s=a(82987);(0,r.sample)({clock:s.selectFriendEvent,source:s.$friendsData,fn:(e,t)=>{const a=e&&e.get(t.id);return a&&(a.is_selected=!0,e.set(a.id,a)),new Map(e&&e.entries())},target:s.$friendsData}),(0,r.sample)({clock:s.selectFriendEvent,source:s.$selectedFriends,fn:(e,t)=>[{id:t.id,sex:t.sex,photo_200:t.photo_200_orig,last_name:t.last_name,first_name:t.first_name},...e],target:s.$selectedFriends}),(0,r.sample)({clock:s.unselectFriendEvent,source:s.$friendsData,fn:(e,t)=>{const a=e&&e.get(t);return a&&(a.is_selected=!1,e.set(a.id,a)),new Map(e&&e.entries())},target:s.$friendsData}),(0,r.sample)({clock:s.unselectFriendEvent,source:s.$selectedFriends,fn:(e,t)=>e.filter((e=>e.id!==t)),target:s.$selectedFriends}),(0,r.sample)({clock:s.changeMode,target:s.$displaySelected}),s.$selectedFriends.reset(s.resetStore)},230359:(e,t,a)=>{a.d(t,{indexerFriendPrepare:()=>s.indexerFriendPrepare,transliterate:()=>r.transliterate});var r=a(469787),s=a(28561)},28561:(e,t,a)=>{a.d(t,{indexerFriendPrepare:()=>s});const r=/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,s=e=>({id:e.id,full_name:`${e.first_name} ${e.last_name} ${e.screen_name} ${(e.screen_name??"").replace(r," ")}`})},469787:(e,t,a)=>{a.d(t,{transliterate:()=>s});var r=a(423676);const s=e=>{if(e.length<2)return"";const t=new r.VkIndexer,a=e.toLowerCase(),s=a.split("").map((e=>t.toLocalCase[e])).join(""),i=a.split("").map((e=>t.toLocalTranslit[e.charCodeAt(0)])).join("");return s||i}},474213:(e,t,a)=>{a.d(t,{PreviewWidgetModal:()=>C});var r=a(474848),s=a(296540),i=a(293721),n=a(700272),o=a(694244),c=a(782174),p=a(303800),d=a(260546),l=a(612196),_=a(279734),h=a(44544),u=a(220208),m=a(908242),g=a(454154),v=a(468073),A=a(866467),E=a(145475),f=a(413265),S=a(179074),b=a(482221),w=a(636358),R=(a(766991),a(732764));const C=e=>{const{type:t,code:a,appId:C,groupId:k}=e,y=(0,i.useEvent)(S.updateCommunityWidget),O=(0,i.useEvent)(S.getWidgetPreview),I=(0,i.useEvent)(b.getCommunity),N=(0,i.useEvent)(S.setPrivacy),T=(0,i.useEvent)(f.setHandlers),x=(0,i.useStore)(S.$widgetData),D=(0,i.useStore)(b.$community),P=(0,i.useStore)(S.$privacy),L=(0,i.useStore)(S.updateWidgetFx.pending),V=(0,w.getPrivacyLabelByCode)(P),W=(0,i.useStore)(b.getCommunityFx.pending),M=(0,i.useStore)(S.getWidgetPreviewFx.pending);if((0,s.useEffect)((()=>{T(e),W||D||I({group_ids:String(v.Ranges.convertOwnerIdToGroupId(k))}),M||x||O({type:t,code:a,appId:C,groupId:k})}),[W,M,x,D]),(0,s.useLayoutEffect)((()=>{e.updateCoordinates?.()}),[x,D]),!x||!D)return(0,r.jsx)(n.Spinner,{size:"large"});const{widget:H}=x,{WidgetComponent:F,id:K,separated:B}=(0,w.getWidgetComponentByType)(H.type),U=(0,w.getPrivacyOptions)();return(0,r.jsxs)(o.ModalBox,{children:[(0,r.jsx)(c.ModalHeader,{onClose:e.onClose,closeAriaLabel:(0,A.getLang)("global_close"),children:(0,A.getLang)("apps_app_widgets_preview_box_title")}),(0,r.jsxs)(p.Div,{children:[(0,w.hasWidgetData)(H)?(0,r.jsx)(E.WidgetContainer,{widget:H,id:K,separated:B,privacy:V,children:(0,r.jsx)(F,{...H.data})}):(0,r.jsx)(R.NoWidgetContainer,{}),(0,r.jsx)(p.Div,{mode:"vertical",children:(0,r.jsxs)(d.SimpleCell,{before:(0,r.jsx)(l.Avatar,{src:D.photo_50,size:40}),hasHover:!1,children:[(0,A.getLang)("apps_app_widget_preview_note_text"),(0,r.jsx)("br",{}),(0,r.jsx)(_.Link,{href:D.screen_name,target:"_blank",children:D.name})]})}),H.data&&(0,r.jsx)(h.FormItem,{top:(0,A.getLang)("apps_app_widgets_preview_box_privacy_label"),children:(0,r.jsx)(u.Select,{options:U,value:P,onChange:e=>N((0,w.toPrivacyCode)(Number(e.target.value)))})})]}),(0,r.jsx)(m.ModalFooter,{actions:[(0,r.jsx)(g.Button,{size:"m",onClick:()=>y({type:t,code:a,appId:C,groupId:k}),loading:L,children:x.is_installed?(0,A.getLang)("apps_app_widgets_preview_box_update"):(0,A.getLang)("apps_app_widgets_preview_box_install")},"ok")]})]})}},681481:(e,t,a)=>{a.d(t,{WidgetImage:()=>o});var r=a(474848),s=a(296540),i=a(351118),n=a(898848);const o=({images:e,className:t})=>{const[a,o]=e,c=a.width&&a.width/2,p=a.height&&a.height/2,d=(0,s.useMemo)((()=>(0,n.isRetina)()?o:a),[e]);return(0,r.jsx)("div",{style:{backgroundImage:`url(${d.url})`,width:c,height:p},className:(0,i.classNames)("app_widget_image",t,{app_widget_avatar:!!d.is_avatar})})}},384235:(e,t,a)=>{a.d(t,{WidgetCompactList:()=>d});var r=a(474848),s=a(351118),i=a(454154),n=a(681481),o=a(22847),c=a(55797),p=a(353322);const d=({rows:e})=>(0,r.jsx)(r.Fragment,{children:e?.map(((e,t)=>(0,r.jsxs)("div",{className:(0,s.classNames)("clear_fix","app_widget_list_row",{app_widget_imaged_5:!!e.icon}),children:[e.icon&&(0,r.jsx)("div",{className:"app_widget_list_icon",children:(0,r.jsx)(n.WidgetImage,{images:e.icon})}),e.button&&(0,r.jsx)("div",{className:"app_widget_list_side_button",children:(0,r.jsx)(i.Button,{size:"m",mode:"primary",href:e.button_action?.url,children:(0,r.jsx)("div",{className:"app_widget_button",children:e.button})})}),(0,r.jsx)("div",{className:"app_widget_list_content",children:(0,r.jsx)("div",{className:"app_widget_list_content_outer",children:(0,r.jsxs)("div",{className:"app_widget_list_content_inner",children:[(0,r.jsx)(o.WithAction,{action:e.title_action,className:(0,s.classNames)("app_widget_list_title",{app_widget_linked:!!e.title_action}),children:e.title}),e.descr&&(0,r.jsx)("span",{className:"app_widget_list_info",children:e.descr}),e.address&&(0,r.jsxs)("span",{className:"app_widget_list_info app_widget_list_info--withIcon",children:[(0,r.jsx)("span",{className:"app_widget_list_info__icon",children:(0,r.jsx)(c.Icon16PlaceOutline,{})}),(0,r.jsx)("div",{className:"app_widget_list_info__in",children:e.address})]}),e.time&&(0,r.jsxs)("span",{className:"app_widget_list_info app_widget_list_info--withIcon",children:[(0,r.jsx)("span",{className:"app_widget_list_info__icon",children:(0,r.jsx)(p.Icon16ClockOutline,{})}),(0,r.jsx)("div",{className:"app_widget_list_info__in",children:e.time})]}),e.text&&(0,r.jsx)("div",{className:"app_widget_list_text",children:e.text})]})})})]},`list-item-${t}`)))})},732764:(e,t,a)=>{a.d(t,{NoWidgetContainer:()=>i});var r=a(474848),s=a(866467);const i=()=>(0,r.jsx)("div",{className:"apps_app_widget_preview_box_content page_block wide_column",children:(0,r.jsx)("div",{className:"no_rows",children:(0,s.getLang)("apps_app_widget_preview_empty")})})},145475:(e,t,a)=>{a.d(t,{WidgetContainer:()=>n});var r=a(474848),s=a(159547),i=a(22847);const n=({children:e,widget:t,privacy:a,id:n,separated:o})=>{const{data:c}=t,{title_action:p,title:d}=c,l="title_counter"in c?c.title_counter:void 0;return(0,r.jsx)("div",{className:"apps_app_widget_preview_box_content page_block wide_column",children:(0,r.jsx)("aside",{"aria-label":t.data.title,children:(0,r.jsxs)("div",{id:n,children:[(0,r.jsx)(s.WidgetHeader,{action:p,title:d,privacy:a,counter:l,separated:o}),(0,r.jsx)("div",{className:"module_body clear_fix",children:e}),t.data.more&&(0,r.jsx)(i.WithAction,{action:t.data.more_action,className:"flat_button secondary ui_load_more_btn _ui_load_more_btn with_arrow",children:(0,r.jsx)("span",{className:"ui_load_more_btn_label",children:t.data.more})})]})})})}},159547:(e,t,a)=>{a.d(t,{WidgetHeader:()=>n});var r=a(474848),s=a(351118),i=a(22847);const n=({action:e,title:t,privacy:a,counter:n,separated:o=!1})=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"header_right_link fl_r",children:a}),(0,r.jsx)(i.WithAction,{action:e,className:(0,s.classNames)("module_header",{header_separated:o}),noActionContainer:!0,children:(0,r.jsxs)("div",{className:"header_top clear_fix",children:[(0,r.jsx)("span",{className:"header_label fl_l",children:t}),(0,r.jsx)("span",{className:"header_count fl_l",children:n})]})})]})},773539:(e,t,a)=>{a.d(t,{WidgetCoverList:()=>o});var r=a(474848),s=a(681481),i=a(22847),n=a(454154);const o=({rows:e})=>{const t=e=>{e.preventDefault(),e.stopPropagation()};return(0,r.jsx)(r.Fragment,{children:e?.map(((e,a)=>(0,r.jsx)("div",{className:"app_widget_list_cover_row app_widget_list_cover_inline",children:(0,r.jsxs)(i.WithAction,{action:e.action,children:[e.cover&&(0,r.jsx)(s.WidgetImage,{images:e.cover}),(0,r.jsx)("span",{className:"app_widget_list_cover_gradient"}),(0,r.jsxs)("span",{className:"app_widget_list_cover_controls",children:[(0,r.jsx)("object",{className:"app_widget_list_cover_button",onClick:t,children:e.button&&(0,r.jsx)(n.Button,{size:"m",appearance:"positive",href:e.button_action?.url,children:(0,r.jsx)("div",{className:"app_widget_button",children:e.button})})}),(0,r.jsxs)("span",{className:"app_widget_list_cover_content",children:[e.title&&(0,r.jsx)("span",{className:"app_widget_list_title",children:e.title}),e.descr&&(0,r.jsx)("span",{className:"app_widget_list_info",children:e.descr})]})]})]})},`widget-cover-list-item-${a}`)))})}},998289:(e,t,a)=>{a.d(t,{WidgetDonation:()=>p});var r=a(474848),s=a(22847),i=a(866467),n=a(454154),o=a(373080),c=a(351118);const p=e=>{const{funded:t=0,goal:a,button_action:p,text:d,button:l}=e,_=(0,c.isNumber)(a)?Math.round(t/a*100):0;return(0,r.jsxs)("div",{className:"app_widget_donation clear_fix",children:[(0,r.jsx)("div",{className:"app_widget_donation_content",children:(0,r.jsx)("div",{className:"app_widget_donation_text",children:(0,r.jsx)(s.WithAction,{action:e.text_action,children:d})})}),(0,r.jsx)("div",{className:"app_widget_donation_bar",children:(0,r.jsx)("div",{style:{width:`${_}%`}})}),(0,r.jsx)("div",{className:"app_widget_donation_button",children:p&&(0,r.jsx)(n.Button,{href:p.url,size:"m",children:(0,r.jsx)("div",{className:"app_widget_button",children:l})})}),(0,r.jsxs)("div",{className:"app_widget_donation_data",children:[(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("b",{children:(0,r.jsx)(o.InnerHTML,{children:(0,i.langNumeric)(t,[],!0)})}),(0,c.isNumber)(a)?(0,r.jsxs)(r.Fragment,{children:[" / ",(0,r.jsx)("span",{children:(0,r.jsx)(o.InnerHTML,{children:(0,i.langNumeric)(a,[],!0)})})]}):null]})," ₽",(0,r.jsx)("span",{className:"app_widget_donation_desc",children:(0,i.getLang)("groups_app_widget_donation_funded")})]}),(0,r.jsx)("div",{className:"app_widget_donation_data",children:(0,c.isNumber)(e.backers)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:(0,r.jsx)(o.InnerHTML,{children:(0,i.getLang)("groups_app_widget_backers",e.backers,!0)})}),(0,r.jsx)("span",{className:"app_widget_donation_desc",children:(0,i.getLang)("groups_app_widget_donation_donated")})]})})]})}},615481:(e,t,a)=>{a.d(t,{WidgetList:()=>d});var r=a(474848),s=a(351118),i=a(454154),n=a(681481),o=a(22847),c=a(55797),p=a(353322);const d=({rows:e})=>(0,r.jsx)(r.Fragment,{children:e?.map(((e,t)=>(0,r.jsxs)("div",{className:(0,s.classNames)("clear_fix","app_widget_list_row",{app_widget_imaged_5:!!e.icon}),children:[e.icon&&(0,r.jsx)("div",{className:"app_widget_list_icon",children:(0,r.jsx)(n.WidgetImage,{images:e.icon})}),(0,r.jsx)("div",{className:"app_widget_list_content",children:(0,r.jsx)("div",{className:"app_widget_list_content_outer",children:(0,r.jsxs)("div",{className:"app_widget_list_content_inner",children:[(0,r.jsx)(o.WithAction,{action:e.title_action,className:(0,s.classNames)("app_widget_list_title",{app_widget_linked:!!e.title_action}),children:e.title}),e.descr&&(0,r.jsx)("span",{className:"app_widget_list_info",children:e.descr}),e.address&&(0,r.jsxs)("span",{className:"app_widget_list_info app_widget_list_info--withIcon",children:[(0,r.jsx)("span",{className:"app_widget_list_info__icon",children:(0,r.jsx)(c.Icon16PlaceOutline,{})}),(0,r.jsx)("div",{className:"app_widget_list_info__in",children:e.address})]}),e.time&&(0,r.jsxs)("span",{className:"app_widget_list_info app_widget_list_info--withIcon",children:[(0,r.jsx)("span",{className:"app_widget_list_info__icon",children:(0,r.jsx)(p.Icon16ClockOutline,{})}),(0,r.jsx)("div",{className:"app_widget_list_info__in",children:e.time})]}),e.text&&(0,r.jsx)("div",{className:"app_widget_list_text",children:e.text}),e.button&&(0,r.jsx)("div",{className:"app_widget_list_button",children:(0,r.jsx)(i.Button,{size:"m",mode:"primary",href:e.button_action?.url,children:(0,r.jsx)("div",{className:"app_widget_button",children:e.button})})})]})})})]},`list-item-${t}`)))})},146679:(e,t,a)=>{a.d(t,{MatchEvent:()=>s});var r=a(474848);const s=({event:e})=>(0,r.jsxs)("div",{className:"app_widget_match_event",children:[(0,r.jsxs)("span",{className:"app_widget_match_event_minute",children:[e?.minute,"'"]}),e?.event]})},354612:(e,t,a)=>{a.d(t,{MatchTeam:()=>i});var r=a(474848),s=a(681481);const i=({team:e,teamGroup:t="a"})=>(0,r.jsx)("div",{className:`app_widget_match_team_${t}`,children:e&&(0,r.jsxs)(r.Fragment,{children:[e.icon&&(0,r.jsx)(s.WidgetImage,{images:e.icon,className:`app_widget_match_team_${t}_icon`}),(0,r.jsx)("div",{className:"app_widget_match_team_name",children:e.name}),e.descr&&(0,r.jsx)("div",{className:"app_widget_match_descr",children:e.descr})]})})},496895:(e,t,a)=>{a.d(t,{WidgetMatch:()=>c});var r=a(474848),s=a(351118),i=a(354612),n=a(146679),o=a(636358);const c=({match:e={}})=>{const{team_a:t,team_b:a,score:c={},events:p={}}=e,{team_a:d,team_b:l}=c,{team_a:_=[],team_b:h=[]}=p,u=(0,o.isMatchHasImages)(e),m=(0,o.isMatchHasDescription)(e),g=(0,o.isMatchHasState)(e),v=(0,s.isNumber)(d)&&(0,s.isNumber)(l);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:(0,s.classNames)("clear_fix","app_widget_match",{app_widget_imaged:u,app_widget_descripted:m,app_widget_stated:g}),children:[(0,r.jsx)(i.MatchTeam,{team:t,teamGroup:"a"}),(0,r.jsx)(i.MatchTeam,{team:a,teamGroup:"b"}),(0,r.jsxs)("div",{className:"app_widget_match_info",children:[v&&(0,r.jsxs)("div",{className:"app_widget_match_score",children:[d,(0,r.jsx)("span",{children:":"}),l]}),(0,r.jsx)("div",{className:"app_widget_match_state",children:e?.state})]})]}),(0,r.jsx)("div",{className:"app_widget_match_team_a_events",children:_.map(((e,t)=>(0,r.jsx)(n.MatchEvent,{event:e},`team-a-event-${t}`)))}),(0,r.jsx)("div",{className:"app_widget_match_team_b_events",children:h.map(((e,t)=>(0,r.jsx)(n.MatchEvent,{event:e},`team-b-event-${t}`)))})]})}},208604:(e,t,a)=>{a.d(t,{MatchTeam:()=>n});var r=a(474848),s=a(681481),i=a(22847);const n=({matchIcon:e,team:t,matchState:a,matchAction:n,teamGroup:o="a"})=>(0,r.jsxs)("span",{className:`app_widget_matches_team_${o}`,children:[e&&(0,r.jsx)(s.WidgetImage,{images:e,className:"app_widget_matches_match_icon"}),t.icon&&(0,r.jsx)(s.WidgetImage,{images:t.icon,className:"app_widget_matches_team_icon"}),a&&(0,r.jsx)("span",{className:"app_widget_matches_state",children:a}),n&&(0,r.jsx)(i.WithAction,{action:n,className:"app_widget_matches_live_icon"}),(0,r.jsx)("span",{className:"app_widget_matches_team_name",title:t.descr,children:t.name})]})},695051:(e,t,a)=>{a.d(t,{WidgetMatches:()=>i});var r=a(474848),s=a(208604);const i=({matches:e=[]})=>(0,r.jsx)("div",{className:"app_widget_matches",children:e.map(((e,t)=>(0,r.jsxs)("span",{className:"app_widget_matches_match clear_fix",children:[e.team_a&&(0,r.jsx)(s.MatchTeam,{matchIcon:e.icon,team:e.team_a,teamGroup:"a"}),e.team_b&&(0,r.jsx)(s.MatchTeam,{team:e.team_b,teamGroup:"b",matchState:e.state,matchAction:e?.live_action}),(0,r.jsxs)("span",{className:"app_widget_matches_score",children:[(0,r.jsx)("span",{children:e.score?.team_a}),(0,r.jsx)("b",{children:":"}),(0,r.jsx)("span",{children:e.score?.team_b})]})]},`widget-match-item-${t}`)))})},794235:(e,t,a)=>{a.d(t,{WidgetTable:()=>c});var r=a(474848),s=a(351118),i=a(76249),n=a(528591),o=a(636358);const c=e=>{const{head:t,body:a}=e,c=(0,o.isTableHasImages)(a);return(0,r.jsxs)("table",{className:(0,s.classNames)("app_widget_table",{app_widget_imaged:c}),children:[t&&(0,r.jsx)(i.WidgetTableHead,{head:t}),a&&(0,r.jsx)(n.WidgetTableBody,{body:a})]})}},528591:(e,t,a)=>{a.d(t,{WidgetTableBody:()=>c});var r=a(474848),s=a(351118),i=a(681481),n=a(22847);const o=e=>({icon:t,text:a,action:o},c)=>(0,r.jsx)("td",{className:(0,s.classNames)("app_widget_table_td",e,{app_widget_linked:!!o}),children:(0,r.jsxs)(n.WithAction,{action:o,children:[t&&(0,r.jsx)(i.WidgetImage,{images:t}),a]})},`table-body-col-${c}`),c=({body:e,className:t})=>(0,r.jsx)("tbody",{children:e.map(((e,a)=>(0,r.jsx)("tr",{children:e.map(o(t))},`table-body-row-${a}`)))})},76249:(e,t,a)=>{a.d(t,{WidgetTableHead:()=>n});var r=a(474848),s=a(351118),i=a(22847);const n=({head:e,trClassName:t})=>(0,r.jsx)("thead",{children:(0,r.jsx)("tr",{children:e.map(((a,n)=>{const{align:o,action:c,text:p}=a,d=o&&"left"!==o?`ta_${o.at(0)}`:"";return(0,r.jsx)("th",{className:(0,s.classNames)("app_widget_table_th",t,d,{app_widget_widened:e.length>3&&0===n}),children:(0,r.jsx)(i.WithAction,{action:c,children:p})},`table-head-${n}`)}))})})},884711:(e,t,a)=>{a.d(t,{WidgetText:()=>s});var r=a(474848);const s=e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"app_widget_text_content",children:e.text}),(0,r.jsx)("div",{className:"app_widget_text_descr",children:e.descr})]})},485298:(e,t,a)=>{a.d(t,{Tile:()=>n});var r=a(474848),s=a(22847),i=a(681481);const n=({title:e,link:t,descr:a,icon:n,action:o,link_action:c})=>(0,r.jsxs)("div",{className:"app_widget_tiles_tile",children:[(0,r.jsxs)(s.WithAction,{action:o,className:"app_widget_tiles_link",children:[n&&(0,r.jsx)(i.WidgetImage,{images:n}),(0,r.jsx)("span",{className:"app_widget_tiles_title",children:e}),(0,r.jsx)("span",{className:"app_widget_tiles_descr",children:a})]}),(0,r.jsx)("div",{children:(0,r.jsx)(s.WithAction,{action:c,className:"app_widget_tiles_action",children:t})})]})},264687:(e,t,a)=>{a.d(t,{WidgetTiles:()=>o});var r=a(474848),s=a(296540),i=a(351118),n=a(485298);const o=e=>{const t=e.tiles||[];return(0,r.jsx)("div",{className:(0,i.classNames)("app_widget_tiles_content",{"app_widget_tiles_content--withScroll":t.length>3}),children:t.map(((e,t)=>(0,s.createElement)(n.Tile,{...e,key:`tile-${t}`})))})}},22847:(e,t,a)=>{a.d(t,{WithAction:()=>s});var r=a(474848);const s=({children:e,action:t,className:a,noActionContainer:s})=>t?(0,r.jsx)("a",{href:t.url,onClick:e=>{e.preventDefault(),e.stopPropagation()},className:a,children:e}):s?(0,r.jsx)("div",{className:a,children:e}):(0,r.jsx)(r.Fragment,{children:e})},186138:(e,t,a)=>{a.d(t,{AppWidgetPrivacyCodeMap:()=>_,WidgetComponentMap:()=>b,WidgetContainerParamsMap:()=>w});var r=a(884711),s=a(264687),i=a(794235),n=a(615481),o=a(384235),c=a(773539),p=a(496895),d=a(695051),l=a(998289);const _={Admins:0,Subscribers:1,Everyone:2,NoOne:3},h=1,u=2,m=3,g=4,v=5,A=6,E=7,f=8,S=9,b={[h]:r.WidgetText,[u]:n.WidgetList,[m]:i.WidgetTable,[g]:s.WidgetTiles,[v]:o.WidgetCompactList,[A]:c.WidgetCoverList,[E]:p.WidgetMatch,[f]:d.WidgetMatches,[S]:l.WidgetDonation},w={[h]:["text_app_widget",!1],[u]:["list_app_widget",!1],[m]:["table_app_widget",!0],[g]:["tiles_app_widget",!1],[v]:["compact_list_app_widget",!1],[A]:["cover_list_app_widget",!1],[E]:["match_app_widget",!0],[f]:["matches_app_widget",!0],[S]:["donation_app_widget",!1]}},933023:(e,t,a)=>{a.d(t,{VKWebAppShowCommunityWidgetPreviewBox:()=>p});var r=a(52905),s=a(290788),i=a(534100),n=a(474213),o=a(413265),c=a(816980);class p extends s.Handler{resetBox(){delete window.cur.onAppWidgetPreviewFail,delete window.cur.onAppWidgetPreviewCancel,delete window.cur.onAppWidgetPreviewSuccess,setTimeout((function(){delete window.cur.appWidgetPreviewBox}),3e3)}async actionHandler(e){if(!this.checkParams(e,[{param:"group_id",type:"number",isRequired:!0},{param:"type",type:"string",isRequired:!0}]))return{};await this.showWidgetPreviewBox(e)}async showWidgetPreviewBox(e){try{(0,c.isSpaLaunch)()&&await(window.stManager.add?.(["module.css","apps_community_widgets.css"]));const t=await(0,i.showModalBox)(n.PreviewWidgetModal,{...e,groupId:e.group_id,appId:this.app.appId,onClose:()=>(0,o.resetStore)(),onDone:()=>(0,o.resetStore)()},{width:"600px",fixed:!0});t?this.successHandler({result:t}):this.errorHandler({code:r.ERROR_CODES.USER_DENIED,reason:r.ERROR_REASONS.USER_DENIED})}catch(e){this.errorApiHandler(e)}finally{(0,o.resetStore)()}}errorApiHandler(e){this.errorHandler({code:r.ERROR_CODES.CUSTOM,reason:e?.error?.error_msg||r.ERROR_REASONS.UNKNOWN_ERROR})}constructor(e){super(e),this.params.handlerName="VKWebAppShowCommunityWidgetPreviewBox",this.isWebOnly=!0}}},413265:(e,t,a)=>{a.d(t,{$community:()=>i.$community,$lifecycleHandlers:()=>r.$lifecycleHandlers,$privacy:()=>s.$privacy,$widgetData:()=>s.$widgetData,getCommunity:()=>i.getCommunity,getCommunityFx:()=>i.getCommunityFx,getWidgetPreview:()=>s.getWidgetPreview,getWidgetPreviewFx:()=>s.getWidgetPreviewFx,onDoneFx:()=>r.onDoneFx,onErrorFx:()=>r.onErrorFx,resetStore:()=>r.resetStore,setHandlers:()=>r.setHandlers,setPrivacy:()=>s.setPrivacy,updateCommunityWidget:()=>s.updateCommunityWidget,updateWidgetFx:()=>s.updateWidgetFx});var r=a(704387),s=a(179074),i=a(482221)},766991:(e,t,a)=>{var r=a(32489),s=a(413265),i=a(636358);(0,r.sample)({clock:s.getWidgetPreview,target:s.getWidgetPreviewFx}),(0,r.sample)({clock:s.getWidgetPreviewFx.doneData,target:s.$widgetData}),(0,r.sample)({clock:s.getCommunity,target:s.getCommunityFx}),(0,r.sample)({clock:s.setPrivacy,target:s.$privacy}),(0,r.sample)({clock:s.setHandlers,target:s.$lifecycleHandlers}),(0,r.sample)({clock:s.getWidgetPreviewFx.doneData,fn:({privacy_code:e})=>(0,i.toPrivacyCode)(Number(e)),target:s.$privacy}),(0,r.sample)({clock:s.getCommunityFx.doneData,fn:({groups:[e]=[]})=>e||null,target:s.$community}),(0,r.sample)({clock:s.updateCommunityWidget,source:s.$privacy,fn:(e,t)=>({...t,privacy:e}),target:s.updateWidgetFx}),(0,r.sample)({clock:[s.getWidgetPreviewFx.failData,s.updateWidgetFx.failData],source:s.$lifecycleHandlers,fn:(e,t)=>({handlers:e,error:t}),target:s.onErrorFx}),(0,r.sample)({clock:s.updateWidgetFx.doneData,source:s.$lifecycleHandlers,target:s.onDoneFx}),s.$widgetData.reset(s.resetStore),s.$community.reset(s.resetStore),s.$privacy.reset(s.resetStore),s.$lifecycleHandlers.reset(s.resetStore)},704387:(e,t,a)=>{a.d(t,{$lifecycleHandlers:()=>s,domain:()=>r,onDoneFx:()=>c,onErrorFx:()=>o,resetStore:()=>n,setHandlers:()=>i});const r=(0,a(32489).createDomain)("APP_WIDGETS_PREVIEW"),s=r.createStore(null),i=r.createEvent("set/handlers"),n=r.createEvent("reset/store"),o=r.createEffect({handler:e=>{e.handlers.onError&&e.handlers.onError(e.error)}}),c=r.createEffect({handler:e=>e?.onDone(!0)})},482221:(e,t,a)=>{a.d(t,{$community:()=>i,getCommunity:()=>n,getCommunityFx:()=>o});var r=a(957994),s=a(704387);const i=s.domain.createStore(null),n=s.domain.createEvent("get/community"),o=s.domain.createEffect({handler:e=>(0,r.api)("groups.getById",{...e,fields:"name"})})},179074:(e,t,a)=>{a.d(t,{$privacy:()=>d,$widgetData:()=>p,getWidgetPreview:()=>n,getWidgetPreviewFx:()=>l,setPrivacy:()=>c,updateCommunityWidget:()=>o,updateWidgetFx:()=>_});var r=a(957994),s=a(704387),i=a(186138);const n=s.domain.createEvent("get/widgetPreview"),o=s.domain.createEvent("update/communityWidget"),c=s.domain.createEvent("set/privacy"),p=s.domain.createStore(null),d=s.domain.createStore(i.AppWidgetPrivacyCodeMap.Admins),l=s.domain.createEffect({handler:({type:e,code:t,appId:a,groupId:s})=>(0,r.api)("appWidgets.getWidgetPreview",{type:e,code:t,app_id:a,group_id:s})}),_=s.domain.createEffect({handler:({type:e,code:t,appId:a,groupId:s,privacy:i})=>(0,r.api)("appWidgets.update",{type:e,code:t,app_id:a,group_id:s,privacy:i})})},636358:(e,t,a)=>{a.d(t,{getPrivacyLabelByCode:()=>n,getPrivacyOptions:()=>p,getWidgetComponentByType:()=>i,hasWidgetData:()=>o,isMatchHasDescription:()=>_,isMatchHasImages:()=>l,isMatchHasState:()=>h,isTableHasImages:()=>d,toPrivacyCode:()=>c});var r=a(866467),s=a(186138);const i=e=>{const[t,a]=s.WidgetContainerParamsMap[e];return{WidgetComponent:s.WidgetComponentMap[e],id:t,separated:a}},n=e=>{switch(e){case s.AppWidgetPrivacyCodeMap.Subscribers:return(0,r.getLang)("apps_app_widgets_preview_box_privacy_option_subscribers");case s.AppWidgetPrivacyCodeMap.Everyone:return(0,r.getLang)("apps_app_widgets_preview_box_privacy_option_everyone");case s.AppWidgetPrivacyCodeMap.NoOne:return(0,r.getLang)("apps_app_widgets_preview_box_privacy_option_no_one");case s.AppWidgetPrivacyCodeMap.Admins:default:return(0,r.getLang)("apps_app_widgets_preview_box_privacy_option_admins")}},o=e=>"object"==typeof e&&"data"in e,c=e=>{return t=e,Object.values(s.AppWidgetPrivacyCodeMap).includes(t)?e:s.AppWidgetPrivacyCodeMap.Admins;var t},p=()=>Object.values(s.AppWidgetPrivacyCodeMap).map((e=>({value:e,label:n(e)}))),d=e=>{if(!e)return!1;const[[t]]=e;return!!t.icon},l=({team_a:e,team_b:t})=>!(!e?.icon&&!t?.icon),_=({team_a:e,team_b:t})=>!(!e?.descr&&!t?.descr),h=e=>!!e.state},896566:(e,t,a)=>{a.d(t,{VKWebAppShowLinkCardBox:()=>c});var r=a(290788),s=a(52905),i=a(19589),n=a(105330),o=a(957994);class c extends r.Handler{getBackURL(){return`${location.origin}/app${this.app.appId}#${this.back_url}?current_profile_id={user_id}`}setData(e,t){super.setData(e,t),this.back_url=e.back_url}handler(e,t,a){this.setData(e,t),this.callback=a;const r=this.showBridgeModal(this.app,{type:"IframeModal",data:{shouldForceHide:!1},actions:{onCancel:this.onCancel.bind(this),onSuccess:this.onSuccess.bind(this),onError:this.onError.bind(this)}});this.requestGetNewCardBindingUrl().then((e=>{this.user_id=e.user_id,r({data:{url:e.url}})})).catch((()=>{r({data:{shouldForceHide:!0}})}))}requestGetNewCardBindingUrl(){return(0,o.api)("money.getVKPayNewCardBindingUrl",{is_dark:i.colorScheme.isDarkScheme(),back_url:(0,n.isMvk)()?this.getBackURL():""})}requestGetUserBindings(){return(0,o.api)("money.getVKPayUserBindings",{sync:!0})}onSuccess(){this.requestGetUserBindings().then((e=>{this.successHandler({success:!0,current_profile_id:this.user_id,card_bind:e.items})})).catch((e=>this.errorHandler(e)))}onError(){this.errorHandler({reason:"Error",code:s.ERROR_CODES.CUSTOM})}onCancel(){this.errorHandler({reason:s.ERROR_REASONS.USER_DENIED,code:s.ERROR_CODES.USER_DENIED})}constructor(e){super(e),this.back_url="",this.params.handlerName="VKWebAppShowLinkCardBox",this.useUI=!1,this.callApi=!1}}},918274:(e,t,a)=>{a.d(t,{VKWebAppShowNftOtpBox:()=>o});var r=a(957994),s=a(52905),i=a(105330),n=a(290788);class o extends n.Handler{setData(e,t){super.setData(e,t),this.requestId=e.request_id,this.accessToken=e.access_token,this.rawData=e}handler(e,t,a){this.setData(e,t),this.callback=a,this.with_back_url=(0,i.isMvk)();const r=this.showBridgeModal(this.app,{type:"IframeModal",data:{shouldForceHide:!1},actions:{onCancel:this.onCancel.bind(this),onSuccess:this.otpSuccess.bind(this),onError:this.onError.bind(this)},predicates:{successPredicate:e=>"otp_success"===e.status,cancelPredicate:e=>"no_attempts"===e.status,errorPredicate:e=>"operation_failed"===e.status}});this.requestGetNftOtpUrl().then((e=>{r({data:{url:e.otp_url}})})).catch((()=>{r({data:{shouldForceHide:!0}})}))}requestGetNftOtpUrl(){return(0,r.api)("money.getNftOtpUrl",{request_id:this.requestId,with_back_url:this.with_back_url?1:0},{accessToken:this.accessToken,grouping:!1})}otpSuccess(){this.successHandler({success:!0,request_id:this.requestId})}onError(){this.errorHandler({reason:"Error",code:s.ERROR_CODES.CUSTOM})}onCancel(){this.errorHandler({reason:"Cancel",code:s.ERROR_CODES.CUSTOM})}constructor(e){super(e),this.params.handlerName="VKWebAppShowNftOtpBox",this.useUI=!1,this.callApi=!1,this.with_back_url=null,this.requestId=null,this.otp_url=""}}},321670:(e,t,a)=>{a.d(t,{VKWebAppShowNftPaymentBox:()=>c});var r=a(290788),s=a(52905),i=a(19589),n=a(105330),o=a(957994);class c extends r.Handler{getBackURL(){return`${location.origin}/app${this.app.appId}#async-result?current_profile_id={user_id}&request_id=${this.request_id}`}setData(e,t){super.setData(e,t),this.request_id=e.request_id}handler(e,t,a){this.setData(e,t),this.callback=a;const r=this.showBridgeModal(this.app,{type:"IframeModal",data:{shouldForceHide:!1},actions:{onCancel:this.onCancel.bind(this),onSuccess:this.onSuccess.bind(this),onError:this.onError.bind(this)},width:520});this.requestGetVKPayP2PUrl().then((e=>{r({data:{url:e.url}})})).catch((()=>{r({data:{shouldForceHide:!0}})}))}requestGetVKPayP2PUrl(){return(0,o.api)("money.getVKPayNFTUrlP2P",{is_dark:i.colorScheme.isDarkScheme(),back_url:(0,n.isMvk)()?this.getBackURL():"",request_id:this.request_id})}onSuccess(){this.successHandler({request_id:this.request_id})}onError(){this.errorHandler({reason:"Error",code:s.ERROR_CODES.CUSTOM})}onCancel(){this.errorHandler({reason:s.ERROR_REASONS.USER_DENIED,code:s.ERROR_CODES.USER_DENIED})}constructor(e){super(e),this.params.handlerName="VKWebAppShowNftPaymentBox",this.useUI=!1,this.callApi=!1}}},227891:(e,t,a)=>{a.d(t,{VALIDATE_PHONE_CHECK_NEED_VALIDATE_STATUSES:()=>i,VALIDATION_PHONE_ACTION_NAME:()=>r,VALIDATION_PHONE_MODAL_NAME:()=>s,redirectUri:()=>n});const r="auth_validation_phone",s="ValidatePhoneIframeModal",i=[3,5],n=location.protocol+"//"+location.host},766986:(e,t,a)=>{a.d(t,{VKWebAppValidatePhone:()=>h});var r=a(290788),s=a(105330),i=a(19589),n=a(734299),o=a(456579),c=a(52905),p=a(227891),d=a(550325),l=a(521494),_=a(122785);class h extends r.Handler{async actionHandler(){const e=await(0,o.validatePhoneCheck)({},this.app.appId);p.VALIDATE_PHONE_CHECK_NEED_VALIDATE_STATUSES.includes(e.status)&&e.sid?this.showPhoneCheckModal(e):this.successHandler({type:this.successDescriptor,data:{phone_validated:!0}})}async onMessage(e,t){const{params:a,handler:r}=e.data;r===n.VKWebValidatePhoneEvents.VK_WEB_CLOSE_MODAL?a.type===n.ValidatePhoneEventTypes.SUCCESS_PHONE_VALIDATION&&(this.sendSuccessEvent(!0),t.onClose()):r===n.VKWebValidatePhoneEvents.VK_WEB_REDIRECT?a?.url&&(this.sendSuccessEvent(!1),window.location.href=e.data.params?.url):r===n.VKWebValidatePhoneEvents.VALIDATION_PHONE_ERROR&&a.type===n.ValidatePhoneEventTypes.VALIDATION_PHONE_ERROR&&(this.errorHandler({error_type:c.ERROR_TYPES.CLIENT,code:c.ERROR_CODES.UNKNOWN,reason:c.ERROR_REASONS.UNKNOWN_ERROR}),t.onClose())}sendSuccessEvent(e){this.successHandler({type:this.successDescriptor,data:{phone_validated:e}})}async showPhoneCheckModal(e){this.showBridgeModal(this.app,{type:p.VALIDATION_PHONE_MODAL_NAME,data:{iframeUrl:this.getIframeUrl(e),closable:!1},actions:{onMessage:this.onMessage.bind(this),sendSuccessEvent:this.sendSuccessEvent.bind(this)}})}getActionString(e){return btoa(JSON.stringify(e))}getIframeUrl(e){const t={name:p.VALIDATION_PHONE_ACTION_NAME,params:{...e,status:"1",isMvk:(0,s.isMvk)()}},a=encodeURIComponent(p.redirectUri),r=i.colorScheme.isDarkScheme()?i.ColorSchemeName.Dark:i.ColorSchemeName.Light;return`https://${(0,d.getDomain)(l.Domains.VKID)}/auth?action=${this.getActionString(t)}&v=1.60.6&scheme=${r}&app_id=${_.VK_WEB_AUTH_APP_ID}&redirect_uri=${a}`}constructor(){super(),this.params.handlerName="VKWebAppValidatePhone"}}},734299:(e,t,a)=>{a.d(t,{VKWebValidatePhoneEvents:()=>r,ValidatePhoneEventTypes:()=>s});var r=function(e){return e.VK_WEB_RESIZE_WINDOW="VKWebResizeWindow",e.VK_WEB_CLOSE_MODAL="VKWebCloseModal",e.VK_WEB_REDIRECT="VKWebRedirect",e.VK_WEB_APP_LOADED="VKWebAppLoaded",e.VK_WEB_ERROR="VKWebError",e.VALIDATION_PHONE_ERROR="validation_phone_error",e}({}),s=function(e){return e.SUCCESS_PHONE_VALIDATION="success_phone_validation",e.VALIDATION_PHONE_ERROR="validation_phone_error",e}({})},111757:(e,t,a)=>{a.d(t,{AppToChatSender:()=>c,Refs:()=>o});var r=a(957994),s=a(105330),i=a(810068),n=a(21830),o=function(e){return e.REF_ATTACH_PICKER="im_attach_picker",e.REF_CATALOG="catalog_messenger_apps_with_action",e}({});class c{isAttachPickerFlow(){return"im_attach_picker"===this.ref}getRef(){return this.ref}async sendToChat({chatIds:e=[]}){const[{result:t,link:a}]=await Promise.all(e.map((e=>new Promise(((t,a)=>{if(!this.appId||Number.isNaN(this.appId))return a("Not found app id!");if(!e||Number.isNaN(e))return a("Not found peer id!");if(i.Ranges.isGroupId(e))return a("App action widget available only in users conversations!");const s={type:"app_action",app_id:this.appId,title:this.title,hash:this.hash};(0,r.api)("messages.send",{peer_id:e,random_id:(0,n.random)(),template:JSON.stringify(s)}).then((()=>t({result:!0,link:this.getLink(e)}))).catch(a)})))));return e.length>1?{result:t}:{result:t,link:a}}getLink(e){if(i.Ranges.isChatOrChannelPeer(e)){const t=i.Ranges.convertChatPeerIdToChatId(e);return(0,s.isMvk)()?`/mail?act=show&chat=${t}`:`/im?sel=c${t}`}return i.Ranges.isUserId(e)?(0,s.isMvk)()?`/mail?act=show&peer=${e}`:`/im?sel=${e}`:""}constructor({appId:e,title:t,hash:a,ref:r=""}){this.appId=e,this.title=t,this.hash=a,this.ref=r}}},877405:(e,t,a)=>{a.d(t,{getSchemeConfig:()=>o});var r=a(19589),s=a(187561),i=a(521494),n=a(670053);const o=()=>{const e={app_id:(window.cur.aid||0).toString(),viewport_width:window.innerWidth,viewport_height:window.innerHeight,scheme:r.colorScheme.getScheme(),appearance:r.colorScheme.isDarkScheme()?r.ColorSchemeMode.Dark:r.ColorSchemeMode.Light,api_host:(0,s.getDomain)(i.Domains.API)},t=(0,n.getCurrentApp)()?.options.layer;return t&&(e.is_layer=!0),e}},576592:(e,t,a)=>{a.d(t,{getProfileButtonHash:()=>o,isProfileButtonAvailable:()=>s,isProfileButtonInstalled:()=>n,setProfileButtonInstallStatus:()=>i});a(765620),a(68554);var r=a(670053);a(458817);const s=()=>(0,r.getCurrentApp)()?.options.profile_buttons.available||!1,i=e=>{const t=(0,r.getCurrentApp)();t&&(t.options.profile_buttons.installed=e)},n=()=>(0,r.getCurrentApp)()?.options.profile_buttons.installed||!1,o=()=>(0,r.getCurrentApp)()?.options.profile_buttons.hash||""},458817:(e,t,a)=>{a.d(t,{deleteAddToProfileBridgeContext:()=>n,deleteRemoveFromProfileBridgeContext:()=>p,getAddToProfileBridgeContext:()=>s,getRemoveFromProfileBridgeContext:()=>o,setAddToProfileBridgeContext:()=>i,setRemoveFromProfileBridgeContext:()=>c});var r=a(670053);const s=()=>(0,r.getCurrentApp)()?.VKWebAppAddToProfileContext,i=e=>{const t=(0,r.getCurrentApp)();t&&(t.VKWebAppAddToProfileContext=e)},n=()=>{const e=(0,r.getCurrentApp)();e&&delete e.VKWebAppAddToProfileContext},o=()=>(0,r.getCurrentApp)()?.VKWebAppRemoveFromProfileContext,c=e=>{const t=(0,r.getCurrentApp)();t&&(t.VKWebAppRemoveFromProfileContext=e)},p=()=>{const e=(0,r.getCurrentApp)();e&&delete e.VKWebAppRemoveFromProfileContext}},910364:(e,t,a)=>{a.d(t,{createCacheService:()=>s});var r=a(746573);const s=e=>{const t=(0,r.getEffectorServiceDomain)(e),a=Object.create(null),s=t.createStore(Object.create(null)),i=t.createEvent("add"),n=t.createEvent("delete");return s.on(i,((e,{key:t,data:a})=>(e[t]=a,e))).on(n,((e,t)=>(delete e[t],e))),{$cache:s,add:i,delete:n,get:e=>s.getState()[e]||null,isWaited:e=>void 0!==a[e],getWaited:e=>a[e],setWaited:(e,t)=>{a[e]=t},deleteWaited:e=>{delete a[e]}}}},136335:(e,t,a)=>{a.d(t,{createOwnerService:()=>s.createOwnerService,createUserService:()=>r.createUserService});var r=a(277594),s=a(43188)},43188:(e,t,a)=>{a.d(t,{createOwnerService:()=>d});var r=a(32489),s=a(805658),i=a(810068),n=a(910364),o=a(746573),c=a(33305);const p=(0,n.createCacheService)(),d=e=>{const t=e.fields||[],a=(0,o.getEffectorServiceDomain)(e),n=a.createStore({id:0}),d=a.createEvent("initialize"),l=a.createEvent("reload"),_=a.createEffect({name:"initializeFx"}),h=_.pending,u=_.doneData;return _.use((({ownerId:e,useCache:a})=>{if(a){const a=p.get(e);if(a){if(t.every((e=>a.hasOwnProperty(e))))return Promise.resolve(a)}}if(p.isWaited(e)){const a=p.getWaited(e).find((e=>t.every((t=>Boolean(e.fields[t])))));if(a)return a.promise.finally((()=>{p.deleteWaited(e)})),a.promise}let r=i.Ranges.isGroupId(e)?(0,s.apiWithPrefetch)("groups.getById",{group_ids:String(e),fields:t.join(",")}).then((t=>t.groups?.[0]||{id:e})):(0,s.apiWithPrefetch)("users.get",{user_ids:String(e),fields:t.join(",")}).then((e=>e[0]));const n={fields:t.reduce(((e,t)=>(e[t]=!0,e)),{}),promise:r},o=p.isWaited(e)?[...p.getWaited(e),n]:[n];return p.setWaited(e,o),r})),(0,r.sample)({clock:d,source:n,filter:(e,t)=>e.id!==t,fn:(t,a)=>({ownerId:a,useCache:Boolean(e?.useCache)}),target:_}),(0,r.sample)({clock:l,source:n,fn:e=>({ownerId:e.id}),target:_}),(0,r.sample)({clock:_.doneData,target:n}),(0,r.sample)({clock:_.doneData,filter:()=>Boolean(e?.useCache),fn:e=>{const t=p.get(e.id);if(t){if((0,c.isOwnerUser)(t)&&(0,c.isOwnerUser)(e))return{key:e.id,data:{...t,...e}};if((0,c.isOwnerGroup)(t)&&(0,c.isOwnerGroup)(e))return{key:e.id,data:{...t,...e}}}return{key:e.id,data:e}},target:p.add}),{$isInitializing:h,$owner:n,initialize:d,onInitialized:u,reload:l}}},277594:(e,t,a)=>{a.d(t,{createUserService:()=>n});var r=a(32489),s=a(957994),i=a(805658);const n=({domain:e})=>{const t=(e,t)=>!(!e||e.id!==t.userId),a=e.createStore(null),n=e.createEffect((({params:e})=>(0,i.apiWithPrefetch)("users.get",e))),o=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,s.api)("wall.subscribe",e.params)}))),c=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,s.api)("wall.unsubscribe",e.params)}))),p=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,s.api)("video.liveSubscribe",e.params)}))),d=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,s.api)("video.liveUnsubscribe",e.params)}))),l=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,s.api)("fave.addUser",e.params)}))),_=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,s.api)("fave.removeUser",e.params)}))),h=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,s.api)("account.ban",e.params)}))),u=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,s.api)("account.unban",e.params)}))),m=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,s.api)("bestFriends.add",e.params)}))),g=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,s.api)("bestFriends.delete",e.params)})));return(0,r.sample)({clock:n.doneData,fn:e=>e[0]||null,target:a}),(0,r.sample)({clock:o.doneData,source:a,filter:t,fn:e=>({...e,is_subscribed:1}),target:a}),(0,r.sample)({clock:c.doneData,source:a,filter:t,fn:e=>({...e,is_subscribed:0}),target:a}),(0,r.sample)({clock:p.doneData,source:a,filter:t,fn:e=>({...e,video_live:e.video_live?{...e.video_live,is_notifications_blocked:0}:void 0}),target:a}),(0,r.sample)({clock:d.doneData,source:a,filter:t,fn:e=>({...e,video_live:e.video_live?{...e.video_live,is_notifications_blocked:1}:void 0}),target:a}),(0,r.sample)({clock:l.doneData,source:a,filter:t,fn:e=>({...e,is_favorite:1}),target:a}),(0,r.sample)({clock:_.doneData,source:a,filter:t,fn:e=>({...e,is_favorite:0}),target:a}),(0,r.sample)({clock:h.doneData,source:a,filter:t,fn:e=>({...e,blacklisted_by_me:1}),target:a}),(0,r.sample)({clock:u.doneData,source:a,filter:t,fn:e=>({...e,blacklisted_by_me:0}),target:a}),(0,r.sample)({clock:m.doneData,source:a,filter:t,fn:e=>({...e,is_best_friend:!0}),target:a}),(0,r.sample)({clock:g.doneData,source:a,filter:t,fn:e=>({...e,is_best_friend:!1}),target:a}),{fetchUserFx:n,subscribeToPostsFx:o,unsubscribeFromPostsFx:c,subscribeToVideoLiveFx:p,unsubscribeFromVideoLiveFx:d,faveAddUserFx:l,faveRemoveUserFx:_,accountBanFx:h,accountUnbanFx:u,bestFriendAddFx:m,bestFriendDeleteFx:g,$user:a,domain:e}}},653422:(e,t,a)=>{a.d(t,{apiFaveAddNarrative:()=>s,apiFaveRemoveNarrative:()=>i});var r=a(957994);function s(e){return(0,r.api)("fave.addNarrative",e)}function i(e){return(0,r.api)("fave.removeNarrative",e)}},373237:(e,t,a)=>{a.d(t,{createFaveService:()=>i});var r=a(32489),s=a(653422);const i=({domain:e})=>{const t=e.createEvent("fire/faveAddNarrative"),a=e.createEvent("fire/faveRemoveNarrative"),i=e.createEffect("fx/faveAddNarrative"),n=e.createEffect("fx/faveRemoveNarrative");return i.use(s.apiFaveAddNarrative),n.use(s.apiFaveRemoveNarrative),(0,r.sample)({clock:t,target:i}),(0,r.sample)({clock:a,target:n}),{fireAddNarrative:t,fireRemoveNarrative:a,addNarrativeFx:i,removeNarrativeFx:n}}},661113:(e,t,a)=>{a.d(t,{useDebounce:()=>s});var r=a(296540);const s=(e,t)=>{const[a,s]=(0,r.useState)(e);return(0,r.useEffect)((()=>{const a=setTimeout((()=>{s(e)}),t);return()=>{clearTimeout(a)}}),[e]),a}},636296:(e,t,a)=>{a.d(t,{sendUploadRequest:()=>r});const r=(e,t,a)=>new Promise(((r,s)=>{const i=new XMLHttpRequest;i.open("POST",e,!0),a&&(i.upload.onloadstart=e=>{a(e)},i.upload.onprogress=e=>{a(e)}),i.onerror=()=>{s("Unknown error")},i.onreadystatechange=()=>{i.readyState===XMLHttpRequest.DONE&&(200===i.status?r(i.responseText):s())},i.send(t)}))},189878:(e,t,a)=>{a.d(t,{MAX_STORY_VIDEO_DURATION:()=>c,getStoryUploadUrl:()=>_,getStoryUploadUrlApi:()=>l,saveStoryOnServer:()=>u,uploadStoryBlobToServer:()=>h});var r=a(898848),s=a(41903),i=a(646938),n=a(351118),o=a(636296);const c=16,p=(e,t)=>{const{id:a,entry_point:r,ref:s,clickable_stickers:i,question_id:n,mini_app_id:o,live_cover:c,add_to_news:p=1,analytics:d,attachment:l,situational_suggest_id:_,live_cover_position:h,is_authors_ads:u,ord_external_id:m,ord_erid:g}=e,v={group_id:a,add_to_news:p,entry_point:r,ref:s,clickable_stickers:i,question_id:n,mini_app_id:o,live_cover:c,analytics:d,situational_suggest_id:_,is_authors_ads:u?1:0,ord_external_id:m,ord_erid:g};if(l){const e=JSON.parse(l);e.type&&!["url","playlist"].includes(e.type)&&(v.attach_type=e.type),e?.url&&(v.link_url=e.url),e?.text&&(v.link_text=e.text),e?.owner_id&&(v.attach_owner_id=e.owner_id),e?.id&&(v.attach_id=e.id),e?.access_key&&(v.attach_access_key=e.access_key)}return v.attach_type||(v.attach_type=t),c&&h&&(v.live_cover_position=h),v};function d(e){if(!e)return"";const t=(0,n.isString)(e)?JSON.parse(e):e||[],a=t?.stickers?.map((e=>e?.id));return a?.join(",")||""}function l(e,t){return t===i.StoryType.PHOTO?s.storiesService.getPhotoUploadServerFx({...e,sticker_ids:d(e.analytics),upload_v2:1}).then((({upload_url:e})=>e)):s.storiesService.getVideoUploadServerFx(e).then((({upload_url:e})=>e))}function _(e,t){return l(p(e,t),t)}function h(e,t,a){const s=new FormData,i=encodeURIComponent(`edited_${(0,r.irand)(0,99999)}.jpg`);return s.append("file",e,i),(0,o.sendUploadRequest)(t,s,a)}function u(e,t){const a=t===i.StoryType.PHOTO?e:JSON.parse(e)?.response?.upload_result;return s.storiesService.saveFx({upload_results_json:JSON.stringify([{upload_result:a}])}).then((({items:e})=>({story:e[0]})))}},646938:(e,t,a)=>{a.d(t,{DynamicStickersTypes:()=>p,StickerTypes:()=>c,StoryBlockType:()=>n,StoryEntryPoint:()=>s,StoryListName:()=>o,StoryPollBackgroundType:()=>_,StorySource:()=>i,StoryType:()=>r,dynamicStickerIds:()=>d,staticStickerIds:()=>l});var r=function(e){return e.PHOTO="photo",e.VIDEO="video",e.LIVE="live",e}({}),s=function(e){return e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar",e.GROUP_ADD_STORIES_PAGE="group_add_stories_page",e.MUSIC_COVER_SHARING="music_cover_sharing",e}({}),i=function(e){return e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar",e.MY_QUESTIONS="question_story",e}({}),n=function(e){return e.stories="stories",e.promoStories="promo_stories",e.discover="discover",e.liveActive="live_active",e.liveFinished="live_finished",e}({}),o=function(e){return e.feed="feed",e.discover="discover",e}({});const c={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,sticker:12,app:13,situationalTheme:14,playlist:15,videoButton:16,situationalTemplate:17,spoiler:18,service_yc_item:19,photo:20,album:21},p={situationalTemplate:c.situationalTemplate},d=Object.values(p),l=Object.values(c).filter((e=>!d.includes(e)));var _=function(e){return e.photo="photo",e.gradient="gradient",e.default="default",e}({})},33270:(e,t,a)=>{a.d(t,{apiLikesAdd:()=>s,apiLikesDelete:()=>i});var r=a(957994);function s(e){return(0,r.api)("likes.add",e)}function i(e){return(0,r.api)("likes.delete",e)}},208579:(e,t,a)=>{},733498:(e,t,a)=>{a.d(t,{createLikesService:()=>r.createLikesService});var r=a(921245);a(208579)},921245:(e,t,a)=>{a.d(t,{createLikesService:()=>i});var r=a(32489),s=a(33270);const i=({domain:e})=>{const t=e.createEvent("fire/likesAdd"),a=e.createEvent("fire/likesDelete"),i=e.createEffect("fx/likesAdd"),n=e.createEffect("fx/likesDelete");return i.use(s.apiLikesAdd),n.use(s.apiLikesDelete),(0,r.sample)({clock:t,target:i}),(0,r.sample)({clock:a,target:n}),{fireAdd:t,fireDelete:a,addFx:i,deleteFx:n}}},928410:(e,t,a)=>{a.d(t,{apiMessagesSend:()=>s});var r=a(957994);function s(e){return(0,r.api)("messages.send",e)}},455673:(e,t,a)=>{a.d(t,{createMessagesService:()=>i});var r=a(32489),s=a(928410);const i=({domain:e})=>{const t=e.createEvent("fire/messageSend"),a=e.createEffect("fx/messageSend");return a.use(s.apiMessagesSend),(0,r.sample)({clock:t,target:a}),{fireMessagesSend:t,sendFx:a}}},869397:(e,t,a)=>{a.d(t,{apiNarrativesBatchEdit:()=>n,apiNarrativesCreate:()=>s,apiNarrativesDelete:()=>o,apiNarrativesEdit:()=>i,apiNarrativesGetById:()=>c,apiNarrativesGetCustomCoverUploadServer:()=>h,apiNarrativesGetFeedBlock:()=>p,apiNarrativesGetFromOwner:()=>d,apiNarrativesReorder:()=>_,apiNarrativesSaveCustomCover:()=>l});var r=a(957994);function s(e){return(0,r.api)("narratives.create",e)}function i(e){return(0,r.api)("narratives.edit",e)}function n(e){return(0,r.api)("narratives.batchEdit",e)}function o(e){return(0,r.api)("narratives.delete",e)}function c(e){return(0,r.api)("narratives.getById",e)}function p(e={}){return(0,r.api)("narratives.getFeedBlock",e)}function d(e){return(0,r.api)("narratives.getFromOwner",e)}function l(e){return(0,r.api)("narratives.saveCustomCover",e)}function _(e){return(0,r.api)("narratives.reorder",e)}function h(e){return(0,r.api)("narratives.getCustomCoverUploadServer",e)}},942838:(e,t,a)=>{a.d(t,{createNarrativesService:()=>i});var r=a(32489),s=a(869397);const i=({domain:e})=>{const t=e.createEvent("fire/narrativesGetById"),a=e.createEvent("fire/narrativesGetFromOwner"),i=e.createEvent("fire/narrativesGetFeedBlock"),n=e.createEvent("fire/narrativesCreate"),o=e.createEvent("fire/narrativesEdit"),c=e.createEvent("fire/narrativesBatchEdit"),p=e.createEvent("fire/narrativesDelete"),d=e.createEvent("fire/narrativesSaveCustomCover"),l=e.createEvent("fire/narrativesReorder"),_=e.createEffect("fx/narrativesGetById"),h=e.createEffect("fx/narrativesGetFromOwner"),u=e.createEffect("fx/narrativesGetFeedBlock"),m=e.createEffect("fx/narrativesCreate"),g=e.createEffect("fx/narrativesEdit"),v=e.createEffect("fx/narrativesBatchEdit"),A=e.createEffect("fx/narrativesDelete"),E=e.createEffect("fx/narrativesSaveCustomCover"),f=e.createEffect("fx/narrativesReorder");return _.use(s.apiNarrativesGetById),h.use(s.apiNarrativesGetFromOwner),u.use(s.apiNarrativesGetFeedBlock),m.use(s.apiNarrativesCreate),g.use(s.apiNarrativesEdit),v.use(s.apiNarrativesBatchEdit),A.use(s.apiNarrativesDelete),E.use(s.apiNarrativesSaveCustomCover),f.use(s.apiNarrativesReorder),(0,r.sample)({clock:t,target:_}),(0,r.sample)({clock:a,target:h}),(0,r.sample)({clock:i,target:u}),(0,r.sample)({clock:n,target:m}),(0,r.sample)({clock:o,target:g}),(0,r.sample)({clock:c,target:v}),(0,r.sample)({clock:p,target:A}),(0,r.sample)({clock:d,target:E}),(0,r.sample)({clock:l,target:f}),{fireGetById:t,fireGetFromOwner:a,fireGetFeedBlock:i,fireCreate:n,fireEdit:o,fireBatchEdit:c,fireDelete:p,fireSaveCustomCover:d,fireReorder:l,getByIdFx:_,getFromOwnerFx:h,getFeedBlockFx:u,createFx:m,editFx:g,batchEditFx:v,deleteFx:A,saveCustomCoverFx:E,reorderFx:f}}},616220:(e,t,a)=>{a.d(t,{apiPollsCreate:()=>i,apiPollsGetById:()=>s});var r=a(957994);function s(e){return(0,r.api)("polls.getById",e)}function i(e){return(0,r.api)("polls.create",e)}},49819:(e,t,a)=>{a.d(t,{createPollsService:()=>i});var r=a(32489),s=a(616220);const i=({domain:e})=>{const t=e.createEvent("fire/pollsGetById"),a=e.createEvent("fire/pollsCreate"),i=e.createEffect("fx/pollsGetById"),n=e.createEffect("fx/pollsCreate");return i.use(s.apiPollsGetById),n.use(s.apiPollsCreate),(0,r.sample)({clock:t,target:i}),(0,r.sample)({clock:a,target:n}),{fireGetById:t,fireCreate:a,getByIdFx:i,createFx:n}}},913885:(e,t,a)=>{a.d(t,{apiStatsTrackEvents:()=>s});var r=a(957994);function s(e){return(0,r.api)("stats.trackEvents",e)}},809152:(e,t,a)=>{a.d(t,{STATS_EVENT_TYPE_STORIES_VIEWER_NAVIGATION:()=>r,STATS_EVENT_TYPE_STORIES_VIEWING_START_TIME:()=>s,STATS_EVENT_TYPE_STORY_LINK_VIEW:()=>i,STATS_EVENT_TYPE_VIDEO_ONBOARDING:()=>n});const r="stories_viewer_navigation",s="stories_viewing_start_time",i="story_link_view",n="video_onboarding"},744030:(e,t,a)=>{a.d(t,{createStatsService:()=>i});var r=a(32489),s=a(913885);const i=({domain:e})=>{const t=e.createEvent("fire/statsTrackEvents"),a=e.createEffect("fx/statsTrackEvents");return a.use(s.apiStatsTrackEvents),(0,r.sample)({clock:t,target:a}),{fireTrackEvents:t,trackEventsFx:a}}},288191:(e,t,a)=>{a.d(t,{apiStoriesAskQuestion:()=>b,apiStoriesBanOwner:()=>I,apiStoriesBanQuestionAuthor:()=>R,apiStoriesCreatePostponed:()=>P,apiStoriesDelete:()=>S,apiStoriesDeleteQuestion:()=>w,apiStoriesGet:()=>i,apiStoriesGetArchive:()=>p,apiStoriesGetById:()=>o,apiStoriesGetDetailedStats:()=>m,apiStoriesGetDiscover:()=>c,apiStoriesGetPhotoUploadServer:()=>k,apiStoriesGetQuestions:()=>h,apiStoriesGetReplies:()=>l,apiStoriesGetStats:()=>u,apiStoriesGetVideoUploadServer:()=>y,apiStoriesGetViewers:()=>d,apiStoriesGetWithPrefetch:()=>n,apiStoriesHideAllReplies:()=>D,apiStoriesHidePrivacyBlock:()=>f,apiStoriesHideReply:()=>x,apiStoriesMarkNotInterested:()=>v,apiStoriesMarkSeen:()=>E,apiStoriesMarkSkipped:()=>g,apiStoriesSave:()=>O,apiStoriesSearch:()=>A,apiStoriesSeenReplies:()=>_,apiStoriesSetDiscoverVisible:()=>T,apiStoriesUnbanOwner:()=>N,apiStoriesUnbanQuestionAuthor:()=>C});var r=a(957994),s=a(805658);function i(e){return(0,r.api)("stories.get",e)}function n(e){return(0,s.apiWithPrefetch)("stories.get",e)}function o(e){return(0,r.api)("stories.getById",e)}function c(e){return(0,r.api)("stories.getDiscover",e)}function p(e){return(0,r.api)("stories.getArchive",e)}function d(e){return(0,r.api)("stories.getViewers",e)}function l(e){return(0,r.api)("stories.getReplies",e)}function _(e){return(0,r.api)("stories.seenReplies",e)}function h(e){return(0,r.api)("stories.getQuestions",e)}function u(e){return(0,r.api)("stories.getStats",e)}function m(e){return(0,r.api)("stories.getDetailedStats",e)}function g(e){return(0,r.api)("stories.markSkipped",e)}function v(e){return(0,r.api)("stories.markNotInterested",e)}function A(e){return(0,r.api)("stories.search",e)}function E(e){return(0,r.api)("stories.markSeen",e)}function f(e){return(0,r.api)("stories.hidePrivacyBlock",e)}function S(e){return(0,r.api)("stories.delete",e)}function b(e){return(0,r.api)("stories.askQuestion",e)}function w(e){return(0,r.api)("stories.deleteQuestion",e)}function R(e){return(0,r.api)("stories.banQuestionAuthor",e)}function C(e){return(0,r.api)("stories.unbanQuestionAuthor",e)}function k(e){return(0,r.api)("stories.getPhotoUploadServer",e)}function y(e){return(0,r.api)("stories.getVideoUploadServer",e)}function O(e){return(0,r.api)("stories.save",e)}function I(e){return(0,r.api)("stories.banOwner",e)}function N(e){return(0,r.api)("stories.unbanOwner",e)}function T(e){return(0,r.api)("stories.setDiscoverVisible",e)}function x(e){return(0,r.api)("stories.hideReply",e)}function D(e){return(0,r.api)("stories.hideAllReplies",e)}function P(e){return(0,r.api)("stories.createPostponed",{...e,stories:JSON.stringify(e.stories)})}},837066:(e,t,a)=>{a.d(t,{STORIES_ARCHIVE_START_TIME:()=>i,STORIES_EDITOR_FONTS:()=>n,STORIES_MAX_COUNT_REPLIES:()=>s});var r=a(866467);const s=250,i=1559032200,n=[{label:r.getLang("stories_creator_text_label_modern"),fontFamily:"TT Firs Neue"},{label:r.getLang("stories_creator_text_label_playful"),fontFamily:"TT Knickerbockers Script"},{label:r.getLang("stories_creator_text_label_aesthetic"),fontFamily:"TT Knickerbockers Grotesk"},{label:r.getLang("stories_creator_text_label_dynamic"),fontFamily:"TT Commons Bold",fontStyle:"italic"},{label:r.getLang("stories_creator_text_label_classic"),fontFamily:"TT Barrels Trl"},{label:r.getLang("stories_creator_text_label_elegant"),fontFamily:"TT Barrels Trl Italic",fontStyle:"italic"},{label:r.getLang("stories_creator_text_label_rounded"),fontFamily:"TT Rounds Neue",textTransform:"uppercase"},{label:r.getLang("stories_creator_text_label_standard"),fontFamily:"TT Commons"},{label:r.getLang("stories_creator_text_label_handwritten"),fontFamily:"TT Lovelies Script"},{label:r.getLang("stories_creator_text_label_bookish"),fontFamily:"TT Phobos"}]},828912:(e,t,a)=>{a.d(t,{StoryFeedbackLoadMethods:()=>i,fetchFeedbackFx:()=>o,getStoryFeedbackLoadParams:()=>n});var r=a(564586),s=a(594496),i=function(e){return e[e.getViewers=0]="getViewers",e[e.getReplies=1]="getReplies",e[e.seenReplies=2]="seenReplies",e[e.getQuestions=3]="getQuestions",e[e.getDetailedStats=4]="getDetailedStats",e}({});const n=(e,t)=>({0:{owner_id:e,story_id:t,extended:1,count:100,fields:(0,s.makeOwnerFields)(["photo_100","photo_50"])},1:{owner_id:e,story_id:t,extended:1,fields:(0,s.getStoryOwnerFields)()},2:{owner_id:e,story_id:t},3:{owner_id:e,story_id:t,extended:1,fields:(0,s.makeOwnerFields)(["domain","first_name_dat","first_name_ins","last_name_ins","last_name_dat","first_name_gen","last_name_gen"]),count:100},4:{owner_id:e,story_id:t}}),o=r.storiesDomain.createEffect({name:"fire/storiesGetFeedback",handler:({ownerId:e,storyId:t,pollId:a})=>{const s=n(e,t);return Promise.allSettled([r.storiesService.getViewersFx(s[0]),r.storiesService.getRepliesFx(s[1]),r.storiesService.getQuestionsFx(s[3]),a?r.pollsService.getByIdFx({owner_id:e,poll_id:a}):Promise.resolve(null),r.storiesService.getDetailedStatsFx(s[4])]).then((e=>e.map((e=>"fulfilled"===e.status?e?.value:null)))).finally((()=>{r.storiesService.seenRepliesFx(s[2])}))}})},41903:(e,t,a)=>{a.d(t,{STORIES_ARCHIVE_START_TIME:()=>o.STORIES_ARCHIVE_START_TIME,STORIES_EDITOR_FONTS:()=>o.STORIES_EDITOR_FONTS,STORIES_MAX_COUNT_REPLIES:()=>o.STORIES_MAX_COUNT_REPLIES,StoryFeedbackLoadMethods:()=>p.StoryFeedbackLoadMethods,apiStoriesCreatePostponed:()=>n.apiStoriesCreatePostponed,apiStoriesDelete:()=>n.apiStoriesDelete,apiStoriesGet:()=>n.apiStoriesGet,apiStoriesGetArchive:()=>n.apiStoriesGetArchive,apiStoriesGetById:()=>n.apiStoriesGetById,apiStoriesGetDiscover:()=>n.apiStoriesGetDiscover,apiStoriesGetReplies:()=>n.apiStoriesGetReplies,apiStoriesGetWithPrefetch:()=>n.apiStoriesGetWithPrefetch,apiStoriesSearch:()=>n.apiStoriesSearch,createStoriesService:()=>r.createStoriesService,decodeBase64:()=>s.decodeBase64,faveService:()=>c.faveService,fetchFeedbackFx:()=>p.fetchFeedbackFx,getStoryFeedbackLoadParams:()=>p.getStoryFeedbackLoadParams,narrativesService:()=>c.narrativesService,saveNavigationStatEvent:()=>i.saveNavigationStatEvent,saveViewerStartTime:()=>i.saveViewerStartTime,splitStoryRawId:()=>s.splitStoryRawId,statsService:()=>c.statsService,storiesService:()=>c.storiesService,userService:()=>c.userService});var r=a(898368),s=a(601686),i=a(541756),n=a(288191),o=a(837066),c=a(564586),p=a(828912)},927966:(e,t,a)=>{a.d(t,{FEED_STORIES_BLOCK_OWNER_FIELDS:()=>s,FEED_STORIES_BLOCK_OWNER_MINIMIZED_FIELDS:()=>r});const r=["photo_100"],s=["first_name","last_name","first_name_gen","last_name_gen","first_name_ins","last_name_ins","screen_name","name","is_member","is_closed","photo_50","photo_100","photo_200","friend_status","verified","sex"]},594496:(e,t,a)=>{a.d(t,{getStoryOwnerFields:()=>s,makeOwnerFields:()=>i});var r=a(927966);function s(e=!1){return i(e?r.FEED_STORIES_BLOCK_OWNER_MINIMIZED_FIELDS:r.FEED_STORIES_BLOCK_OWNER_FIELDS)}function i(e){return e.join(",")}},898368:(e,t,a)=>{a.d(t,{createStoriesService:()=>c});var r=a(32489),s=a(288191),i=a(80963),n=a(755812),o=a(869071);const c=({domain:e})=>{const t=e.createEvent("fire/storiesGet"),a=e.createEvent("fire/storiesGetById"),c=e.createEvent("fire/storiesGetArchive"),p=e.createEvent("fire/storiesGetViewers"),d=e.createEvent("fire/storiesGetReplies"),l=e.createEvent("fire/storiesSeenReplies"),_=e.createEvent("fire/storiesGetQuestions"),h=e.createEvent("fire/storiesGetStats"),u=e.createEvent("fire/storiesGetDetailedStats"),m=e.createEvent("fire/storiesMarkSkipped"),g=e.createEvent("fire/storiesMarkNotInterested"),v=e.createEvent("fire/storiesMarkSeen"),A=e.createEvent("fire/storiesHidePrivacyBlock"),E=e.createEvent("fire/storiesDelete"),f=e.createEvent("fire/storiesAskQuestion"),S=e.createEvent("fire/storiesDeleteQuestion"),b=e.createEvent("fire/storiesBanQuestionAuthor"),w=e.createEvent("fire/storiesUnbanQuestionAuthor"),R=e.createEvent("fire/storiesGetPhotoUploadServer"),C=e.createEvent("fire/storiesGetVideoUploadServer"),k=e.createEvent("fire/storiesSave"),y=e.createEvent("fire/storiesSearch"),O=e.createEvent("fire/storiesUnbanOwner"),I=e.createEvent("fire/storiesBanOwner"),N=e.createEvent("fire/storiesSetDiscoverVisible"),T=e.createEvent("fire/storiesHideReply"),x=e.createEvent("fire/storieHideAllReplies"),D=e.createEffect("fx/storiesGet"),P=e.createEffect("fx/storiesGetById"),L=e.createEffect("fx/storiesGetArchive"),V=e.createEffect("fx/storiesGetViewers"),W=e.createEffect("fx/storiesGetReplies"),M=e.createEffect("fx/storiesSeenReplies"),H=e.createEffect("fx/storiesGetQuestions"),F=e.createEffect("fx/storiesGetStats"),K=e.createEffect("fx/storiesGetDetailedStats"),B=e.createEffect("fx/storiesMarkSkipped"),U=e.createEffect("fx/storiesMarkNotInterested"),G=e.createEffect("fx/storiesMarkSeen"),j=e.createEffect("fx/storiesHidePrivacyBlock"),$=e.createEffect("fx/storiesDelete"),q=e.createEffect("fx/storiesAskQuestion"),Y=e.createEffect("fx/storiesDeleteQuestion"),z=e.createEffect("fx/storiesBanQuestionAuthor"),Q=e.createEffect("fx/storiesUnbanQuestionAuthor"),J=e.createEffect("fx/storiesGetPhotoUploadServer"),X=e.createEffect("fx/storiesGetVideoUploadServer"),Z=e.createEffect("fx/storiesSave"),ee=e.createEffect("fx/storiesSearch"),te=e.createEffect("fx/storiesUnbanOwner"),ae=e.createEffect("fx/storiesBanOwner"),re=e.createEffect("fx/storiesSetDiscoverVisible"),se=e.createEffect("fx/storiesHideReply"),ie=e.createEffect("fx/storiesHideAllReplies"),ne=(0,i.createFriendsAddFx)({domain:e}),oe=(0,i.createFriendsDeleteFx)({domain:e}),ce=(0,n.createGroupsJoinFx)({domain:e}),pe=(0,n.createGroupsLeaveFx)({domain:e});return D.use(s.apiStoriesGet),P.use(s.apiStoriesGetById),L.use(s.apiStoriesGetArchive),V.use(s.apiStoriesGetViewers),W.use(s.apiStoriesGetReplies),M.use(s.apiStoriesSeenReplies),H.use(s.apiStoriesGetQuestions),F.use(s.apiStoriesGetStats),K.use(s.apiStoriesGetDetailedStats),B.use(s.apiStoriesMarkSkipped),U.use(s.apiStoriesMarkNotInterested),G.use(s.apiStoriesMarkSeen),j.use(s.apiStoriesHidePrivacyBlock),$.use(s.apiStoriesDelete),q.use(s.apiStoriesAskQuestion),Y.use(s.apiStoriesDeleteQuestion),z.use(s.apiStoriesBanQuestionAuthor),Q.use(s.apiStoriesUnbanQuestionAuthor),J.use(s.apiStoriesGetPhotoUploadServer),X.use(s.apiStoriesGetVideoUploadServer),Z.use(s.apiStoriesSave),ee.use(s.apiStoriesSearch),ae.use(s.apiStoriesBanOwner),te.use(s.apiStoriesUnbanOwner),re.use(s.apiStoriesSetDiscoverVisible),se.use(s.apiStoriesHideReply),ie.use(s.apiStoriesHideAllReplies),(0,o.connectTrackTmrGroupsJoin)(ce),(0,r.sample)({clock:t,target:D}),(0,r.sample)({clock:a,target:P}),(0,r.sample)({clock:c,target:L}),(0,r.sample)({clock:p,target:V}),(0,r.sample)({clock:d,target:W}),(0,r.sample)({clock:l,target:M}),(0,r.sample)({clock:_,target:H}),(0,r.sample)({clock:h,target:F}),(0,r.sample)({clock:u,target:K}),(0,r.sample)({clock:m,target:B}),(0,r.sample)({clock:g,target:U}),(0,r.sample)({clock:v,target:G}),(0,r.sample)({clock:A,target:j}),(0,r.sample)({clock:E,target:$}),(0,r.sample)({clock:f,target:q}),(0,r.sample)({clock:S,target:Y}),(0,r.sample)({clock:b,target:z}),(0,r.sample)({clock:w,target:Q}),(0,r.sample)({clock:R,target:J}),(0,r.sample)({clock:C,target:X}),(0,r.sample)({clock:k,target:Z}),(0,r.sample)({clock:y,target:ee}),(0,r.sample)({clock:O,target:te}),(0,r.sample)({clock:I,target:ae}),(0,r.sample)({clock:N,target:re}),(0,r.sample)({clock:T,target:se}),(0,r.sample)({clock:x,target:ie}),{fireGet:t,fireGetById:a,fireGetArchive:c,fireGetViewers:p,fireGetReplies:d,fireSeenReplies:l,fireGetQuestions:_,fireGetStats:h,fireGetDetailedStats:u,fireMarkSkipped:m,fireMarkNotInterested:g,fireMarkSeen:v,fireHidePrivacyBlock:A,fireDelete:E,fireAskQuestion:f,fireDeleteQuestion:S,fireBanQuestionAuthor:b,fireUnbanQuestionAuthor:w,fireGetPhotoUploadServer:R,fireGetVideoUploadServer:C,fireSave:k,fireSearch:y,fireUnbanOwner:O,fireBanOwner:I,fireSetDiscoverVisible:N,fireHideReply:T,fireHideAllReplies:x,getFx:D,getByIdFx:P,getArchiveFx:L,getViewersFx:V,getRepliesFx:W,seenRepliesFx:M,getQuestionsFx:H,getStatsFx:F,getDetailedStatsFx:K,markSkippedFx:B,markNotInterestedFx:U,markSeenFx:G,hidePrivacyBlockFx:j,deleteFx:$,askQuestionFx:q,deleteQuestionFx:Y,banQuestionAuthorFx:z,unbanQuestionAuthorFx:Q,getPhotoUploadServerFx:J,getVideoUploadServerFx:X,saveFx:Z,searchFx:ee,unbanOwnerFx:te,banOwnerFx:ae,setDiscoverVisibleFx:re,hideReplyFx:se,hideAllRepliesFx:ie,friendsAddFx:ne,friendsDeleteFx:oe,groupsJoinFx:ce,groupsLeaveFx:pe}}},564586:(e,t,a)=>{a.d(t,{faveService:()=>g,narrativesService:()=>m,pollsService:()=>v,statsService:()=>u,storiesDomain:()=>_,storiesService:()=>h,userService:()=>A});var r=a(32489),s=a(41903),i=a(744030),n=a(942838),o=a(733498),c=a(455673),p=a(373237),d=a(49819),l=a(136335);const _=(0,r.createDomain)("stories"),h=(0,s.createStoriesService)({domain:_}),u=(0,i.createStatsService)({domain:_}),m=(0,n.createNarrativesService)({domain:_}),g=((0,o.createLikesService)({domain:_}),(0,c.createMessagesService)({domain:_}),(0,p.createFaveService)({domain:_})),v=(0,d.createPollsService)({domain:_}),A=(0,l.createUserService)({domain:_})},601686:(e,t,a)=>{function r(e){return(e?.split("_")??[]).map(Number)}function s(e,t="windows-1251"){return new TextDecoder(t).decode(function(e){const t=atob(e);return Uint8Array.from(t,(e=>e.codePointAt(0)||0))}(e))}a.d(t,{decodeBase64:()=>s,splitStoryRawId:()=>r})},456579:(e,t,a)=>{a.d(t,{validatePhoneCheck:()=>s});var r=a(957994);const s=(e,t)=>{const{apiDomain:a}=window.vk.apiConfigDomains;return(0,r.api)("auth.validatePhoneCheck",{is_auth:0,mode:1,app_id:t},{domain:a,...e})}},838221:(e,t,a)=>{a.d(t,{AsyncAtom:()=>i});var r=a(77783),s=a(879168);class i extends s.Atom{async get(){const e=this.getKey();try{return await(0,r.get)(e,this.base.store)||this.cache||null}catch(t){return console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null}}async set(e,t){const a=this.getKey();try{await(0,r.set)(a,e,this.base.store)}catch(t){console.log(`${a}: Не удалось записать данные в хранилище`),console.log(t),this.cache=e}super.set(e,t)}async delete(){const e=this.getKey();delete this.cache;try{await(0,r.del)(e,this.base.store),this.base.notify(this.key)}catch(t){console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}}constructor(e){super(e);const{base:t}=e;this.base=t}}},955326:(e,t,a)=>{a.d(t,{createAsyncStore:()=>o});var r=a(77783),s=a(98184),i=a(838221);class n extends s.Store{createAtom(e){return new i.AsyncAtom({key:e,base:this})}async clear(){await(0,r.clear)(this.store),this.notify()}constructor(e){super(e);const{dbName:t,version:a}=e;try{this.store=(0,r.createStore)(`${t}-v${a}`,t)}catch{}}}function o(e){return new n(e)}},280977:(e,t,a)=>{a.d(t,{CallsEventType:()=>r,eventHandlersToEventBusMap:()=>s});var r=function(e){return e.DEVICE_CHANGED="device_changed",e.LOCAL_MICROPHONE_VOLUME_CHANGED="local_microphone_volume_changed",e.NAME_CHANGED="name_changed",e.REMOTE_REMOVED="remote_removed",e.REMOTE_STATUS_CHANGED="remote_status_changed",e.SCREEN_SHARING_ENABLED="screen_sharing_enabled",e.SCREEN_SHARING_DISABLED="screen_sharing_disabled",e.ERROR_START_CALL="error_start_call",e.HAND_COUNT_CHANGED="hand_count_changed",e.SUCCESS_FEEDBACK="success_feedback",e.MISSING_CALL="missing_call",e.ERROR="error",e.FATAL_ERROR="fatal_error",e.HANGUP="hangup",e.OUTGOING_CALL_ACCEPTED="outgoing_call_accepted",e.OUTGOING_CALL_DECLINED="outgoing_call_declined",e.INCOMING_CALL_ACCEPTED="incoming_call_accepted",e.INCOMING_CALL_DECLINED="incoming_call_declined",e.SCREEN_SHARING_STARTED="screen_sharing_started",e.SCREEN_SHARING_STOPPED="screen_sharing_stopped",e.CALL_FINISHED_LOCALLY="call_finished_locally",e.CALL_FINISHED_REMOTELY="call_finished_remotely",e.CALL_FINISHED="call_finished",e.CALL_STARTED="call_started",e.LAYOUT_COLLAPSED="layout_collapsed",e.LAYOUT_FULLSCREEN="layout_fullscreen",e.LAYOUT_NORMAL="layout_normal",e.INCOMING_CALL_CANCELED="incoming_call_canceled",e.OUTGOING_CALL_CANCELED="outgoing_call_canceled",e.HISTORY_MODAL_CLOSED="history_modal_closed",e.OPEN_HISTORY_MODAL="open_history_modal",e.INCOMING_CALL_STARTED="incoming_call_started",e.INCOMING_CALL_ACCEPTED_ON_ANOTHER_DEVICE="incoming_call_accepted_on_another_device",e.CALL_ENTERING_ON_ANOTHER_DEVICE="call_entering_on_another_device",e.PARTICIPANT_WAS_KICKED_FROM_CALL="participant_was_kicked_from_call",e.PARTICIPANT_WAS_BLOCKED_IN_CALL="participant_was_blocked_in_call",e}({});const s={onOutgoingCallAccepted:"outgoing_call_accepted",onOutgoingCallDeclined:"outgoing_call_declined",onIncomingCallAccepted:"incoming_call_accepted",onIncomingCallDeclined:"incoming_call_declined",onScreenSharingStarted:"screen_sharing_started",onScreenSharingStopped:"screen_sharing_stopped",onCallFinishedLocally:"call_finished_locally",onCallFinishedRemotely:"call_finished_remotely",onCallFinished:"call_finished",onCallStarted:"call_started",onLayoutCollapsed:"layout_collapsed",onLayoutFullscreen:"layout_fullscreen",onLayoutNormal:"layout_normal",onIncomingCallCanceled:"incoming_call_canceled",onOutgoingCallCanceled:"outgoing_call_canceled",onHistoryModalClosed:"history_modal_closed",onIncomingCallStarted:"incoming_call_started",onIncomingCallAcceptedOnAnotherDevice:"incoming_call_accepted_on_another_device",onCallEnteringOnAnotherDevice:"call_entering_on_another_device",onParticipantWasKickedFromCall:"participant_was_kicked_from_call",onParticipantWasBlockedInCall:"participant_was_blocked_in_call"}},80963:(e,t,a)=>{a.d(t,{createFriendsAddFx:()=>d,createFriendsAddListFx:()=>m,createFriendsDeleteBulkFx:()=>_,createFriendsDeleteFx:()=>l,createFriendsDeleteListFx:()=>g,createFriendsDeleteSubscriberFx:()=>E,createFriendsEditListFx:()=>v,createFriendsGetFriendsDeletionSuggestionsFx:()=>c,createFriendsGetFx:()=>n,createFriendsGetListsFx:()=>s,createFriendsGetRecentFx:()=>w,createFriendsHideSuggestion:()=>C,createFriendsPrefetchCountersFx:()=>b,createFriendsPrefetchFollowersFx:()=>f,createFriendsPrefetchFx:()=>o,createFriendsPrefetchListsFx:()=>i,createFriendsPrefetchMutualFx:()=>R,createFriendsPrefetchOnlineFx:()=>u,createFriendsPrefetchRecommendationsFx:()=>p,createFriendsPrefetchRequestsFx:()=>h,createFriendsRequestsToSubscribersFx:()=>S,createFriendsSearchFx:()=>A});var r=a(412554);const s=e=>(0,r.createApiEffect)("friends.getLists",e),i=e=>(0,r.createPrefetchEffect)("friends.getLists",e),n=e=>(0,r.createApiEffect)("friends.get",e),o=e=>(0,r.createPrefetchEffect)("friends.get",e),c=e=>(0,r.createApiEffect)("friends.getFriendsDeletionSuggestions",e),p=e=>(0,r.createPrefetchEffect)("friends.getRecommendations",e),d=e=>(0,r.createApiEffect)("friends.add",e),l=e=>(0,r.createApiEffect)("friends.delete",e),_=e=>(0,r.createApiEffect)("friends.deleteBulk",e),h=e=>(0,r.createPrefetchEffect)("friends.getRequests",e),u=e=>(0,r.createPrefetchEffect)("friends.getOnline",e),m=e=>(0,r.createApiEffect)("friends.addList",e),g=e=>(0,r.createApiEffect)("friends.deleteList",e),v=e=>(0,r.createApiEffect)("friends.editList",e),A=e=>(0,r.createApiEffect)("friends.search",e),E=e=>(0,r.createApiEffect)("friends.deleteSubscriber",e),f=e=>(0,r.createPrefetchEffect)("friends.getFollowers",e),S=e=>(0,r.createApiEffect)("friends.requestsToSubscribers",e),b=e=>(0,r.createPrefetchEffect)("friends.getCounters",e),w=e=>(0,r.createApiEffect)("friends.getRecent",e),R=e=>(0,r.createPrefetchEffect)("friends.getMutual",e),C=e=>(0,r.createApiEffect)("friends.hideSuggestion",e)},423676:(e,t,a)=>{a.d(t,{VkIndexer:()=>r});var r=function(){function e(e,t,a){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=a||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var a=this.list[t];try{a._order=t}catch(e){}this.add(a)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,a={},r=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(a=t)?1:parseInt(a)||0)>=32?String.fromCharCode(t):e;var a})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),s=r.length;s--;){var i=r[s],n="";if(i){for(var o=0;o<6;o++){var c=i.charCodeAt(o);if(c){var p=this.toTranslit[c],d=i.substr(o,1);n+=null!=p?p:d}}a[n]=1}}return a},e.prototype.strToSearchPrefixes=function(e){for(var t=[],a=e.toLowerCase().split(this.delimiter),r=a.length;r--;){var s={},i=a[r],n="",o="",c="",p=i.length>1;if(i){for(var d=0;d<6;d++){var l=i.charCodeAt(d);if(l){var _=this.toTranslit[l],h=i.substr(d,1);if(n+=null!=_?_:h,p){var u=this.toLocalCase[h],m=this.toLocalTranslit[l];o+=null!=u?u:h,c+=null!=m?m:h}}}s[n]=1,p&&(s[o]=2,s[c]=3),t.push(s)}}return t},e.prototype.toIndexTree=function(e,t){for(var a=this.index,r=0;r<6;r++){var s=e.substr(r,1)||-1;a=a[s]?a[s]:a[s]=5==r?[]:{}}a.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),a=this.strToPrefixes(t);for(var r in a)if(a.hasOwnProperty(r)){for(var s=this.index,i=0;i<6;i++){var n=r.substr(i,1)||-1;if(!s[n])break;s=s[n]}if(s.length)for(var i in s)if(this.equals(s[i],e)){s.splice(i,1);break}}},e.prototype.equals=function(e,t){for(var a in e)if(e.hasOwnProperty(a))switch(typeof e[a]){case"object":if(!this.equals(e[a],t[a]))return!1;break;case"function":if(void 0===e[a]||e[a].toString()!=t[a].toString())return!1;break;default:if(e[a]!=t[a])return!1}for(var a in t)if(void 0===t[a])return!1;return!0},e.prototype.intersect=function(e,t){var a=[];if(s(e[0])||s(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var r=e.shift();r&&a.push(r)}t.shift()}return a},e.prototype.add=function(e){var t=this.prepareFunc(e),a=this.strToPrefixes(t);for(var r in a)a.hasOwnProperty(r)&&this.toIndexTree(r,e)},e.prototype.search=function(e){var t=this.index,a=this.strToSearchPrefixes(e),r=[],s=!1;for(var i in a)if(a.hasOwnProperty(i)){if(s&&!r)break;var n=this.localSearch(a[i],0,t);n.sort((function(e,t){return e._order-t._order})),r=s?this.intersect(r,n):n,s=!0}for(var o=r[0],c=r.length+1,p=[],d=1;d<c;d++){var l=r[d];l!=o&&(p.push(o),o=l)}return p},e.prototype.localSearch=function(e,t,a){if(!a)return[];var r={};for(var s in e)e.hasOwnProperty(s)&&(r[n=s.substr(t,1)||-1]||(r[n]={}),r[n][s]=1);if(6==t++)return a;var i=[];for(var n in r)if("-1"===n)for(var o in a)a.hasOwnProperty(o)&&i.push.apply(i,this.localSearch(r[n],t,a[o]));else{var c=this.localSearch(r[n],t,a[n]);i.push.apply(i,c)}return i},e}();function s(e){return!isNaN(e)}},913741:(e,t,a)=>{a.d(t,{default:()=>r});const r={snackbarTitle:"Snackbars__snackbarTitle--sE6uG",snackbarFailIcon:"Snackbars__snackbarFailIcon--7LvBo"}},810923:(e,t,a)=>{a.d(t,{default:()=>r});const r={friendCellUser:"FriendCell__friendCellUser--pDSLF",checkIconCircle:"FriendCell__checkIconCircle--ksMks"}},570089:(e,t,a)=>{a.d(t,{default:()=>r});const r={scrollContainer:"FriendListContainer__scrollContainer--rvghO",scrollContainerWrapper:"FriendListContainer__scrollContainerWrapper--8xfxk",searchControl:"FriendListContainer__searchControl--G8yki",searchControlSwitch:"FriendListContainer__searchControlSwitch--PdfJR"}},977629:(e,t,a)=>{a.d(t,{default:()=>r});const r={avatarScroll:"GetFriendsModal__avatarScroll--28P8c",title:"GetFriendsModal__title--yYY0p",showAll:"GetFriendsModal__showAll--I4ulB",showAllActive:"GetFriendsModal__showAllActive--vENxz"}},858861:(e,t,a)=>{a.d(t,{default:()=>r});const r={friendScrollBox:"VirtualizedFriendList__friendScrollBox--J2B1k",friendItem:"VirtualizedFriendList__friendItem--RlPaD"}},55797:(e,t,a)=>{a.d(t,{Icon16PlaceOutline:()=>i});var r=a(474848),s=(a(296540),a(506447));const i=e=>(0,r.jsx)(s.SvgIconRootV2,{viewBox:"0 0 16 16",width:16,height:16,vkuiIconId:"place_outline_16",vkuiAttrs:{fill:"none"},vkuiProps:e,children:(0,r.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M12.5 7c0 1.772-1.14 3.595-2.563 5.127-.617.662-.926.983-1.21 1.178-.19.13-.362.202-.727.202s-.537-.071-.727-.201c-.284-.196-.593-.516-1.21-1.18C4.64 10.596 3.5 8.773 3.5 7c0-2.272 1.82-4.5 4.5-4.5s4.5 2.228 4.5 4.5M14 7c0 2.362-1.476 4.546-2.965 6.148C9.884 14.388 9.308 15 8 15s-1.884-.613-3.035-1.852C3.477 11.546 2 9.362 2 7c0-3 2.394-6 6-6s6 3 6 6M8 5a2 2 0 1 0 0 4 2 2 0 0 0 0-4",clipRule:"evenodd"})})},437569:(e,t,a)=>{a.d(t,{Icon28Cancel:()=>i});var r=a(474848),s=(a(296540),a(506447));const i=e=>(0,r.jsx)(s.SvgIconRootV2,{viewBox:"0 0 28 28",width:28,height:28,vkuiIconId:"cancel_28",vkuiAttrs:{fill:"currentColor"},vkuiProps:e,children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M6.366 6.366a1.25 1.25 0 0 1 1.768 0L14 12.232l5.866-5.866a1.25 1.25 0 0 1 1.768 1.768L15.768 14l5.866 5.866a1.25 1.25 0 0 1-1.768 1.768L14 15.768l-5.866 5.866a1.25 1.25 0 0 1-1.768-1.768L12.232 14 6.366 8.134a1.25 1.25 0 0 1 0-1.768",clipRule:"evenodd"})})},997859:(e,t,a)=>{a.d(t,{default:()=>r});const r=function(e){return null==e}}}])}if("undefined"!=typeof window&&window.partConfigEnabled?.("static_loading_execute_errors"))try{e(),window.stManager?.done?.("dist/web/chunks/bfbfc1d3.e0cb3689.js")}catch(e){throw window.stManager?.fail?.("dist/web/chunks/bfbfc1d3.e0cb3689.js",e),e}else e(),"undefined"!=typeof window&&window.stManager?.done?.("dist/web/chunks/bfbfc1d3.e0cb3689.js");